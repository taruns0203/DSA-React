<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DSA Visualizer Pro</title>
    <style>
      /* ========================================
   CSS VARIABLES & THEME SYSTEM
   ======================================== */
      :root {
        --transition-speed: 0.45s;
        --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
        --ease-bounce: cubic-bezier(0.34, 1.56, 0.64, 1);
        --font-display: "Segoe UI", system-ui, sans-serif;
        --font-mono: "Cascadia Code", "Fira Code", "Consolas", monospace;
        --radius-sm: 8px;
        --radius-md: 14px;
        --radius-lg: 22px;
        --radius-xl: 30px;
      }

      [data-theme="dark"] {
        --bg-primary: #0a0a0f;
        --bg-secondary: #12121c;
        --bg-card: #16162388;
        --bg-card-hover: #1e1e30aa;
        --bg-surface: #1a1a2e;
        --bg-input: #1a1a2ecc;
        --text-primary: #e8e8f0;
        --text-secondary: #8888a8;
        --text-muted: #555570;
        --accent-1: #00f0ff;
        --accent-2: #7b61ff;
        --accent-3: #ff3d8e;
        --accent-4: #00e87b;
        --accent-5: #ffb800;
        --accent-glow: rgba(0, 240, 255, 0.15);
        --border-color: #2a2a4020;
        --border-accent: #2a2a50;
        --shadow-card: 0 4px 30px rgba(0, 0, 0, 0.4);
        --shadow-glow: 0 0 40px rgba(0, 240, 255, 0.08);
        --gradient-hero: linear-gradient(
          135deg,
          #0a0a0f 0%,
          #12122a 40%,
          #1a0a2e 70%,
          #0a0a0f 100%
        );
        --gradient-card: linear-gradient(145deg, #16162388, #1a1a3044);
        --gradient-accent: linear-gradient(
          135deg,
          var(--accent-1),
          var(--accent-2)
        );
        --noise-opacity: 0.03;
        --grid-color: rgba(123, 97, 255, 0.04);
        --overlay-bg: rgba(10, 10, 15, 0.92);
      }

      [data-theme="light"] {
        --bg-primary: #f0f0f8;
        --bg-secondary: #e8e8f4;
        --bg-card: #ffffffcc;
        --bg-card-hover: #ffffffee;
        --bg-surface: #ffffff;
        --bg-input: #f5f5facc;
        --text-primary: #1a1a2e;
        --text-secondary: #5a5a78;
        --text-muted: #9999aa;
        --accent-1: #0088cc;
        --accent-2: #6244cc;
        --accent-3: #dd2266;
        --accent-4: #00aa55;
        --accent-5: #dd8800;
        --accent-glow: rgba(0, 136, 204, 0.08);
        --border-color: #d0d0e020;
        --border-accent: #d0d0e0;
        --shadow-card: 0 4px 30px rgba(0, 0, 0, 0.08);
        --shadow-glow: 0 0 40px rgba(0, 136, 204, 0.05);
        --gradient-hero: linear-gradient(
          135deg,
          #f0f0f8 0%,
          #e0e0f4 40%,
          #f0e8f8 70%,
          #f0f0f8 100%
        );
        --gradient-card: linear-gradient(145deg, #ffffffcc, #f8f8ffaa);
        --gradient-accent: linear-gradient(
          135deg,
          var(--accent-1),
          var(--accent-2)
        );
        --noise-opacity: 0.015;
        --grid-color: rgba(98, 68, 204, 0.04);
        --overlay-bg: rgba(240, 240, 248, 0.95);
      }

      /* ========================================
   RESET & BASE
   ======================================== */
      *,
      *::before,
      *::after {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        scroll-behavior: smooth;
        font-size: 16px;
      }

      body {
        font-family: var(--font-display);
        background: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
        overflow-x: hidden;
        transition:
          background var(--transition-speed) var(--ease-smooth),
          color var(--transition-speed) var(--ease-smooth);
        line-height: 1.6;
      }

      /* Noise texture overlay */
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='1'/%3E%3C/svg%3E");
        opacity: var(--noise-opacity);
        pointer-events: none;
        z-index: 9999;
        transition: opacity var(--transition-speed) var(--ease-smooth);
      }

      /* Grid background */
      body::after {
        content: "";
        position: fixed;
        inset: 0;
        background-image:
          linear-gradient(var(--grid-color) 1px, transparent 1px),
          linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
        background-size: 60px 60px;
        pointer-events: none;
        z-index: 0;
        transition: background-image var(--transition-speed) var(--ease-smooth);
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      /* ========================================
   SCROLLBAR
   ======================================== */
      ::-webkit-scrollbar {
        width: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: var(--accent-2);
        border-radius: 10px;
      }

      /* ========================================
   NAVIGATION
   ======================================== */
      .nav {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
        padding: 0 2rem;
        height: 64px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: var(--overlay-bg);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--border-color);
        transition: background var(--transition-speed) var(--ease-smooth);
      }

      .nav-brand {
        display: flex;
        align-items: center;
        gap: 10px;
        cursor: pointer;
        font-weight: 700;
        font-size: 1.15rem;
        letter-spacing: -0.02em;
      }

      .nav-logo {
        width: 34px;
        height: 34px;
        border-radius: var(--radius-sm);
        background: var(--gradient-accent);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.85rem;
        font-weight: 800;
        color: #fff;
        position: relative;
        overflow: hidden;
      }

      .nav-logo::after {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          135deg,
          transparent 40%,
          rgba(255, 255, 255, 0.2)
        );
      }

      .nav-actions {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .nav-back {
        display: none;
        align-items: center;
        gap: 6px;
        padding: 6px 14px;
        border-radius: var(--radius-sm);
        background: var(--bg-card);
        border: 1px solid var(--border-accent);
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 0.82rem;
        font-family: var(--font-display);
        transition: all 0.25s var(--ease-smooth);
      }

      .nav-back:hover {
        color: var(--text-primary);
        border-color: var(--accent-1);
      }

      .nav-back.visible {
        display: flex;
      }

      /* Theme toggle */
      .theme-toggle {
        width: 52px;
        height: 28px;
        border-radius: 20px;
        background: var(--bg-card);
        border: 1.5px solid var(--border-accent);
        cursor: pointer;
        position: relative;
        transition: all 0.3s var(--ease-smooth);
      }

      .theme-toggle:hover {
        border-color: var(--accent-1);
        box-shadow: var(--shadow-glow);
      }

      .theme-toggle-knob {
        position: absolute;
        top: 2px;
        left: 2px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: var(--gradient-accent);
        transition: transform 0.35s var(--ease-bounce);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 11px;
      }

      [data-theme="light"] .theme-toggle-knob {
        transform: translateX(24px);
      }

      /* ========================================
   PAGE TRANSITIONS
   ======================================== */
      .page {
        display: none;
        opacity: 0;
        transform: translateY(16px);
        transition:
          opacity 0.4s var(--ease-smooth),
          transform 0.4s var(--ease-smooth);
        position: relative;
        z-index: 1;
      }

      .page.active {
        display: block;
      }

      .page.visible {
        opacity: 1;
        transform: translateY(0);
      }

      /* ========================================
   HERO SECTION
   ======================================== */
      .hero {
        min-height: 75vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-align: center;
        padding: 100px 2rem 3rem;
        position: relative;
        overflow: hidden;
      }

      /* Animated orbs */
      .hero-orb {
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        opacity: 0.4;
        animation: orbFloat 12s ease-in-out infinite;
        pointer-events: none;
      }

      .hero-orb:nth-child(1) {
        width: 400px;
        height: 400px;
        background: var(--accent-2);
        top: -100px;
        right: -100px;
        animation-delay: 0s;
      }

      .hero-orb:nth-child(2) {
        width: 300px;
        height: 300px;
        background: var(--accent-1);
        bottom: -50px;
        left: -80px;
        animation-delay: -4s;
      }

      .hero-orb:nth-child(3) {
        width: 250px;
        height: 250px;
        background: var(--accent-3);
        top: 40%;
        left: 60%;
        animation-delay: -8s;
      }

      @keyframes orbFloat {
        0%,
        100% {
          transform: translate(0, 0) scale(1);
        }
        25% {
          transform: translate(30px, -40px) scale(1.05);
        }
        50% {
          transform: translate(-20px, 20px) scale(0.95);
        }
        75% {
          transform: translate(15px, 35px) scale(1.02);
        }
      }

      .hero-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 6px 18px;
        border-radius: 40px;
        background: var(--accent-glow);
        border: 1px solid var(--border-accent);
        font-size: 0.78rem;
        font-weight: 600;
        color: var(--accent-1);
        text-transform: uppercase;
        letter-spacing: 0.12em;
        margin-bottom: 2rem;
        animation: fadeSlideUp 0.8s var(--ease-smooth) 0.2s both;
      }

      .hero-badge-dot {
        width: 6px;
        height: 6px;
        border-radius: 50%;
        background: var(--accent-4);
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.5;
          transform: scale(1.3);
        }
      }

      .hero h1 {
        font-size: clamp(2.4rem, 6vw, 4.2rem);
        font-weight: 800;
        letter-spacing: -0.04em;
        line-height: 1.1;
        margin-bottom: 1.2rem;
        animation: fadeSlideUp 0.8s var(--ease-smooth) 0.35s both;
      }

      .hero h1 .gradient-text {
        background: var(--gradient-accent);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .hero-subtitle {
        font-size: clamp(1rem, 2vw, 1.2rem);
        color: var(--text-secondary);
        max-width: 560px;
        margin-bottom: 2.5rem;
        line-height: 1.7;
        animation: fadeSlideUp 0.8s var(--ease-smooth) 0.5s both;
      }

      .hero-stats {
        display: flex;
        gap: 2.5rem;
        animation: fadeSlideUp 0.8s var(--ease-smooth) 0.65s both;
      }

      .hero-stat {
        text-align: center;
      }

      .hero-stat-num {
        font-size: 1.8rem;
        font-weight: 800;
        background: var(--gradient-accent);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .hero-stat-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        margin-top: 2px;
      }

      @keyframes fadeSlideUp {
        from {
          opacity: 0;
          transform: translateY(24px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      /* Animated scroll indicator */
      .scroll-hint {
        position: absolute;
        bottom: 2rem;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 8px;
        color: var(--text-muted);
        font-size: 0.72rem;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        animation: fadeSlideUp 0.8s var(--ease-smooth) 1s both;
      }

      .scroll-hint-line {
        width: 1px;
        height: 30px;
        background: var(--gradient-accent);
        animation: scrollLine 2s ease-in-out infinite;
        transform-origin: top;
      }

      @keyframes scrollLine {
        0% {
          transform: scaleY(0);
          opacity: 0;
        }
        50% {
          transform: scaleY(1);
          opacity: 1;
        }
        100% {
          transform: scaleY(0);
          opacity: 0;
        }
      }

      /* ========================================
   SECTION LAYOUT
   ======================================== */
      .section {
        padding: 4rem 2rem;
        max-width: 1200px;
        margin: 0 auto;
      }

      .section-header {
        margin-bottom: 2.5rem;
      }

      .section-label {
        font-size: 0.72rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        color: var(--accent-1);
        margin-bottom: 0.5rem;
      }

      .section-title {
        font-size: 1.8rem;
        font-weight: 700;
        letter-spacing: -0.03em;
      }

      /* ========================================
   TOPIC CARDS GRID
   ======================================== */
      .topics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.2rem;
      }

      .topic-card {
        position: relative;
        padding: 1.6rem;
        border-radius: var(--radius-md);
        background: var(--gradient-card);
        border: 1px solid var(--border-accent);
        cursor: pointer;
        overflow: hidden;
        transition: all 0.35s var(--ease-smooth);
        animation: cardReveal 0.6s var(--ease-smooth) both;
      }

      .topic-card:nth-child(1) {
        animation-delay: 0.05s;
      }
      .topic-card:nth-child(2) {
        animation-delay: 0.1s;
      }
      .topic-card:nth-child(3) {
        animation-delay: 0.15s;
      }
      .topic-card:nth-child(4) {
        animation-delay: 0.2s;
      }
      .topic-card:nth-child(5) {
        animation-delay: 0.25s;
      }
      .topic-card:nth-child(6) {
        animation-delay: 0.3s;
      }
      .topic-card:nth-child(7) {
        animation-delay: 0.35s;
      }
      .topic-card:nth-child(8) {
        animation-delay: 0.4s;
      }
      .topic-card:nth-child(9) {
        animation-delay: 0.45s;
      }

      @keyframes cardReveal {
        from {
          opacity: 0;
          transform: translateY(20px) scale(0.97);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .topic-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--card-accent, var(--gradient-accent));
        opacity: 0;
        transition: opacity 0.3s var(--ease-smooth);
      }

      .topic-card:hover {
        transform: translateY(-4px);
        border-color: var(--accent-1);
        box-shadow: var(--shadow-glow);
        background: var(--bg-card-hover);
      }

      .topic-card:hover::before {
        opacity: 1;
      }

      .topic-card-icon {
        width: 44px;
        height: 44px;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.3rem;
        margin-bottom: 1rem;
        background: var(--card-accent-bg, var(--accent-glow));
        transition: transform 0.3s var(--ease-bounce);
      }

      .topic-card:hover .topic-card-icon {
        transform: scale(1.1) rotate(-3deg);
      }

      .topic-card-title {
        font-size: 1.05rem;
        font-weight: 700;
        margin-bottom: 0.4rem;
        letter-spacing: -0.01em;
      }

      .topic-card-desc {
        font-size: 0.82rem;
        color: var(--text-secondary);
        line-height: 1.5;
        margin-bottom: 1rem;
      }

      .topic-card-meta {
        display: flex;
        align-items: center;
        gap: 1rem;
        font-size: 0.72rem;
        color: var(--text-muted);
      }

      .topic-card-tag {
        padding: 3px 10px;
        border-radius: 20px;
        background: var(--accent-glow);
        color: var(--accent-1);
        font-weight: 600;
      }

      /* ========================================
   VISUALIZER PAGE
   ======================================== */
      .viz-page {
        padding-top: 80px;
        min-height: 100vh;
      }

      .viz-layout {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 1.5rem;
        max-width: 1300px;
        margin: 0 auto;
        padding: 1.5rem 2rem;
      }

      .viz-sidebar {
        position: sticky;
        top: 80px;
        height: calc(100vh - 96px);
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      /* Educational panel */
      .edu-panel {
        background: var(--gradient-card);
        border: 1px solid var(--border-accent);
        border-radius: var(--radius-md);
        padding: 1.4rem;
        transition:
          background var(--transition-speed) var(--ease-smooth),
          border-color var(--transition-speed) var(--ease-smooth);
      }

      .edu-panel-title {
        font-size: 0.95rem;
        font-weight: 700;
        margin-bottom: 0.8rem;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .edu-panel-content {
        font-size: 0.82rem;
        color: var(--text-secondary);
        line-height: 1.65;
      }

      .edu-panel-content p {
        margin-bottom: 0.6rem;
      }

      .complexity-table {
        width: 100%;
        margin-top: 0.8rem;
        border-collapse: collapse;
        font-size: 0.78rem;
      }

      .complexity-table th,
      .complexity-table td {
        padding: 6px 10px;
        text-align: left;
        border-bottom: 1px solid var(--border-accent);
      }

      .complexity-table th {
        color: var(--text-muted);
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.06em;
        font-size: 0.68rem;
      }

      .complexity-table td:last-child {
        font-family: var(--font-mono);
        color: var(--accent-1);
        font-size: 0.76rem;
      }

      /* Controls panel */
      .controls-panel {
        background: var(--gradient-card);
        border: 1px solid var(--border-accent);
        border-radius: var(--radius-md);
        padding: 1.4rem;
        display: flex;
        flex-direction: column;
        gap: 1rem;
        transition:
          background var(--transition-speed) var(--ease-smooth),
          border-color var(--transition-speed) var(--ease-smooth);
      }

      .controls-title {
        font-size: 0.95rem;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .control-group {
        display: flex;
        flex-direction: column;
        gap: 6px;
      }

      .control-label {
        font-size: 0.72rem;
        font-weight: 600;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.08em;
      }

      .control-input {
        padding: 8px 12px;
        border-radius: var(--radius-sm);
        background: var(--bg-input);
        border: 1px solid var(--border-accent);
        color: var(--text-primary);
        font-family: var(--font-mono);
        font-size: 0.82rem;
        transition: border-color 0.25s var(--ease-smooth);
        outline: none;
        width: 100%;
      }

      .control-input:focus {
        border-color: var(--accent-1);
      }

      .control-slider {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 4px;
        border-radius: 4px;
        background: var(--border-accent);
        outline: none;
      }

      .control-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 16px;
        height: 16px;
        border-radius: 50%;
        background: var(--gradient-accent);
        cursor: pointer;
        border: none;
      }

      .control-btn-group {
        display: flex;
        gap: 8px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 8px 16px;
        border-radius: var(--radius-sm);
        border: 1px solid var(--border-accent);
        background: var(--bg-card);
        color: var(--text-primary);
        font-family: var(--font-display);
        font-size: 0.8rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.25s var(--ease-smooth);
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .btn:hover {
        border-color: var(--accent-1);
        box-shadow: var(--shadow-glow);
      }

      .btn-primary {
        background: var(--gradient-accent);
        border-color: transparent;
        color: #fff;
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 20px rgba(0, 240, 255, 0.2);
      }

      .btn-danger {
        border-color: var(--accent-3);
        color: var(--accent-3);
      }

      .btn-sm {
        padding: 5px 12px;
        font-size: 0.75rem;
      }

      .btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        transform: none !important;
      }

      select.control-input {
        cursor: pointer;
      }

      /* ========================================
   CANVAS / VISUALIZATION AREA
   ======================================== */
      .viz-main {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }

      .viz-canvas-wrapper {
        background: var(--gradient-card);
        border: 1px solid var(--border-accent);
        border-radius: var(--radius-md);
        overflow: hidden;
        position: relative;
        min-height: 420px;
        transition:
          background var(--transition-speed) var(--ease-smooth),
          border-color var(--transition-speed) var(--ease-smooth);
      }

      .viz-canvas {
        width: 100%;
        height: 420px;
        display: flex;
        align-items: flex-end;
        justify-content: center;
        padding: 2rem;
        gap: 3px;
        position: relative;
      }

      .viz-canvas.center-items {
        align-items: center;
      }

      /* Step info bar */
      .viz-step-bar {
        padding: 12px 1.4rem;
        border-top: 1px solid var(--border-accent);
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 0.82rem;
        min-height: 48px;
      }

      .viz-step-text {
        color: var(--text-secondary);
        font-family: var(--font-mono);
        font-size: 0.78rem;
      }

      .viz-step-text span {
        color: var(--accent-1);
        font-weight: 600;
      }

      .viz-step-counter {
        color: var(--text-muted);
        font-size: 0.72rem;
      }

      /* Log / Output console */
      .viz-log {
        background: var(--gradient-card);
        border: 1px solid var(--border-accent);
        border-radius: var(--radius-md);
        padding: 1rem 1.4rem;
        max-height: 200px;
        overflow-y: auto;
        font-family: var(--font-mono);
        font-size: 0.76rem;
        color: var(--text-secondary);
        line-height: 1.8;
        transition:
          background var(--transition-speed) var(--ease-smooth),
          border-color var(--transition-speed) var(--ease-smooth);
      }

      .viz-log-entry {
        animation: logSlide 0.3s var(--ease-smooth);
      }

      @keyframes logSlide {
        from {
          opacity: 0;
          transform: translateX(-10px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .viz-log-entry .accent {
        color: var(--accent-1);
      }
      .viz-log-entry .swap {
        color: var(--accent-3);
      }
      .viz-log-entry .done {
        color: var(--accent-4);
      }

      /* ========================================
   ARRAY BAR ELEMENTS
   ======================================== */
      .array-bar {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 6px;
        transition: all 0.3s var(--ease-smooth);
      }

      .array-bar-visual {
        width: 100%;
        border-radius: 4px 4px 0 0;
        background: var(--accent-2);
        transition: all 0.3s var(--ease-smooth);
        position: relative;
        min-width: 8px;
      }

      .array-bar-label {
        font-size: 0.65rem;
        font-family: var(--font-mono);
        color: var(--text-muted);
        font-weight: 600;
      }

      .array-bar.comparing .array-bar-visual {
        background: var(--accent-5);
      }
      .array-bar.swapping .array-bar-visual {
        background: var(--accent-3);
      }
      .array-bar.sorted .array-bar-visual {
        background: var(--accent-4);
      }
      .array-bar.pivot .array-bar-visual {
        background: var(--accent-1);
      }
      .array-bar.active .array-bar-visual {
        background: var(--accent-1);
        box-shadow: 0 0 12px var(--accent-1);
      }
      .array-bar.found .array-bar-visual {
        background: var(--accent-4);
        box-shadow: 0 0 16px var(--accent-4);
      }

      /* ========================================
   NODE ELEMENTS (For linked structures)
   ======================================== */
      .node-container {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        gap: 0;
        padding: 2rem;
        width: 100%;
        min-height: 100%;
      }

      .ll-node {
        display: flex;
        align-items: center;
        animation: nodeAppear 0.4s var(--ease-bounce) both;
      }

      @keyframes nodeAppear {
        from {
          opacity: 0;
          transform: scale(0.5);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      .ll-node-box {
        width: 56px;
        height: 56px;
        border-radius: var(--radius-sm);
        background: var(--bg-card);
        border: 2px solid var(--accent-2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: var(--font-mono);
        font-weight: 700;
        font-size: 0.95rem;
        transition: all 0.3s var(--ease-smooth);
        position: relative;
      }

      .ll-node-box.active {
        border-color: var(--accent-1);
        box-shadow: 0 0 16px rgba(0, 240, 255, 0.3);
      }

      .ll-node-box.highlight {
        border-color: var(--accent-4);
        background: rgba(0, 232, 123, 0.1);
      }

      .ll-node-box.removing {
        border-color: var(--accent-3);
        background: rgba(255, 61, 142, 0.1);
        animation: nodeRemove 0.5s var(--ease-smooth) forwards;
      }

      @keyframes nodeRemove {
        to {
          opacity: 0;
          transform: scale(0.3);
        }
      }

      .ll-node-arrow {
        width: 32px;
        height: 2px;
        background: var(--accent-2);
        position: relative;
        opacity: 0.6;
      }

      .ll-node-arrow::after {
        content: "";
        position: absolute;
        right: -1px;
        top: -4px;
        border: 5px solid transparent;
        border-left: 6px solid var(--accent-2);
      }

      .ll-node-label {
        position: absolute;
        top: -18px;
        font-size: 0.6rem;
        color: var(--accent-1);
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.06em;
      }

      /* ========================================
   STACK / QUEUE ELEMENTS
   ======================================== */
      .stack-container,
      .queue-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-end;
        width: 100%;
        height: 100%;
        padding: 1.5rem;
        gap: 4px;
      }

      .queue-container {
        flex-direction: row;
        justify-content: center;
        align-items: center;
      }

      .stack-item,
      .queue-item {
        width: 120px;
        padding: 12px 16px;
        border-radius: var(--radius-sm);
        background: var(--bg-card);
        border: 1.5px solid var(--accent-2);
        text-align: center;
        font-family: var(--font-mono);
        font-weight: 700;
        font-size: 1rem;
        animation: stackPush 0.35s var(--ease-bounce);
        transition: all 0.3s var(--ease-smooth);
      }

      .queue-item {
        width: auto;
        min-width: 60px;
      }

      @keyframes stackPush {
        from {
          opacity: 0;
          transform: translateY(-30px) scale(0.8);
        }
        to {
          opacity: 1;
          transform: translateY(0) scale(1);
        }
      }

      .stack-item.top {
        border-color: var(--accent-1);
        box-shadow: 0 0 14px rgba(0, 240, 255, 0.2);
      }

      .queue-item.front {
        border-color: var(--accent-4);
        box-shadow: 0 0 14px rgba(0, 232, 123, 0.2);
      }

      .queue-item.rear {
        border-color: var(--accent-3);
        box-shadow: 0 0 14px rgba(255, 61, 142, 0.2);
      }

      .stack-label,
      .queue-label {
        font-size: 0.65rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.1em;
        margin-bottom: 4px;
      }

      .stack-base {
        width: 140px;
        height: 4px;
        border-radius: 4px;
        background: var(--accent-2);
        opacity: 0.4;
        margin-top: 4px;
      }

      /* ========================================
   TREE ELEMENTS
   ======================================== */
      .tree-svg {
        width: 100%;
        height: 100%;
      }

      .tree-node-circle {
        fill: var(--bg-surface);
        stroke: var(--accent-2);
        stroke-width: 2;
        transition: all 0.4s var(--ease-smooth);
      }

      .tree-node-circle.active {
        stroke: var(--accent-1);
        fill: rgba(0, 240, 255, 0.08);
        filter: drop-shadow(0 0 8px rgba(0, 240, 255, 0.3));
      }

      .tree-node-circle.found {
        stroke: var(--accent-4);
        fill: rgba(0, 232, 123, 0.1);
        filter: drop-shadow(0 0 8px rgba(0, 232, 123, 0.3));
      }

      .tree-node-circle.inserting {
        stroke: var(--accent-5);
        fill: rgba(255, 184, 0, 0.1);
      }

      .tree-node-text {
        fill: var(--text-primary);
        font-family: var(--font-mono);
        font-size: 13px;
        font-weight: 700;
        text-anchor: middle;
        dominant-baseline: central;
      }

      .tree-edge {
        stroke: var(--border-accent);
        stroke-width: 1.5;
        fill: none;
        transition: stroke 0.3s var(--ease-smooth);
      }

      .tree-edge.active {
        stroke: var(--accent-1);
        stroke-width: 2;
      }

      /* ========================================
   HASH TABLE ELEMENTS
   ======================================== */
      .hash-container {
        display: flex;
        gap: 6px;
        padding: 2rem;
        width: 100%;
        height: 100%;
        align-items: flex-end;
        justify-content: center;
      }

      .hash-bucket {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 4px;
        flex: 1;
        max-width: 90px;
      }

      .hash-bucket-index {
        font-family: var(--font-mono);
        font-size: 0.65rem;
        color: var(--text-muted);
        font-weight: 600;
      }

      .hash-bucket-box {
        width: 100%;
        min-height: 40px;
        border-radius: var(--radius-sm);
        border: 1.5px solid var(--border-accent);
        background: var(--bg-card);
        display: flex;
        flex-direction: column;
        gap: 3px;
        padding: 4px;
        transition: all 0.3s var(--ease-smooth);
      }

      .hash-bucket-box.active {
        border-color: var(--accent-1);
        box-shadow: 0 0 12px rgba(0, 240, 255, 0.2);
      }

      .hash-entry {
        padding: 4px 8px;
        border-radius: 4px;
        background: var(--accent-2);
        color: #fff;
        font-family: var(--font-mono);
        font-size: 0.7rem;
        font-weight: 600;
        text-align: center;
        animation: nodeAppear 0.3s var(--ease-bounce);
      }

      .hash-entry.collision {
        background: var(--accent-3);
      }

      /* ========================================
   GRAPH ELEMENTS
   ======================================== */
      .graph-svg {
        width: 100%;
        height: 100%;
      }

      .graph-node {
        cursor: pointer;
      }

      .graph-node-circle {
        fill: var(--bg-surface);
        stroke: var(--accent-2);
        stroke-width: 2;
        transition: all 0.4s var(--ease-smooth);
      }

      .graph-node-circle.visited {
        stroke: var(--accent-4);
        fill: rgba(0, 232, 123, 0.1);
        filter: drop-shadow(0 0 6px rgba(0, 232, 123, 0.3));
      }

      .graph-node-circle.current {
        stroke: var(--accent-1);
        fill: rgba(0, 240, 255, 0.1);
        filter: drop-shadow(0 0 10px rgba(0, 240, 255, 0.4));
      }

      .graph-node-circle.queued {
        stroke: var(--accent-5);
        fill: rgba(255, 184, 0, 0.1);
      }

      .graph-node-text {
        fill: var(--text-primary);
        font-family: var(--font-mono);
        font-size: 13px;
        font-weight: 700;
        text-anchor: middle;
        dominant-baseline: central;
        pointer-events: none;
      }

      .graph-edge {
        stroke: var(--border-accent);
        stroke-width: 1.5;
        transition: stroke 0.3s var(--ease-smooth);
      }

      .graph-edge.active {
        stroke: var(--accent-1);
        stroke-width: 2.5;
      }

      /* ========================================
   RESPONSIVE
   ======================================== */
      @media (max-width: 900px) {
        .viz-layout {
          grid-template-columns: 1fr;
        }

        .viz-sidebar {
          position: static;
          height: auto;
          flex-direction: row;
          overflow-x: auto;
        }

        .edu-panel,
        .controls-panel {
          min-width: 280px;
        }
      }

      @media (max-width: 600px) {
        .hero h1 {
          font-size: 2rem;
        }
        .hero-stats {
          gap: 1.5rem;
        }
        .topics-grid {
          grid-template-columns: 1fr;
        }
        .nav {
          padding: 0 1rem;
        }
        .section {
          padding: 2rem 1rem;
        }
      }

      /* ========================================
   UTILITY
   ======================================== */
      .text-accent {
        color: var(--accent-1);
      }
      .text-mono {
        font-family: var(--font-mono);
      }
      .mt-1 {
        margin-top: 0.5rem;
      }
      .mt-2 {
        margin-top: 1rem;
      }
      .hidden {
        display: none !important;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <!-- Add any languages you need (JS is included by default) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/java.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/typescript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/go.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/languages/rust.min.js"></script>
  </head>
  <body>
    <!-- ============ NAVIGATION ============ -->
    <nav class="nav">
      <div class="nav-brand" onclick="navigateTo('home')">
        <div class="nav-logo">DS</div>
        <span
          >DSA Visualizer
          <span style="color: var(--text-muted); font-weight: 400"
            >Pro</span
          ></span
        >
      </div>
      <div class="nav-actions">
        <button class="nav-back" id="navBack" onclick="navigateTo('home')">
          ‚Üê Dashboard
        </button>
        <div class="theme-toggle" id="themeToggle" onclick="toggleTheme()">
          <div class="theme-toggle-knob" id="themeKnob">
            <span id="themeIcon">üåô</span>
          </div>
        </div>
      </div>
    </nav>

    <!-- ============ HOME PAGE ============ -->
    <div class="page active" id="page-home">
      <!-- Hero -->
      <section class="hero">
        <div class="hero-orb"></div>
        <div class="hero-orb"></div>
        <div class="hero-orb"></div>

        <div class="hero-badge">
          <span class="hero-badge-dot"></span>
          Interactive Learning Platform
        </div>

        <h1>
          Master <span class="gradient-text">Data Structures</span><br />&
          Algorithms
        </h1>

        <p class="hero-subtitle">
          Visualize, interact, and deeply understand every core DSA concept with
          step-by-step animated walkthroughs and real-time manipulation.
        </p>

        <div class="hero-stats">
          <div class="hero-stat">
            <div class="hero-stat-num">9</div>
            <div class="hero-stat-label">Topics</div>
          </div>
          <div class="hero-stat">
            <div class="hero-stat-num">15+</div>
            <div class="hero-stat-label">Algorithms</div>
          </div>
          <div class="hero-stat">
            <div class="hero-stat-num">‚àû</div>
            <div class="hero-stat-label">Visualizations</div>
          </div>
        </div>

        <div class="scroll-hint">
          <span>Explore Topics</span>
          <div class="scroll-hint-line"></div>
        </div>
      </section>

      <!-- Topics Grid -->
      <section class="section" id="topics-section">
        <div class="section-header">
          <div class="section-label">Explore</div>
          <div class="section-title">All Topics</div>
        </div>
        <div class="topics-grid" id="topicsGrid"></div>
      </section>
    </div>

    <!-- ============ VISUALIZER PAGE ============ -->
    <div class="page" id="page-viz">
      <div class="viz-page">
        <div class="viz-layout">
          <div class="viz-sidebar">
            <div class="edu-panel" id="eduPanel"></div>
            <div class="controls-panel" id="controlsPanel"></div>
          </div>
          <div class="viz-main">
            <div class="viz-canvas-wrapper">
              <div class="viz-canvas" id="vizCanvas"></div>
              <div class="viz-step-bar">
                <div class="viz-step-text" id="vizStepText">Ready to begin</div>
                <div class="viz-step-counter" id="vizStepCounter"></div>
              </div>
            </div>
            <div class="viz-log" id="vizLog">
              <div class="viz-log-entry" style="color: var(--text-muted)">
                // Output log
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      /* ========================================
   APP STATE & CONFIG
   ======================================== */
      const App = {
        currentPage: "home",
        currentTopic: null,
        theme: "dark",
        animSpeed: 400,
        isAnimating: false,
        animTimeout: null,
      };

      /* ========================================
   TOPICS DATA
   ======================================== */
      const TOPICS = [
        {
          id: "arrays",
          title: "Arrays",
          icon: "üì¶",
          desc: "A collection of elements stored in a contiguous block of memory.",
          category: "Data Structure",
          difficulty: "Easy",
          accentBg: "rgba(0, 240, 255, 0.08)",
          accent: "linear-gradient(135deg, #00f0ff, #0088cc)",
          link: "/Arrays/index.html",
          education: {
            about:
              "Arrays are a collection of elements stored in a contiguous block of memory. They are a linear data structure that allows for efficient access to elements by index.",
            complexity: [
              ["Access", "O(1)"],
              ["Search", "O(n)"],
              ["Insert", "O(n)"],
              ["Delete", "O(n)"],
            ],
          },
        },
        {
          id: "bubble-sort",
          title: "Bubble Sort",
          icon: "ü´ß",
          desc: "Repeatedly swaps adjacent elements that are out of order until the list is sorted.",
          category: "Sorting",
          difficulty: "Easy",
          accentBg: "rgba(0, 240, 255, 0.08)",
          accent: "linear-gradient(135deg, #00f0ff, #0088cc)",
          education: {
            about:
              "Bubble Sort is the simplest sorting algorithm. It repeatedly steps through the list, compares adjacent elements, and swaps them if they are in the wrong order.",
            complexity: [
              ["Best", "O(n)"],
              ["Average", "O(n¬≤)"],
              ["Worst", "O(n¬≤)"],
              ["Space", "O(1)"],
            ],
          },
        },
        {
          id: "selection-sort",
          title: "Selection Sort",
          icon: "üéØ",
          desc: "Finds the minimum element and places it at the beginning, building the sorted portion.",
          category: "Sorting",
          difficulty: "Easy",
          accentBg: "rgba(123, 97, 255, 0.08)",
          accent: "linear-gradient(135deg, #7b61ff, #6244cc)",
          education: {
            about:
              "Selection Sort divides the array into sorted and unsorted regions. It repeatedly selects the smallest element from the unsorted region and moves it to the end of the sorted region.",
            complexity: [
              ["Best", "O(n¬≤)"],
              ["Average", "O(n¬≤)"],
              ["Worst", "O(n¬≤)"],
              ["Space", "O(1)"],
            ],
          },
        },
        {
          id: "insertion-sort",
          title: "Insertion Sort",
          icon: "üì•",
          desc: "Builds the sorted array one element at a time by inserting into correct position.",
          category: "Sorting",
          difficulty: "Easy",
          accentBg: "rgba(255, 61, 142, 0.08)",
          accent: "linear-gradient(135deg, #ff3d8e, #dd2266)",
          education: {
            about:
              "Insertion Sort builds a sorted portion of the array one element at a time. It picks each element and inserts it into its correct position among the previously sorted elements.",
            complexity: [
              ["Best", "O(n)"],
              ["Average", "O(n¬≤)"],
              ["Worst", "O(n¬≤)"],
              ["Space", "O(1)"],
            ],
          },
        },
        {
          id: "quick-sort",
          title: "Quick Sort",
          icon: "‚ö°",
          desc: "Divide-and-conquer algorithm using pivot partitioning for efficient sorting.",
          category: "Sorting",
          difficulty: "Medium",
          accentBg: "rgba(255, 184, 0, 0.08)",
          accent: "linear-gradient(135deg, #ffb800, #dd8800)",
          education: {
            about:
              "Quick Sort picks a pivot element and partitions the array such that elements less than pivot are on the left and greater on the right, then recursively sorts the sub-arrays.",
            complexity: [
              ["Best", "O(n log n)"],
              ["Average", "O(n log n)"],
              ["Worst", "O(n¬≤)"],
              ["Space", "O(log n)"],
            ],
          },
        },
        {
          id: "binary-search",
          title: "Binary Search",
          icon: "üîç",
          desc: "Efficiently finds elements in sorted arrays by repeatedly halving the search space.",
          category: "Searching",
          difficulty: "Easy",
          accentBg: "rgba(0, 232, 123, 0.08)",
          accent: "linear-gradient(135deg, #00e87b, #00aa55)",
          education: {
            about:
              "Binary Search works on sorted arrays by comparing the target with the middle element. If they are not equal, it eliminates the half where the target cannot lie.",
            complexity: [
              ["Best", "O(1)"],
              ["Average", "O(log n)"],
              ["Worst", "O(log n)"],
              ["Space", "O(1)"],
            ],
          },
        },
        {
          id: "linked-list",
          title: "Linked List",
          icon: "üîó",
          desc: "Linear data structure where elements are connected through pointers/references.",
          category: "Data Structure",
          difficulty: "Easy",
          accentBg: "rgba(0, 240, 255, 0.08)",
          accent: "linear-gradient(135deg, #00f0ff, #7b61ff)",
          education: {
            about:
              "A Linked List is a linear data structure where each element (node) contains data and a reference to the next node. It allows efficient insertion and deletion at any position.",
            complexity: [
              ["Access", "O(n)"],
              ["Search", "O(n)"],
              ["Insert", "O(1)"],
              ["Delete", "O(1)"],
            ],
          },
        },
        {
          id: "stack",
          title: "Stack",
          icon: "üìö",
          desc: "Last-In-First-Out (LIFO) data structure. Push and pop from the top only.",
          category: "Data Structure",
          difficulty: "Easy",
          accentBg: "rgba(123, 97, 255, 0.08)",
          accent: "linear-gradient(135deg, #7b61ff, #ff3d8e)",
          education: {
            about:
              "A Stack follows Last-In-First-Out (LIFO) principle. Elements are added (pushed) and removed (popped) only from the top. Used in function calls, undo operations, and expression evaluation.",
            complexity: [
              ["Push", "O(1)"],
              ["Pop", "O(1)"],
              ["Peek", "O(1)"],
              ["Search", "O(n)"],
            ],
          },
        },
        {
          id: "queue",
          title: "Queue",
          icon: "üö∂",
          desc: "First-In-First-Out (FIFO) data structure. Enqueue at rear, dequeue from front.",
          category: "Data Structure",
          difficulty: "Easy",
          accentBg: "rgba(255, 184, 0, 0.08)",
          accent: "linear-gradient(135deg, #ffb800, #ff3d8e)",
          education: {
            about:
              "A Queue follows First-In-First-Out (FIFO) principle. Elements are added (enqueued) at the rear and removed (dequeued) from the front. Used in BFS, scheduling, and buffering.",
            complexity: [
              ["Enqueue", "O(1)"],
              ["Dequeue", "O(1)"],
              ["Peek", "O(1)"],
              ["Search", "O(n)"],
            ],
          },
        },
        {
          id: "bst",
          title: "Binary Search Tree",
          icon: "üå≥",
          desc: "Hierarchical tree where left child < parent < right child. Enables fast lookup.",
          category: "Data Structure",
          difficulty: "Medium",
          accentBg: "rgba(0, 232, 123, 0.08)",
          accent: "linear-gradient(135deg, #00e87b, #00f0ff)",
          education: {
            about:
              "A BST is a binary tree where for each node, all values in the left subtree are less and all values in the right subtree are greater. This property enables efficient searching.",
            complexity: [
              ["Search", "O(log n)"],
              ["Insert", "O(log n)"],
              ["Delete", "O(log n)"],
              ["Space", "O(n)"],
            ],
          },
        },
      ];

      /* ========================================
   THEME SYSTEM
   ======================================== */
      function initTheme() {
        const saved = localStorage.getItem("dsa-viz-theme");
        if (saved) App.theme = saved;
        applyTheme();
      }

      function toggleTheme() {
        App.theme = App.theme === "dark" ? "light" : "dark";
        localStorage.setItem("dsa-viz-theme", App.theme);
        applyTheme();
      }

      function applyTheme() {
        document.documentElement.setAttribute("data-theme", App.theme);
        document.getElementById("themeIcon").textContent =
          App.theme === "dark" ? "üåô" : "‚òÄÔ∏è";
      }

      /* ========================================
   ROUTING / NAVIGATION
   ======================================== */
      function navigateTo(page, topicId, link) {
        const pages = document.querySelectorAll(".page");
        const currentPage = document.querySelector(".page.visible");
        const backBtn = document.getElementById("navBack");
        console.log(link);
        if (link) {
          window.location.href = link;
          return;
        }

        if (currentPage) {
          currentPage.classList.remove("visible");
          setTimeout(() => {
            currentPage.classList.remove("active");
            showPage(page, topicId);
          }, 300);
        } else {
          showPage(page, topicId);
        }

        function showPage(p, tId) {
          stopAnimation();
          const target = document.getElementById(
            `page-${p === "home" ? "home" : "viz"}`,
          );
          target.classList.add("active");
          requestAnimationFrame(() => {
            requestAnimationFrame(() => target.classList.add("visible"));
          });

          if (p === "home") {
            backBtn.classList.remove("visible");
            App.currentTopic = null;
          } else {
            backBtn.classList.add("visible");
            App.currentTopic = tId;
            initVisualizer(tId);
          }

          App.currentPage = p;
          window.scrollTo({ top: 0, behavior: "smooth" });
        }
      }

      /* ========================================
   RENDER TOPIC CARDS
   ======================================== */
      function renderTopics() {
        const grid = document.getElementById("topicsGrid");
        grid.innerHTML = TOPICS.map(
          (t) => `
    <div class="topic-card" onclick="navigateTo('viz', '${t.id}', '${t.link}')"
         style="--card-accent: ${t.accent}; --card-accent-bg: ${t.accentBg};">
      <div class="topic-card-icon">${t.icon}</div>
      <div class="topic-card-title">${t.title}</div>
      <div class="topic-card-desc">${t.desc}</div>
      <div class="topic-card-meta">
        <span class="topic-card-tag">${t.category}</span>
        <span>${t.difficulty}</span>
      </div>
    </div>
  `,
        ).join("");
      }

      /* ========================================
   VISUALIZER ENGINE
   ======================================== */
      function initVisualizer(topicId) {
        const topic = TOPICS.find((t) => t.id === topicId);
        if (!topic) return;

        renderEduPanel(topic);
        clearLog();
        log(
          'Visualizer ready for <span class="accent">' +
            topic.title +
            "</span>",
        );

        const engine = ENGINES[topicId];
        if (engine) engine.init(topic);
      }

      function renderEduPanel(topic) {
        const panel = document.getElementById("eduPanel");
        const rows = topic.education.complexity
          .map(([label, val]) => `<tr><td>${label}</td><td>${val}</td></tr>`)
          .join("");

        panel.innerHTML = `
    <div class="edu-panel-title">${topic.icon} ${topic.title}</div>
    <div class="edu-panel-content">
      <p>${topic.education.about}</p>
      <table class="complexity-table">
        <thead><tr><th>Operation</th><th>Complexity</th></tr></thead>
        <tbody>${rows}</tbody>
      </table>
    </div>
  `;
      }

      function setStepText(text) {
        document.getElementById("vizStepText").innerHTML = text;
      }

      function setStepCounter(text) {
        document.getElementById("vizStepCounter").textContent = text;
      }

      function log(msg) {
        const logEl = document.getElementById("vizLog");
        const entry = document.createElement("div");
        entry.className = "viz-log-entry";
        entry.innerHTML = msg;
        logEl.appendChild(entry);
        logEl.scrollTop = logEl.scrollHeight;
      }

      function clearLog() {
        document.getElementById("vizLog").innerHTML = "";
      }

      function stopAnimation() {
        App.isAnimating = false;
        if (App.animTimeout) clearTimeout(App.animTimeout);
      }

      function sleep(ms) {
        return new Promise((resolve) => {
          App.animTimeout = setTimeout(resolve, ms);
        });
      }

      function generateArray(size = 20, max = 300) {
        return Array.from(
          { length: size },
          () => Math.floor(Math.random() * max) + 10,
        );
      }

      function renderArrayBars(arr, canvas, maxVal) {
        const max = maxVal || Math.max(...arr);
        const barWidth = Math.min(
          40,
          (canvas.clientWidth - 40) / arr.length - 3,
        );
        canvas.innerHTML = arr
          .map(
            (val, i) => `
    <div class="array-bar" id="bar-${i}" style="width: ${barWidth}px;">
      <div class="array-bar-visual" style="height: ${(val / max) * 340}px;"></div>
      <div class="array-bar-label">${val}</div>
    </div>
  `,
          )
          .join("");
      }

      /* ========================================
   SORTING CONTROLS TEMPLATE
   ======================================== */
      function sortControls(topicId) {
        return `
    <div class="controls-title">‚öô Controls</div>
    <div class="control-group">
      <label class="control-label">Array Size</label>
      <input type="range" class="control-slider" id="ctrl-size" min="5" max="50" value="25"
             oninput="document.getElementById('ctrl-size-val').textContent = this.value">
      <span class="control-label" id="ctrl-size-val" style="text-align:right;">25</span>
    </div>
    <div class="control-group">
      <label class="control-label">Speed (ms)</label>
      <input type="range" class="control-slider" id="ctrl-speed" min="10" max="800" value="120"
             oninput="App.animSpeed = +this.value; document.getElementById('ctrl-speed-val').textContent = this.value + 'ms'">
      <span class="control-label" id="ctrl-speed-val" style="text-align:right;">120ms</span>
    </div>
    <div class="control-btn-group">
      <button class="btn btn-primary" onclick="ENGINES['${topicId}'].run()">‚ñ∂ Run</button>
      <button class="btn" onclick="ENGINES['${topicId}'].init(TOPICS.find(t=>t.id==='${topicId}'))">‚Üª Reset</button>
      <button class="btn btn-danger" onclick="stopAnimation()">‚ñ† Stop</button>
    </div>
  `;
      }

      /* ========================================
   VISUALIZER ENGINES
   ======================================== */
      const ENGINES = {};

      // ---- BUBBLE SORT ----
      ENGINES["bubble-sort"] = {
        arr: [],
        init(topic) {
          this.arr = generateArray(25);
          App.animSpeed = 120;
          const canvas = document.getElementById("vizCanvas");
          canvas.className = "viz-canvas";
          renderArrayBars(this.arr, canvas);
          document.getElementById("controlsPanel").innerHTML =
            sortControls("bubble-sort");
          setStepText("Ready ‚Äî press <span>Run</span> to start Bubble Sort");
          setStepCounter("");
        },
        async run() {
          if (App.isAnimating) return;
          this.arr = generateArray(+document.getElementById("ctrl-size").value);
          const canvas = document.getElementById("vizCanvas");
          renderArrayBars(this.arr, canvas);
          App.isAnimating = true;
          clearLog();
          log('Starting <span class="accent">Bubble Sort</span>...');
          const arr = [...this.arr];
          const n = arr.length;
          let swaps = 0,
            comps = 0;

          for (let i = 0; i < n - 1 && App.isAnimating; i++) {
            let swapped = false;
            for (let j = 0; j < n - i - 1 && App.isAnimating; j++) {
              comps++;
              setBarsClass(canvas, [j, j + 1], "comparing");
              setStepText(
                `Comparing <span>${arr[j]}</span> and <span>${arr[j + 1]}</span>`,
              );
              setStepCounter(
                `Pass ${i + 1} | Comparisons: ${comps} | Swaps: ${swaps}`,
              );
              await sleep(App.animSpeed);

              if (arr[j] > arr[j + 1]) {
                [arr[j], arr[j + 1]] = [arr[j + 1], arr[j]];
                swaps++;
                swapped = true;
                setBarsClass(canvas, [j, j + 1], "swapping");
                log(`<span class="swap">Swap</span> ${arr[j + 1]} ‚Üî ${arr[j]}`);
                await sleep(App.animSpeed);
                renderArrayBars(arr, canvas);
                markSorted(canvas, n - i - 1, n);
              }
              clearBarsClass(canvas);
              markSorted(canvas, n - i - 1, n);
            }
            markSorted(canvas, n - i - 1, n);
            if (!swapped) break;
          }

          if (App.isAnimating) {
            markAllSorted(canvas, arr.length);
            setStepText('<span class="done">‚úì Sorted!</span>');
            log(
              `<span class="done">Done!</span> ${comps} comparisons, ${swaps} swaps`,
            );
          }
          App.isAnimating = false;
        },
      };

      // ---- SELECTION SORT ----
      ENGINES["selection-sort"] = {
        arr: [],
        init(topic) {
          this.arr = generateArray(25);
          App.animSpeed = 120;
          const canvas = document.getElementById("vizCanvas");
          canvas.className = "viz-canvas";
          renderArrayBars(this.arr, canvas);
          document.getElementById("controlsPanel").innerHTML =
            sortControls("selection-sort");
          setStepText("Ready ‚Äî press <span>Run</span> to start Selection Sort");
          setStepCounter("");
        },
        async run() {
          if (App.isAnimating) return;
          this.arr = generateArray(+document.getElementById("ctrl-size").value);
          const canvas = document.getElementById("vizCanvas");
          renderArrayBars(this.arr, canvas);
          App.isAnimating = true;
          clearLog();
          log('Starting <span class="accent">Selection Sort</span>...');
          const arr = [...this.arr];
          const n = arr.length;
          let swaps = 0,
            comps = 0;

          for (let i = 0; i < n - 1 && App.isAnimating; i++) {
            let minIdx = i;
            setBarsClass(canvas, [i], "pivot");
            for (let j = i + 1; j < n && App.isAnimating; j++) {
              comps++;
              setBarsClass(canvas, [j], "comparing", true);
              setStepText(
                `Finding min: comparing <span>${arr[j]}</span> with current min <span>${arr[minIdx]}</span>`,
              );
              setStepCounter(
                `Pass ${i + 1} | Comps: ${comps} | Swaps: ${swaps}`,
              );
              await sleep(App.animSpeed / 2);
              clearBarsClassExcept(canvas, [minIdx], "pivot");
              markSorted(canvas, 0, i);
              if (arr[j] < arr[minIdx]) {
                minIdx = j;
                setBarsClass(canvas, [minIdx], "pivot");
              }
            }
            if (minIdx !== i) {
              [arr[i], arr[minIdx]] = [arr[minIdx], arr[i]];
              swaps++;
              log(
                `<span class="swap">Swap</span> index ${i} ‚Üî ${minIdx} (placed ${arr[i]})`,
              );
              renderArrayBars(arr, canvas);
            }
            markSorted(canvas, 0, i + 1);
          }

          if (App.isAnimating) {
            markAllSorted(canvas, arr.length);
            setStepText('<span class="done">‚úì Sorted!</span>');
            log(
              `<span class="done">Done!</span> ${comps} comparisons, ${swaps} swaps`,
            );
          }
          App.isAnimating = false;
        },
      };

      // ---- INSERTION SORT ----
      ENGINES["insertion-sort"] = {
        arr: [],
        init(topic) {
          this.arr = generateArray(25);
          App.animSpeed = 120;
          const canvas = document.getElementById("vizCanvas");
          canvas.className = "viz-canvas";
          renderArrayBars(this.arr, canvas);
          document.getElementById("controlsPanel").innerHTML =
            sortControls("insertion-sort");
          setStepText("Ready ‚Äî press <span>Run</span> to start Insertion Sort");
          setStepCounter("");
        },
        async run() {
          if (App.isAnimating) return;
          this.arr = generateArray(+document.getElementById("ctrl-size").value);
          const canvas = document.getElementById("vizCanvas");
          renderArrayBars(this.arr, canvas);
          App.isAnimating = true;
          clearLog();
          log('Starting <span class="accent">Insertion Sort</span>...');
          const arr = [...this.arr];
          const n = arr.length;
          let shifts = 0;

          for (let i = 1; i < n && App.isAnimating; i++) {
            let key = arr[i];
            let j = i - 1;
            setBarsClass(canvas, [i], "active");
            setStepText(`Inserting <span>${key}</span> into sorted portion`);
            await sleep(App.animSpeed);

            while (j >= 0 && arr[j] > key && App.isAnimating) {
              arr[j + 1] = arr[j];
              shifts++;
              setBarsClass(canvas, [j], "swapping", true);
              setStepCounter(`Element: ${i + 1}/${n} | Shifts: ${shifts}`);
              await sleep(App.animSpeed / 2);
              j--;
            }
            arr[j + 1] = key;
            renderArrayBars(arr, canvas);
            markSorted(canvas, 0, i + 1);
            log(`Placed <span class="accent">${key}</span> at index ${j + 1}`);
          }

          if (App.isAnimating) {
            markAllSorted(canvas, arr.length);
            setStepText('<span class="done">‚úì Sorted!</span>');
            log(`<span class="done">Done!</span> ${shifts} shifts`);
          }
          App.isAnimating = false;
        },
      };

      // ---- QUICK SORT ----
      ENGINES["quick-sort"] = {
        arr: [],
        init(topic) {
          this.arr = generateArray(25);
          App.animSpeed = 200;
          const canvas = document.getElementById("vizCanvas");
          canvas.className = "viz-canvas";
          renderArrayBars(this.arr, canvas);
          document.getElementById("controlsPanel").innerHTML =
            sortControls("quick-sort");
          document.getElementById("ctrl-speed").value = 200;
          document.getElementById("ctrl-speed-val").textContent = "200ms";
          setStepText("Ready ‚Äî press <span>Run</span> to start Quick Sort");
          setStepCounter("");
        },
        async run() {
          if (App.isAnimating) return;
          this.arr = generateArray(+document.getElementById("ctrl-size").value);
          const canvas = document.getElementById("vizCanvas");
          renderArrayBars(this.arr, canvas);
          App.isAnimating = true;
          clearLog();
          log('Starting <span class="accent">Quick Sort</span>...');
          const arr = [...this.arr];
          const sorted = new Set();

          async function partition(low, high) {
            if (!App.isAnimating) return low;
            const pivot = arr[high];
            setBarsClass(canvas, [high], "pivot");
            setStepText(`Pivot: <span>${pivot}</span> at index ${high}`);
            log(
              `Pivot = <span class="accent">${pivot}</span> [${low}..${high}]`,
            );
            await sleep(App.animSpeed);
            let i = low - 1;

            for (let j = low; j < high && App.isAnimating; j++) {
              setBarsClass(canvas, [j], "comparing", true);
              await sleep(App.animSpeed / 2);
              if (arr[j] < pivot) {
                i++;
                [arr[i], arr[j]] = [arr[j], arr[i]];
                renderArrayBars(arr, canvas);
                setBarsClass(canvas, [high], "pivot");
                sorted.forEach((s) => {
                  const b = canvas.children[s];
                  if (b) b.classList.add("sorted");
                });
              }
              clearBarsClassExcept(canvas, [high], "pivot");
              sorted.forEach((s) => {
                const b = canvas.children[s];
                if (b) b.classList.add("sorted");
              });
            }

            [arr[i + 1], arr[high]] = [arr[high], arr[i + 1]];
            sorted.add(i + 1);
            renderArrayBars(arr, canvas);
            sorted.forEach((s) => {
              const b = canvas.children[s];
              if (b) b.classList.add("sorted");
            });
            return i + 1;
          }

          async function quickSort(low, high) {
            if (low < high && App.isAnimating) {
              const pi = await partition(low, high);
              await quickSort(low, pi - 1);
              await quickSort(pi + 1, high);
            }
            if (low === high) sorted.add(low);
          }

          await quickSort(0, arr.length - 1);

          if (App.isAnimating) {
            markAllSorted(canvas, arr.length);
            setStepText('<span class="done">‚úì Sorted!</span>');
            log('<span class="done">Done! Quick Sort complete.</span>');
          }
          App.isAnimating = false;
        },
      };

      // ---- BINARY SEARCH ----
      ENGINES["binary-search"] = {
        arr: [],
        init(topic) {
          this.arr = Array.from(
            { length: 20 },
            (_, i) => (i + 1) * Math.floor(Math.random() * 5 + 3),
          );
          this.arr.sort((a, b) => a - b);
          // Remove duplicates
          this.arr = [...new Set(this.arr)].slice(0, 20);
          App.animSpeed = 500;
          const canvas = document.getElementById("vizCanvas");
          canvas.className = "viz-canvas";
          renderArrayBars(this.arr, canvas, Math.max(...this.arr));
          document.getElementById("controlsPanel").innerHTML = `
      <div class="controls-title">‚öô Controls</div>
      <div class="control-group">
        <label class="control-label">Search Target</label>
        <input type="number" class="control-input" id="ctrl-target" value="${this.arr[Math.floor(this.arr.length / 3)]}">
      </div>
      <div class="control-group">
        <label class="control-label">Speed (ms)</label>
        <input type="range" class="control-slider" id="ctrl-speed" min="100" max="1500" value="500"
               oninput="App.animSpeed = +this.value; document.getElementById('ctrl-speed-val').textContent = this.value + 'ms'">
        <span class="control-label" id="ctrl-speed-val" style="text-align:right;">500ms</span>
      </div>
      <div class="control-btn-group">
        <button class="btn btn-primary" onclick="ENGINES['binary-search'].run()">‚ñ∂ Search</button>
        <button class="btn" onclick="ENGINES['binary-search'].init(TOPICS.find(t=>t.id==='binary-search'))">‚Üª Reset</button>
        <button class="btn btn-danger" onclick="stopAnimation()">‚ñ† Stop</button>
      </div>
    `;
          setStepText("Enter a target and press <span>Search</span>");
          setStepCounter("");
        },
        async run() {
          if (App.isAnimating) return;
          App.isAnimating = true;
          const target = +document.getElementById("ctrl-target").value;
          const canvas = document.getElementById("vizCanvas");
          const arr = this.arr;
          clearLog();
          log(
            `Searching for <span class="accent">${target}</span> in sorted array`,
          );
          renderArrayBars(arr, canvas, Math.max(...arr));

          let low = 0,
            high = arr.length - 1,
            step = 0;

          while (low <= high && App.isAnimating) {
            step++;
            const mid = Math.floor((low + high) / 2);

            // Highlight search range
            for (let i = 0; i < arr.length; i++) {
              const bar = canvas.children[i];
              bar.className = "array-bar";
              if (i < low || i > high) bar.style.opacity = "0.25";
              else bar.style.opacity = "1";
            }

            setBarsClass(canvas, [mid], "active");
            setStepText(
              `Step ${step}: mid = <span>${arr[mid]}</span> (index ${mid}), target = <span>${target}</span>`,
            );
            setStepCounter(`Range: [${low}, ${high}] | Steps: ${step}`);
            log(
              `Step ${step}: Check index ${mid} ‚Üí <span class="accent">${arr[mid]}</span>`,
            );
            await sleep(App.animSpeed);

            if (arr[mid] === target) {
              setBarsClass(canvas, [mid], "found");
              setStepText(
                `<span class="done">‚úì Found ${target} at index ${mid}!</span>`,
              );
              log(
                `<span class="done">Found!</span> ${target} at index ${mid} in ${step} steps`,
              );
              App.isAnimating = false;
              return;
            } else if (arr[mid] < target) {
              log(`${arr[mid]} < ${target} ‚Üí search right half`);
              low = mid + 1;
            } else {
              log(`${arr[mid]} > ${target} ‚Üí search left half`);
              high = mid - 1;
            }
          }

          if (App.isAnimating) {
            setStepText(
              `<span style="color: var(--accent-3);">‚úó ${target} not found</span>`,
            );
            log(
              `<span class="swap">${target} not found</span> after ${step} steps`,
            );
          }
          App.isAnimating = false;
        },
      };

      // ---- LINKED LIST ----
      ENGINES["linked-list"] = {
        list: [],
        init(topic) {
          this.list = [10, 25, 37, 42, 58];
          const canvas = document.getElementById("vizCanvas");
          canvas.className = "viz-canvas center-items";
          this.render(canvas);
          document.getElementById("controlsPanel").innerHTML = `
      <div class="controls-title">‚öô Controls</div>
      <div class="control-group">
        <label class="control-label">Value</label>
        <input type="number" class="control-input" id="ctrl-value" value="${Math.floor(Math.random() * 90 + 10)}">
      </div>
      <div class="control-group">
        <label class="control-label">Position (0-indexed)</label>
        <input type="number" class="control-input" id="ctrl-pos" value="0" min="0">
      </div>
      <div class="control-btn-group">
        <button class="btn btn-primary" onclick="ENGINES['linked-list'].prepend()">‚äï Prepend</button>
        <button class="btn btn-primary" onclick="ENGINES['linked-list'].append()">Append ‚äï</button>
        <button class="btn" onclick="ENGINES['linked-list'].insertAt()">Insert At</button>
        <button class="btn btn-danger" onclick="ENGINES['linked-list'].removeAt()">Remove At</button>
      </div>
    `;
          setStepText("Use controls to manipulate the Linked List");
          setStepCounter(`${this.list.length} nodes`);
        },
        render(canvas) {
          canvas = canvas || document.getElementById("vizCanvas");
          const nodeHtml = this.list
            .map((val, i) => {
              let label = "";
              if (i === 0) label = '<span class="ll-node-label">HEAD</span>';
              if (i === this.list.length - 1)
                label +=
                  '<span class="ll-node-label" style="right:0;left:auto;">TAIL</span>';
              return `<div class="ll-node">
        <div class="ll-node-box">${label}${val}</div>
        ${i < this.list.length - 1 ? '<div class="ll-node-arrow"></div>' : ""}
      </div>`;
            })
            .join("");
          canvas.innerHTML = `<div class="node-container">${nodeHtml || '<div style="color:var(--text-muted);">Empty list</div>'}</div>`;
          setStepCounter(`${this.list.length} nodes`);
        },
        prepend() {
          const val = +document.getElementById("ctrl-value").value;
          this.list.unshift(val);
          this.render();
          log(`Prepended <span class="accent">${val}</span>`);
          setStepText(`Prepended <span>${val}</span> at head`);
          document.getElementById("ctrl-value").value = Math.floor(
            Math.random() * 90 + 10,
          );
        },
        append() {
          const val = +document.getElementById("ctrl-value").value;
          this.list.push(val);
          this.render();
          log(`Appended <span class="accent">${val}</span>`);
          setStepText(`Appended <span>${val}</span> at tail`);
          document.getElementById("ctrl-value").value = Math.floor(
            Math.random() * 90 + 10,
          );
        },
        insertAt() {
          const val = +document.getElementById("ctrl-value").value;
          const pos = +document.getElementById("ctrl-pos").value;
          if (pos < 0 || pos > this.list.length) {
            setStepText(
              '<span style="color:var(--accent-3);">Invalid position!</span>',
            );
            return;
          }
          this.list.splice(pos, 0, val);
          this.render();
          log(`Inserted <span class="accent">${val}</span> at position ${pos}`);
          setStepText(`Inserted <span>${val}</span> at position ${pos}`);
          document.getElementById("ctrl-value").value = Math.floor(
            Math.random() * 90 + 10,
          );
        },
        removeAt() {
          const pos = +document.getElementById("ctrl-pos").value;
          if (pos < 0 || pos >= this.list.length) {
            setStepText(
              '<span style="color:var(--accent-3);">Invalid position!</span>',
            );
            return;
          }
          const removed = this.list.splice(pos, 1)[0];
          this.render();
          log(
            `<span class="swap">Removed</span> ${removed} from position ${pos}`,
          );
          setStepText(`Removed <span>${removed}</span> from position ${pos}`);
        },
      };

      // ---- STACK ----
      ENGINES["stack"] = {
        items: [],
        init(topic) {
          this.items = [15, 42, 7];
          const canvas = document.getElementById("vizCanvas");
          canvas.className = "viz-canvas center-items";
          this.render(canvas);
          document.getElementById("controlsPanel").innerHTML = `
      <div class="controls-title">‚öô Controls</div>
      <div class="control-group">
        <label class="control-label">Value</label>
        <input type="number" class="control-input" id="ctrl-value" value="${Math.floor(Math.random() * 90 + 10)}">
      </div>
      <div class="control-btn-group">
        <button class="btn btn-primary" onclick="ENGINES['stack'].push()">‚Üë Push</button>
        <button class="btn btn-danger" onclick="ENGINES['stack'].pop()">‚Üì Pop</button>
        <button class="btn" onclick="ENGINES['stack'].peek()">üëÅ Peek</button>
      </div>
    `;
          setStepText("Push and pop elements on the stack");
          setStepCounter(`Size: ${this.items.length}`);
        },
        render(canvas) {
          canvas = canvas || document.getElementById("vizCanvas");
          const html = this.items
            .slice()
            .reverse()
            .map(
              (val, i) =>
                `<div class="stack-item ${i === 0 ? "top" : ""}">${val}${i === 0 ? ' <span style="font-size:0.65rem;color:var(--accent-1);">‚Üê TOP</span>' : ""}</div>`,
            )
            .join("");
          canvas.innerHTML = `<div class="stack-container">
      <div class="stack-label">Stack (LIFO)</div>
      ${html || '<div style="color:var(--text-muted);">Empty stack</div>'}
      <div class="stack-base"></div>
    </div>`;
          setStepCounter(`Size: ${this.items.length}`);
        },
        push() {
          const val = +document.getElementById("ctrl-value").value;
          this.items.push(val);
          this.render();
          log(`<span class="accent">Push</span> ${val}`);
          setStepText(`Pushed <span>${val}</span> onto the stack`);
          document.getElementById("ctrl-value").value = Math.floor(
            Math.random() * 90 + 10,
          );
        },
        pop() {
          if (this.items.length === 0) {
            setStepText(
              '<span style="color:var(--accent-3);">Stack underflow!</span>',
            );
            log('<span class="swap">Error:</span> Stack is empty');
            return;
          }
          const val = this.items.pop();
          this.render();
          log(`<span class="swap">Pop</span> ${val}`);
          setStepText(`Popped <span>${val}</span> from the stack`);
        },
        peek() {
          if (this.items.length === 0) {
            setStepText(
              '<span style="color:var(--accent-3);">Stack is empty!</span>',
            );
            return;
          }
          const val = this.items[this.items.length - 1];
          setStepText(`Top element: <span>${val}</span>`);
          log(`Peek ‚Üí <span class="accent">${val}</span>`);
        },
      };

      // ---- QUEUE ----
      ENGINES["queue"] = {
        items: [],
        init(topic) {
          this.items = [8, 23, 56];
          const canvas = document.getElementById("vizCanvas");
          canvas.className = "viz-canvas center-items";
          this.render(canvas);
          document.getElementById("controlsPanel").innerHTML = `
      <div class="controls-title">‚öô Controls</div>
      <div class="control-group">
        <label class="control-label">Value</label>
        <input type="number" class="control-input" id="ctrl-value" value="${Math.floor(Math.random() * 90 + 10)}">
      </div>
      <div class="control-btn-group">
        <button class="btn btn-primary" onclick="ENGINES['queue'].enqueue()">‚Üí Enqueue</button>
        <button class="btn btn-danger" onclick="ENGINES['queue'].dequeue()">‚Üê Dequeue</button>
        <button class="btn" onclick="ENGINES['queue'].peekFront()">üëÅ Peek</button>
      </div>
    `;
          setStepText("Enqueue and dequeue elements in the queue");
          setStepCounter(`Size: ${this.items.length}`);
        },
        render(canvas) {
          canvas = canvas || document.getElementById("vizCanvas");
          const html = this.items
            .map((val, i) => {
              let cls = "";
              if (i === 0 && this.items.length > 0) cls = "front";
              if (i === this.items.length - 1) cls += " rear";
              let label = "";
              if (i === 0)
                label =
                  '<span style="font-size:0.6rem;color:var(--accent-4);">FRONT‚Üí</span> ';
              if (i === this.items.length - 1)
                label +=
                  ' <span style="font-size:0.6rem;color:var(--accent-3);">‚ÜêREAR</span>';
              return `<div class="queue-item ${cls}">${label}${val}</div>`;
            })
            .join('<div class="ll-node-arrow" style="width:24px;"></div>');
          canvas.innerHTML = `<div class="queue-container">
      ${html || '<div style="color:var(--text-muted);">Empty queue</div>'}
    </div>`;
          setStepCounter(`Size: ${this.items.length}`);
        },
        enqueue() {
          const val = +document.getElementById("ctrl-value").value;
          this.items.push(val);
          this.render();
          log(`<span class="accent">Enqueue</span> ${val}`);
          setStepText(`Enqueued <span>${val}</span> at the rear`);
          document.getElementById("ctrl-value").value = Math.floor(
            Math.random() * 90 + 10,
          );
        },
        dequeue() {
          if (this.items.length === 0) {
            setStepText(
              '<span style="color:var(--accent-3);">Queue underflow!</span>',
            );
            log('<span class="swap">Error:</span> Queue is empty');
            return;
          }
          const val = this.items.shift();
          this.render();
          log(`<span class="swap">Dequeue</span> ${val}`);
          setStepText(`Dequeued <span>${val}</span> from the front`);
        },
        peekFront() {
          if (this.items.length === 0) {
            setStepText(
              '<span style="color:var(--accent-3);">Queue is empty!</span>',
            );
            return;
          }
          const val = this.items[0];
          setStepText(`Front element: <span>${val}</span>`);
          log(`Peek ‚Üí <span class="accent">${val}</span>`);
        },
      };

      // ---- BINARY SEARCH TREE ----
      ENGINES["bst"] = {
        root: null,
        init(topic) {
          this.root = null;
          [40, 20, 60, 10, 30, 50, 70].forEach((v) => this.insertNode(v));
          const canvas = document.getElementById("vizCanvas");
          canvas.className = "viz-canvas center-items";
          this.render(canvas);
          document.getElementById("controlsPanel").innerHTML = `
      <div class="controls-title">‚öô Controls</div>
      <div class="control-group">
        <label class="control-label">Value</label>
        <input type="number" class="control-input" id="ctrl-value" value="${Math.floor(Math.random() * 90 + 1)}">
      </div>
      <div class="control-group">
        <label class="control-label">Speed (ms)</label>
        <input type="range" class="control-slider" id="ctrl-speed" min="100" max="1500" value="500"
               oninput="App.animSpeed = +this.value;">
      </div>
      <div class="control-btn-group">
        <button class="btn btn-primary" onclick="ENGINES['bst'].animatedInsert()">‚äï Insert</button>
        <button class="btn" onclick="ENGINES['bst'].animatedSearch()">üîç Search</button>
        <button class="btn btn-danger" onclick="ENGINES['bst'].reset()">‚Üª Reset</button>
      </div>
      <div class="control-btn-group mt-1">
        <button class="btn btn-sm" onclick="ENGINES['bst'].traverse('inorder')">In-Order</button>
        <button class="btn btn-sm" onclick="ENGINES['bst'].traverse('preorder')">Pre-Order</button>
        <button class="btn btn-sm" onclick="ENGINES['bst'].traverse('postorder')">Post-Order</button>
      </div>
    `;
          setStepText("Insert, search, or traverse the BST");
          setStepCounter("");
        },
        insertNode(val, node) {
          if (!this.root) {
            this.root = { val, left: null, right: null };
            return;
          }
          let curr = this.root;
          while (true) {
            if (val < curr.val) {
              if (!curr.left) {
                curr.left = { val, left: null, right: null };
                return;
              }
              curr = curr.left;
            } else if (val > curr.val) {
              if (!curr.right) {
                curr.right = { val, left: null, right: null };
                return;
              }
              curr = curr.right;
            } else return; // duplicate
          }
        },
        getPositions() {
          const positions = [];
          const traverse = (node, x, y, spread, depth) => {
            if (!node) return;
            positions.push({ val: node.val, x, y, depth });
            traverse(node.left, x - spread, y + 60, spread * 0.55, depth + 1);
            traverse(node.right, x + spread, y + 60, spread * 0.55, depth + 1);
          };
          traverse(this.root, 400, 40, 160, 0);
          return positions;
        },
        getEdges() {
          const edges = [];
          const traverse = (node, x, y, spread) => {
            if (!node) return;
            if (node.left) {
              edges.push({
                x1: x,
                y1: y,
                x2: x - spread,
                y2: y + 60,
                from: node.val,
                to: node.left.val,
              });
              traverse(node.left, x - spread, y + 60, spread * 0.55);
            }
            if (node.right) {
              edges.push({
                x1: x,
                y1: y,
                x2: x + spread,
                y2: y + 60,
                from: node.val,
                to: node.right.val,
              });
              traverse(node.right, x + spread, y + 60, spread * 0.55);
            }
          };
          traverse(this.root, 400, 40, 160);
          return edges;
        },
        render(canvas, highlights = {}) {
          canvas = canvas || document.getElementById("vizCanvas");
          const positions = this.getPositions();
          const edges = this.getEdges();
          const edgeSvg = edges
            .map((e) => {
              const cls = highlights.edges?.has(`${e.from}-${e.to}`)
                ? "tree-edge active"
                : "tree-edge";
              return `<line class="${cls}" x1="${e.x1}" y1="${e.y1}" x2="${e.x2}" y2="${e.y2}"/>`;
            })
            .join("");
          const nodeSvg = positions
            .map((p) => {
              let cls = "tree-node-circle";
              if (highlights.active === p.val) cls += " active";
              if (highlights.found === p.val) cls += " found";
              if (highlights.inserting === p.val) cls += " inserting";
              return `<g><circle class="${cls}" cx="${p.x}" cy="${p.y}" r="22"/>
        <text class="tree-node-text" x="${p.x}" y="${p.y}">${p.val}</text></g>`;
            })
            .join("");
          canvas.innerHTML = `<svg class="tree-svg" viewBox="0 0 800 380">${edgeSvg}${nodeSvg}</svg>`;
        },
        async animatedInsert() {
          const val = +document.getElementById("ctrl-value").value;
          if (App.isAnimating) return;
          App.isAnimating = true;
          clearLog();
          log(`Inserting <span class="accent">${val}</span> into BST`);

          if (!this.root) {
            this.insertNode(val);
            this.render(null, { inserting: val });
            setStepText(`Inserted <span>${val}</span> as root`);
            log(`<span class="done">Inserted ${val} as root</span>`);
            App.isAnimating = false;
            document.getElementById("ctrl-value").value = Math.floor(
              Math.random() * 90 + 1,
            );
            return;
          }

          let curr = this.root;
          const path = new Set();
          const edgeSet = new Set();

          while (curr && App.isAnimating) {
            path.add(curr.val);
            this.render(null, { active: curr.val, edges: edgeSet });
            setStepText(
              `Comparing <span>${val}</span> with <span>${curr.val}</span>`,
            );
            await sleep(App.animSpeed);

            if (val < curr.val) {
              log(`${val} < ${curr.val} ‚Üí go left`);
              edgeSet.add(`${curr.val}-${curr.left ? curr.left.val : ""}`);
              if (!curr.left) {
                curr.left = { val, left: null, right: null };
                this.render(null, { inserting: val, edges: edgeSet });
                setStepText(
                  `<span class="done">Inserted ${val} as left child of ${curr.val}</span>`,
                );
                log(`<span class="done">Inserted ${val}</span>`);
                break;
              }
              curr = curr.left;
            } else if (val > curr.val) {
              log(`${val} > ${curr.val} ‚Üí go right`);
              edgeSet.add(`${curr.val}-${curr.right ? curr.right.val : ""}`);
              if (!curr.right) {
                curr.right = { val, left: null, right: null };
                this.render(null, { inserting: val, edges: edgeSet });
                setStepText(
                  `<span class="done">Inserted ${val} as right child of ${curr.val}</span>`,
                );
                log(`<span class="done">Inserted ${val}</span>`);
                break;
              }
              curr = curr.right;
            } else {
              setStepText(
                `<span style="color:var(--accent-3);">${val} already exists!</span>`,
              );
              log(`<span class="swap">${val} is a duplicate</span>`);
              break;
            }
          }
          App.isAnimating = false;
          document.getElementById("ctrl-value").value = Math.floor(
            Math.random() * 90 + 1,
          );
        },
        async animatedSearch() {
          const val = +document.getElementById("ctrl-value").value;
          if (App.isAnimating) return;
          App.isAnimating = true;
          clearLog();
          log(`Searching for <span class="accent">${val}</span>`);
          let curr = this.root;
          let steps = 0;

          while (curr && App.isAnimating) {
            steps++;
            this.render(null, { active: curr.val });
            setStepText(`Step ${steps}: checking <span>${curr.val}</span>`);
            setStepCounter(`Steps: ${steps}`);
            await sleep(App.animSpeed);

            if (val === curr.val) {
              this.render(null, { found: curr.val });
              setStepText(
                `<span class="done">‚úì Found ${val} in ${steps} steps!</span>`,
              );
              log(`<span class="done">Found ${val}!</span>`);
              App.isAnimating = false;
              return;
            } else if (val < curr.val) {
              log(`${val} < ${curr.val} ‚Üí go left`);
              curr = curr.left;
            } else {
              log(`${val} > ${curr.val} ‚Üí go right`);
              curr = curr.right;
            }
          }

          if (App.isAnimating) {
            setStepText(
              `<span style="color:var(--accent-3);">‚úó ${val} not found</span>`,
            );
            log(
              `<span class="swap">${val} not found</span> after ${steps} steps`,
            );
          }
          App.isAnimating = false;
        },
        async traverse(order) {
          if (App.isAnimating) return;
          App.isAnimating = true;
          clearLog();
          const result = [];
          log(
            `<span class="accent">${order.charAt(0).toUpperCase() + order.slice(1)} Traversal</span>`,
          );

          const visit = async (node) => {
            if (!node || !App.isAnimating) return;
            if (order === "preorder") {
              result.push(node.val);
              this.render(null, { found: node.val });
              setStepText(
                `Visiting <span>${node.val}</span> ‚Üí [${result.join(", ")}]`,
              );
              log(`Visit <span class="accent">${node.val}</span>`);
              await sleep(App.animSpeed);
            }
            await visit(node.left);
            if (order === "inorder") {
              result.push(node.val);
              this.render(null, { found: node.val });
              setStepText(
                `Visiting <span>${node.val}</span> ‚Üí [${result.join(", ")}]`,
              );
              log(`Visit <span class="accent">${node.val}</span>`);
              await sleep(App.animSpeed);
            }
            await visit(node.right);
            if (order === "postorder") {
              result.push(node.val);
              this.render(null, { found: node.val });
              setStepText(
                `Visiting <span>${node.val}</span> ‚Üí [${result.join(", ")}]`,
              );
              log(`Visit <span class="accent">${node.val}</span>`);
              await sleep(App.animSpeed);
            }
          };

          await visit(this.root);
          if (App.isAnimating) {
            setStepText(
              `<span class="done">‚úì ${order}: [${result.join(", ")}]</span>`,
            );
            log(`<span class="done">Result: [${result.join(", ")}]</span>`);
            this.render();
          }
          App.isAnimating = false;
        },
        reset() {
          stopAnimation();
          this.root = null;
          [40, 20, 60, 10, 30, 50, 70].forEach((v) => this.insertNode(v));
          this.render();
          clearLog();
          log("BST reset to default");
          setStepText("BST reset ‚Äî ready");
        },
      };

      /* ========================================
   HELPER FUNCTIONS FOR BARS
   ======================================== */
      function setBarsClass(canvas, indices, cls, additive = false) {
        if (!additive) clearBarsClass(canvas);
        indices.forEach((i) => {
          const bar = canvas.children[i];
          if (bar) bar.classList.add(cls);
        });
      }

      function clearBarsClass(canvas) {
        Array.from(canvas.children).forEach((bar) => {
          bar.classList.remove(
            "comparing",
            "swapping",
            "active",
            "pivot",
            "found",
          );
        });
      }

      function clearBarsClassExcept(canvas, keepIndices, keepCls) {
        Array.from(canvas.children).forEach((bar, i) => {
          if (!keepIndices.includes(i)) {
            bar.classList.remove(
              "comparing",
              "swapping",
              "active",
              "pivot",
              "found",
            );
          }
        });
      }

      function markSorted(canvas, start, end) {
        for (let i = start; i < end && i < canvas.children.length; i++) {
          canvas.children[i].classList.add("sorted");
        }
      }

      function markAllSorted(canvas, len) {
        for (let i = 0; i < len; i++) {
          const bar = canvas.children[i];
          if (bar) {
            bar.classList.remove("comparing", "swapping", "active", "pivot");
            bar.classList.add("sorted");
            bar.style.opacity = "1";
          }
        }
      }

      /* ========================================
   INIT
   ======================================== */
      document.addEventListener("DOMContentLoaded", () => {
        initTheme();
        renderTopics();
        // Trigger hero animations
        const homePage = document.getElementById("page-home");
        requestAnimationFrame(() => {
          requestAnimationFrame(() => homePage.classList.add("visible"));
        });
      });
    </script>
  </body>
</html>
