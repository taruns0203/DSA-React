<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GCD of Strings - Brute Force Visualization</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --bg-dark: #0f0f1a;
        --bg-card: #1a1a2e;
        --bg-card-hover: #252542;
        --accent-primary: #6c5ce7;
        --accent-secondary: #a29bfe;
        --accent-success: #00cec9;
        --accent-warning: #fdcb6e;
        --accent-danger: #ff7675;
        --text-primary: #ffffff;
        --text-secondary: #b2b2c8;
        --text-muted: #6c6c8a;
        --border-color: #2d2d4a;
        --glow-primary: rgba(108, 92, 231, 0.3);
        --glow-success: rgba(0, 206, 201, 0.3);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: var(--bg-dark);
        color: var(--text-primary);
        min-height: 100vh;
        overflow-x: hidden;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
      }

      /* Header */
      .header {
        text-align: center;
        margin-bottom: 2rem;
        padding: 2rem;
        background: linear-gradient(
          135deg,
          var(--bg-card) 0%,
          rgba(108, 92, 231, 0.1) 100%
        );
        border-radius: 20px;
        border: 1px solid var(--border-color);
      }

      .header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        background: linear-gradient(
          135deg,
          var(--accent-primary),
          var(--accent-secondary)
        );
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 0.5rem;
      }

      .header .subtitle {
        color: var(--text-secondary);
        font-size: 1.1rem;
      }

      .badge {
        display: inline-block;
        padding: 0.4rem 1rem;
        background: rgba(255, 118, 117, 0.2);
        color: var(--accent-danger);
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
        margin-top: 1rem;
      }

      /* Whiteboard */
      .whiteboard {
        background: var(--bg-card);
        border-radius: 20px;
        border: 1px solid var(--border-color);
        padding: 2rem;
        margin-bottom: 2rem;
        position: relative;
        overflow: hidden;
      }

      .whiteboard::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(
          90deg,
          var(--accent-primary),
          var(--accent-secondary),
          var(--accent-success)
        );
      }

      .whiteboard-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .whiteboard-title .icon {
        width: 36px;
        height: 36px;
        background: linear-gradient(
          135deg,
          var(--accent-primary),
          var(--accent-secondary)
        );
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
      }

      /* Input Display */
      .input-section {
        display: flex;
        gap: 2rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }

      .input-box {
        flex: 1;
        min-width: 250px;
        background: var(--bg-dark);
        border-radius: 12px;
        padding: 1.25rem;
        border: 1px solid var(--border-color);
      }

      .input-label {
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .string-display {
        display: flex;
        gap: 4px;
        flex-wrap: wrap;
        margin-top: 0.75rem;
      }

      .char-box {
        width: 44px;
        height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: linear-gradient(
          135deg,
          var(--accent-primary),
          var(--accent-secondary)
        );
        border-radius: 8px;
        font-family: "JetBrains Mono", monospace;
        font-size: 1.1rem;
        font-weight: 600;
        transition: all 0.3s ease;
      }

      .char-box.str2 {
        background: linear-gradient(135deg, var(--accent-success), #00b894);
      }

      .char-box.highlight {
        transform: scale(1.15);
        box-shadow: 0 0 20px var(--glow-primary);
      }

      .char-box.candidate {
        background: linear-gradient(135deg, var(--accent-warning), #e17055);
        box-shadow: 0 0 15px rgba(253, 203, 110, 0.4);
      }

      .char-box.dimmed {
        opacity: 0.3;
      }

      /* Algorithm Steps */
      .algorithm-section {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 2rem;
      }

      @media (max-width: 900px) {
        .algorithm-section {
          grid-template-columns: 1fr;
        }
      }

      .step-card {
        background: var(--bg-dark);
        border-radius: 16px;
        padding: 1.5rem;
        border: 1px solid var(--border-color);
        transition: all 0.3s ease;
      }

      .step-card.active {
        border-color: var(--accent-primary);
        box-shadow: 0 0 30px var(--glow-primary);
      }

      .step-card.completed {
        border-color: var(--accent-success);
        background: rgba(0, 206, 201, 0.05);
      }

      .step-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
      }

      .step-number {
        width: 32px;
        height: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: var(--bg-card);
        border-radius: 50%;
        font-weight: 600;
        font-size: 0.9rem;
        border: 2px solid var(--border-color);
      }

      .step-card.active .step-number {
        background: var(--accent-primary);
        border-color: var(--accent-primary);
      }

      .step-card.completed .step-number {
        background: var(--accent-success);
        border-color: var(--accent-success);
      }

      .step-title {
        font-weight: 600;
        font-size: 1rem;
      }

      .step-content {
        color: var(--text-secondary);
        font-size: 0.95rem;
        line-height: 1.6;
      }

      .step-content code {
        background: var(--bg-card);
        padding: 0.2rem 0.5rem;
        border-radius: 4px;
        font-family: "JetBrains Mono", monospace;
        font-size: 0.85rem;
        color: var(--accent-secondary);
      }

      /* Visualization Area */
      .visualization-area {
        background: var(--bg-dark);
        border-radius: 16px;
        padding: 2rem;
        border: 1px solid var(--border-color);
        min-height: 300px;
        margin-bottom: 2rem;
      }

      .viz-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 1.5rem;
        color: var(--text-secondary);
      }

      /* Candidate Testing */
      .candidate-section {
        margin-bottom: 2rem;
      }

      .candidate-display {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
      }

      .candidate-label {
        font-size: 0.9rem;
        color: var(--text-muted);
      }

      .candidate-value {
        font-family: "JetBrains Mono", monospace;
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--accent-warning);
        background: rgba(253, 203, 110, 0.1);
        padding: 0.5rem 1.5rem;
        border-radius: 10px;
        border: 2px solid var(--accent-warning);
      }

      .candidate-length {
        font-size: 0.9rem;
        color: var(--text-secondary);
        background: var(--bg-card);
        padding: 0.5rem 1rem;
        border-radius: 8px;
      }

      /* Construction Test */
      .construction-test {
        background: var(--bg-card);
        border-radius: 12px;
        padding: 1.5rem;
        margin-bottom: 1rem;
      }

      .construction-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
      }

      .construction-title {
        font-weight: 500;
        color: var(--text-secondary);
      }

      .construction-result {
        padding: 0.3rem 0.8rem;
        border-radius: 20px;
        font-size: 0.85rem;
        font-weight: 500;
      }

      .construction-result.success {
        background: rgba(0, 206, 201, 0.2);
        color: var(--accent-success);
      }

      .construction-result.fail {
        background: rgba(255, 118, 117, 0.2);
        color: var(--accent-danger);
      }

      .construction-result.pending {
        background: rgba(108, 92, 231, 0.2);
        color: var(--accent-secondary);
      }

      .repeat-visualization {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin: 1rem 0;
      }

      .repeat-group {
        display: flex;
        gap: 2px;
        padding: 4px;
        border: 2px dashed var(--accent-warning);
        border-radius: 8px;
      }

      .repeat-group .char-box {
        width: 36px;
        height: 36px;
        font-size: 0.95rem;
        background: linear-gradient(135deg, var(--accent-warning), #e17055);
      }

      .repeat-symbol {
        color: var(--text-muted);
        font-size: 1.2rem;
      }

      .equals-symbol {
        color: var(--text-muted);
        font-size: 1.5rem;
        margin: 0 0.5rem;
      }

      .comparison-string {
        display: flex;
        gap: 2px;
      }

      .comparison-string .char-box {
        width: 36px;
        height: 36px;
        font-size: 0.95rem;
      }

      /* Progress Tracker */
      .progress-section {
        background: var(--bg-card);
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid var(--border-color);
      }

      .progress-title {
        font-size: 1rem;
        font-weight: 600;
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .iteration-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
        gap: 0.75rem;
      }

      .iteration-item {
        background: var(--bg-dark);
        border-radius: 10px;
        padding: 0.75rem;
        text-align: center;
        border: 2px solid transparent;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .iteration-item:hover {
        border-color: var(--accent-primary);
      }

      .iteration-item.current {
        border-color: var(--accent-primary);
        box-shadow: 0 0 15px var(--glow-primary);
      }

      .iteration-item.skipped {
        opacity: 0.4;
      }

      .iteration-item.success {
        border-color: var(--accent-success);
        background: rgba(0, 206, 201, 0.1);
      }

      .iteration-len {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--accent-secondary);
      }

      .iteration-status {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 0.25rem;
      }

      /* Controls */
      .controls {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 2rem;
        flex-wrap: wrap;
      }

      .btn {
        padding: 0.875rem 1.75rem;
        border-radius: 12px;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-primary {
        background: linear-gradient(
          135deg,
          var(--accent-primary),
          var(--accent-secondary)
        );
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px var(--glow-primary);
      }

      .btn-secondary {
        background: var(--bg-card);
        color: var(--text-primary);
        border: 2px solid var(--border-color);
      }

      .btn-secondary:hover {
        border-color: var(--accent-primary);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
      }

      /* Result Banner */
      .result-banner {
        background: linear-gradient(
          135deg,
          rgba(0, 206, 201, 0.2),
          rgba(0, 184, 148, 0.1)
        );
        border: 2px solid var(--accent-success);
        border-radius: 16px;
        padding: 2rem;
        text-align: center;
        margin-bottom: 2rem;
        display: none;
      }

      .result-banner.visible {
        display: block;
        animation: slideIn 0.5s ease;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .result-title {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--accent-success);
        margin-bottom: 0.5rem;
      }

      .result-value {
        font-family: "JetBrains Mono", monospace;
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin: 1rem 0;
      }

      .result-explanation {
        color: var(--text-secondary);
      }

      /* Explanation Panel */
      .explanation-panel {
        background: var(--bg-card);
        border-radius: 16px;
        padding: 1.5rem;
        border: 1px solid var(--border-color);
        margin-top: 1rem;
      }

      .explanation-text {
        color: var(--text-secondary);
        line-height: 1.7;
        font-size: 0.95rem;
      }

      .explanation-text strong {
        color: var(--accent-secondary);
      }

      /* Complexity Box */
      .complexity-box {
        display: inline-flex;
        gap: 2rem;
        background: var(--bg-dark);
        padding: 1rem 1.5rem;
        border-radius: 12px;
        margin-top: 1rem;
      }

      .complexity-item {
        text-align: center;
      }

      .complexity-label {
        font-size: 0.75rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .complexity-value {
        font-family: "JetBrains Mono", monospace;
        font-size: 1.1rem;
        color: var(--accent-warning);
        font-weight: 600;
        margin-top: 0.25rem;
      }

      /* Speed Control */
      .speed-control {
        display: flex;
        align-items: center;
        gap: 1rem;
        background: var(--bg-dark);
        padding: 0.75rem 1.25rem;
        border-radius: 10px;
      }

      .speed-label {
        font-size: 0.85rem;
        color: var(--text-muted);
      }

      .speed-slider {
        -webkit-appearance: none;
        width: 120px;
        height: 6px;
        border-radius: 3px;
        background: var(--bg-card);
        outline: none;
      }

      .speed-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: var(--accent-primary);
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>üî§ GCD of Strings</h1>
        <p class="subtitle">Interactive Brute Force Algorithm Visualization</p>
        <span class="badge"
          >‚è±Ô∏è Time: O(min(m,n) √ó (m+n)) | üíæ Space: O(m+n)</span
        >
      </div>

      <!-- Input Display -->
      <div class="whiteboard">
        <div class="whiteboard-title">
          <span class="icon">üì•</span>
          Input Strings
        </div>

        <div class="input-section">
          <div class="input-box">
            <div class="input-label">str1 (length: 6)</div>
            <div class="string-display" id="str1-display"></div>
          </div>
          <div class="input-box">
            <div class="input-label">str2 (length: 4)</div>
            <div class="string-display" id="str2-display"></div>
          </div>
        </div>

        <div class="explanation-panel">
          <div class="explanation-text">
            <strong>Goal:</strong> Find the largest string <code>x</code> that,
            when repeated, can construct BOTH strings. The brute force approach
            tries <strong>every possible prefix length</strong> from longest to
            shortest.
          </div>
        </div>
      </div>

      <!-- Progress Tracker -->
      <div class="progress-section">
        <div class="progress-title">
          üìä Iteration Progress (Testing lengths from longest to shortest)
        </div>
        <div class="iteration-grid" id="iteration-grid"></div>
      </div>

      <!-- Visualization Area -->
      <div class="whiteboard">
        <div class="whiteboard-title">
          <span class="icon">üî¨</span>
          Current Candidate Test
        </div>

        <div class="visualization-area" id="viz-area">
          <div class="viz-title">Click "Start" to begin the visualization</div>
        </div>
      </div>

      <!-- Result Banner -->
      <div class="result-banner" id="result-banner">
        <div class="result-title">‚úÖ GCD String Found!</div>
        <div class="result-value" id="result-value">"AB"</div>
        <div class="result-explanation" id="result-explanation"></div>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button class="btn btn-primary" id="startBtn" onclick="start()">
          ‚ñ∂Ô∏è Start
        </button>
        <button
          class="btn btn-secondary"
          id="nextBtn"
          onclick="nextStep()"
          disabled
        >
          ‚è≠Ô∏è Next Step
        </button>
        <button class="btn btn-secondary" id="autoBtn" onclick="toggleAuto()">
          üîÑ Auto Play
        </button>
        <button class="btn btn-secondary" onclick="reset()">üîÅ Reset</button>
        <div class="speed-control">
          <span class="speed-label">Speed:</span>
          <input
            type="range"
            class="speed-slider"
            id="speedSlider"
            min="200"
            max="2000"
            value="1000"
          />
        </div>
      </div>

      <!-- Algorithm Steps -->
      <div class="whiteboard">
        <div class="whiteboard-title">
          <span class="icon">üìù</span>
          Algorithm Steps
        </div>

        <div class="algorithm-section">
          <div class="step-card" id="step1">
            <div class="step-header">
              <span class="step-number">1</span>
              <span class="step-title">Calculate Max Length</span>
            </div>
            <div class="step-content">
              Find <code>maxLen = min(len(str1), len(str2))</code><br />
              This is the longest possible divisor length.
            </div>
          </div>

          <div class="step-card" id="step2">
            <div class="step-header">
              <span class="step-number">2</span>
              <span class="step-title">Iterate Lengths</span>
            </div>
            <div class="step-content">
              For each <code>len</code> from <code>maxLen</code> down to
              <code>1</code>, check if this length could be a divisor.
            </div>
          </div>

          <div class="step-card" id="step3">
            <div class="step-header">
              <span class="step-number">3</span>
              <span class="step-title">Divisibility Check</span>
            </div>
            <div class="step-content">
              Skip if <code>len(str1) % len ‚â† 0</code> or
              <code>len(str2) % len ‚â† 0</code>. The candidate length must divide
              both string lengths evenly.
            </div>
          </div>

          <div class="step-card" id="step4">
            <div class="step-header">
              <span class="step-number">4</span>
              <span class="step-title">Verify Construction</span>
            </div>
            <div class="step-content">
              Extract <code>candidate = str1[0:len]</code> and verify that
              repeating it constructs both <code>str1</code> and
              <code>str2</code>.
            </div>
          </div>
        </div>

        <div class="complexity-box">
          <div class="complexity-item">
            <div class="complexity-label">Time Complexity</div>
            <div class="complexity-value">O(min(m,n) √ó (m+n))</div>
          </div>
          <div class="complexity-item">
            <div class="complexity-label">Space Complexity</div>
            <div class="complexity-value">O(m + n)</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Example: str1 = "ABABAB", str2 = "ABAB"
      const str1 = "ABABAB";
      const str2 = "ABAB";

      let currentStep = 0;
      let currentLen = Math.min(str1.length, str2.length);
      let isAutoPlaying = false;
      let autoPlayInterval = null;
      let phase = "init"; // 'init', 'check-divisibility', 'extract-candidate', 'verify-str1', 'verify-str2', 'found', 'done'

      // Initialize displays
      function initDisplays() {
        const str1Display = document.getElementById("str1-display");
        const str2Display = document.getElementById("str2-display");

        str1Display.innerHTML = str1
          .split("")
          .map((c) => `<div class="char-box">${c}</div>`)
          .join("");

        str2Display.innerHTML = str2
          .split("")
          .map((c) => `<div class="char-box str2">${c}</div>`)
          .join("");

        // Initialize iteration grid
        const grid = document.getElementById("iteration-grid");
        grid.innerHTML = "";
        for (let len = Math.min(str1.length, str2.length); len >= 1; len--) {
          const item = document.createElement("div");
          item.className = "iteration-item";
          item.id = `iter-${len}`;
          item.innerHTML = `
                    <div class="iteration-len">${len}</div>
                    <div class="iteration-status">Pending</div>
                `;
          item.onclick = () => jumpToLength(len);
          grid.appendChild(item);
        }
      }

      function start() {
        document.getElementById("startBtn").disabled = true;
        document.getElementById("nextBtn").disabled = false;
        currentLen = Math.min(str1.length, str2.length);
        phase = "check-divisibility";
        updateActiveStep(1);
        updateActiveStep(2);
        nextStep();
      }

      function nextStep() {
        const vizArea = document.getElementById("viz-area");

        if (phase === "check-divisibility") {
          // Check if current length divides both
          document
            .getElementById(`iter-${currentLen}`)
            .classList.add("current");
          updateActiveStep(3);

          const divides1 = str1.length % currentLen === 0;
          const divides2 = str2.length % currentLen === 0;

          let html = `
                    <div class="viz-title">Testing Length: ${currentLen}</div>
                    <div class="candidate-section">
                        <div class="candidate-display">
                            <span class="candidate-label">Candidate Length:</span>
                            <span class="candidate-value">${currentLen}</span>
                        </div>
                        
                        <div class="construction-test">
                            <div class="construction-header">
                                <span class="construction-title">Divisibility Check</span>
                                <span class="construction-result ${
                                  divides1 && divides2 ? "success" : "fail"
                                }">
                                    ${
                                      divides1 && divides2 ? "‚úì Pass" : "‚úó Fail"
                                    }
                                </span>
                            </div>
                            <div class="explanation-text">
                                <strong>len(str1) % ${currentLen}</strong> = ${
            str1.length
          } % ${currentLen} = ${str1.length % currentLen} ${
            divides1 ? "‚úì" : "‚úó"
          }<br>
                                <strong>len(str2) % ${currentLen}</strong> = ${
            str2.length
          } % ${currentLen} = ${str2.length % currentLen} ${
            divides2 ? "‚úì" : "‚úó"
          }
                            </div>
                        </div>
                    </div>
                `;

          vizArea.innerHTML = html;

          if (divides1 && divides2) {
            phase = "extract-candidate";
          } else {
            document
              .getElementById(`iter-${currentLen}`)
              .classList.remove("current");
            document
              .getElementById(`iter-${currentLen}`)
              .classList.add("skipped");
            document
              .getElementById(`iter-${currentLen}`)
              .querySelector(".iteration-status").textContent = "Skipped";
            currentLen--;
            if (currentLen < 1) {
              phase = "no-result";
            }
          }
        } else if (phase === "extract-candidate") {
          updateActiveStep(4);
          const candidate = str1.substring(0, currentLen);
          highlightCandidate(currentLen);

          let html = `
                    <div class="viz-title">Extracting Candidate: "${candidate}"</div>
                    <div class="candidate-section">
                        <div class="candidate-display">
                            <span class="candidate-label">Candidate String:</span>
                            <span class="candidate-value">"${candidate}"</span>
                            <span class="candidate-length">Length: ${currentLen}</span>
                        </div>
                        <div class="explanation-text">
                            Extracted first ${currentLen} characters from str1 as the candidate divisor.
                            Now we need to verify it can construct both strings.
                        </div>
                    </div>
                `;

          vizArea.innerHTML = html;
          phase = "verify-str1";
        } else if (phase === "verify-str1") {
          const candidate = str1.substring(0, currentLen);
          const repeatCount = str1.length / currentLen;
          const constructed = candidate.repeat(repeatCount);
          const matches = constructed === str1;

          let repeatHtml = "";
          for (let i = 0; i < repeatCount; i++) {
            repeatHtml += `
                        <div class="repeat-group">
                            ${candidate
                              .split("")
                              .map((c) => `<div class="char-box">${c}</div>`)
                              .join("")}
                        </div>
                    `;
            if (i < repeatCount - 1) {
              repeatHtml += '<span class="repeat-symbol">+</span>';
            }
          }

          let html = `
                    <div class="viz-title">Verifying: Can "${candidate}" construct str1?</div>
                    <div class="construction-test">
                        <div class="construction-header">
                            <span class="construction-title">Test: "${candidate}".repeat(${repeatCount}) === str1</span>
                            <span class="construction-result ${
                              matches ? "success" : "fail"
                            }">
                                ${matches ? "‚úì Match!" : "‚úó No Match"}
                            </span>
                        </div>
                        <div class="repeat-visualization">
                            ${repeatHtml}
                            <span class="equals-symbol">=</span>
                            <div class="comparison-string">
                                ${constructed
                                  .split("")
                                  .map(
                                    (c, i) =>
                                      `<div class="char-box ${
                                        c === str1[i] ? "" : "dimmed"
                                      }">${c}</div>`
                                  )
                                  .join("")}
                            </div>
                        </div>
                        <div class="explanation-text" style="margin-top: 1rem;">
                            Repeating "${candidate}" ${repeatCount} times gives "${constructed}"<br>
                            Comparing with str1 = "${str1}": <strong>${
            matches ? "MATCH ‚úì" : "NO MATCH ‚úó"
          }</strong>
                        </div>
                    </div>
                `;

          vizArea.innerHTML = html;

          if (matches) {
            phase = "verify-str2";
          } else {
            document
              .getElementById(`iter-${currentLen}`)
              .classList.remove("current");
            document
              .getElementById(`iter-${currentLen}`)
              .querySelector(".iteration-status").textContent = "Failed";
            currentLen--;
            phase = currentLen >= 1 ? "check-divisibility" : "no-result";
            clearHighlight();
          }
        } else if (phase === "verify-str2") {
          const candidate = str1.substring(0, currentLen);
          const repeatCount = str2.length / currentLen;
          const constructed = candidate.repeat(repeatCount);
          const matches = constructed === str2;

          let repeatHtml = "";
          for (let i = 0; i < repeatCount; i++) {
            repeatHtml += `
                        <div class="repeat-group">
                            ${candidate
                              .split("")
                              .map((c) => `<div class="char-box">${c}</div>`)
                              .join("")}
                        </div>
                    `;
            if (i < repeatCount - 1) {
              repeatHtml += '<span class="repeat-symbol">+</span>';
            }
          }

          let html = `
                    <div class="viz-title">Verifying: Can "${candidate}" construct str2?</div>
                    <div class="construction-test">
                        <div class="construction-header">
                            <span class="construction-title">Test: "${candidate}".repeat(${repeatCount}) === str2</span>
                            <span class="construction-result ${
                              matches ? "success" : "fail"
                            }">
                                ${matches ? "‚úì Match!" : "‚úó No Match"}
                            </span>
                        </div>
                        <div class="repeat-visualization">
                            ${repeatHtml}
                            <span class="equals-symbol">=</span>
                            <div class="comparison-string">
                                ${constructed
                                  .split("")
                                  .map(
                                    (c, i) =>
                                      `<div class="char-box str2 ${
                                        c === str2[i] ? "" : "dimmed"
                                      }">${c}</div>`
                                  )
                                  .join("")}
                            </div>
                        </div>
                        <div class="explanation-text" style="margin-top: 1rem;">
                            Repeating "${candidate}" ${repeatCount} times gives "${constructed}"<br>
                            Comparing with str2 = "${str2}": <strong>${
            matches ? "MATCH ‚úì" : "NO MATCH ‚úó"
          }</strong>
                        </div>
                    </div>
                `;

          vizArea.innerHTML = html;

          if (matches) {
            phase = "found";
            document
              .getElementById(`iter-${currentLen}`)
              .classList.remove("current");
            document
              .getElementById(`iter-${currentLen}`)
              .classList.add("success");
            document
              .getElementById(`iter-${currentLen}`)
              .querySelector(".iteration-status").textContent = "SUCCESS!";
          } else {
            document
              .getElementById(`iter-${currentLen}`)
              .classList.remove("current");
            document
              .getElementById(`iter-${currentLen}`)
              .querySelector(".iteration-status").textContent = "Failed";
            currentLen--;
            phase = currentLen >= 1 ? "check-divisibility" : "no-result";
            clearHighlight();
          }
        } else if (phase === "found") {
          const candidate = str1.substring(0, currentLen);
          const banner = document.getElementById("result-banner");
          document.getElementById(
            "result-value"
          ).textContent = `"${candidate}"`;
          document.getElementById("result-explanation").innerHTML = `
                    The string "<strong>${candidate}</strong>" (length ${currentLen}) divides both strings:<br>
                    ‚Ä¢ str1 = "${candidate}" √ó ${str1.length / currentLen}<br>
                    ‚Ä¢ str2 = "${candidate}" √ó ${str2.length / currentLen}
                `;
          banner.classList.add("visible");

          document.getElementById("nextBtn").disabled = true;
          stopAuto();
          phase = "done";

          // Mark all steps as completed
          for (let i = 1; i <= 4; i++) {
            document.getElementById(`step${i}`).classList.remove("active");
            document.getElementById(`step${i}`).classList.add("completed");
          }
        }
      }

      function highlightCandidate(len) {
        const boxes = document.querySelectorAll("#str1-display .char-box");
        boxes.forEach((box, i) => {
          if (i < len) {
            box.classList.add("candidate");
          } else {
            box.classList.add("dimmed");
          }
        });
      }

      function clearHighlight() {
        document.querySelectorAll(".char-box").forEach((box) => {
          box.classList.remove("candidate", "dimmed", "highlight");
        });
      }

      function updateActiveStep(stepNum) {
        for (let i = 1; i <= 4; i++) {
          const step = document.getElementById(`step${i}`);
          step.classList.remove("active");
          if (i < stepNum) {
            step.classList.add("completed");
          }
        }
        if (stepNum <= 4) {
          document.getElementById(`step${stepNum}`).classList.add("active");
        }
      }

      function jumpToLength(len) {
        if (phase === "done" || phase === "init") return;
        // Reset to that length
        clearHighlight();
        document.querySelectorAll(".iteration-item").forEach((item) => {
          item.classList.remove("current", "skipped", "success");
          item.querySelector(".iteration-status").textContent = "Pending";
        });
        currentLen = len;
        phase = "check-divisibility";
        document.getElementById("result-banner").classList.remove("visible");
      }

      function toggleAuto() {
        if (isAutoPlaying) {
          stopAuto();
        } else {
          startAuto();
        }
      }

      function startAuto() {
        if (phase === "done" || phase === "init") return;
        isAutoPlaying = true;
        document.getElementById("autoBtn").textContent = "‚è∏Ô∏è Pause";
        const speed = 2200 - document.getElementById("speedSlider").value;
        autoPlayInterval = setInterval(() => {
          if (phase !== "done") {
            nextStep();
          } else {
            stopAuto();
          }
        }, speed);
      }

      function stopAuto() {
        isAutoPlaying = false;
        document.getElementById("autoBtn").textContent = "üîÑ Auto Play";
        if (autoPlayInterval) {
          clearInterval(autoPlayInterval);
          autoPlayInterval = null;
        }
      }

      function reset() {
        stopAuto();
        currentLen = Math.min(str1.length, str2.length);
        phase = "init";
        document.getElementById("startBtn").disabled = false;
        document.getElementById("nextBtn").disabled = true;
        document.getElementById("result-banner").classList.remove("visible");
        document.getElementById("viz-area").innerHTML =
          '<div class="viz-title">Click "Start" to begin the visualization</div>';

        // Reset steps
        for (let i = 1; i <= 4; i++) {
          document
            .getElementById(`step${i}`)
            .classList.remove("active", "completed");
        }

        // Reset iteration grid
        document.querySelectorAll(".iteration-item").forEach((item) => {
          item.classList.remove("current", "skipped", "success");
          item.querySelector(".iteration-status").textContent = "Pending";
        });

        clearHighlight();
        initDisplays();
      }

      // Initialize on load
      initDisplays();
    </script>
  </body>
</html>
