<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Bubble Sort - Interactive Whiteboard</title>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Patrick+Hand&display=swap");

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Patrick Hand", cursive;
        background: #2c3e50;
        min-height: 100vh;
        padding: 20px;
      }

      .whiteboard {
        background: linear-gradient(
          135deg,
          #1a472a 0%,
          #2d5a3d 50%,
          #1a472a 100%
        );
        border-radius: 12px;
        padding: 40px;
        max-width: 1200px;
        margin: 0 auto;
        box-shadow:
          inset 0 0 100px rgba(0, 0, 0, 0.3),
          0 10px 40px rgba(0, 0, 0, 0.5);
        position: relative;
        overflow: hidden;
      }

      .whiteboard::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
        pointer-events: none;
      }

      .board-frame {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border: 15px solid #5d4037;
        border-radius: 12px;
        pointer-events: none;
        box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.3);
      }

      .title {
        font-family: "Caveat", cursive;
        font-size: 3.5rem;
        color: #fff;
        text-align: center;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        position: relative;
      }

      .subtitle {
        font-size: 1.4rem;
        color: #a8e6cf;
        text-align: center;
        margin-bottom: 30px;
        position: relative;
      }

      .chalk-line {
        height: 3px;
        background: linear-gradient(90deg, transparent, #fff, transparent);
        margin: 20px auto;
        width: 60%;
        opacity: 0.5;
      }

      .array-container {
        display: flex;
        justify-content: center;
        align-items: flex-end;
        gap: 15px;
        margin: 40px 0;
        min-height: 200px;
        position: relative;
      }

      .array-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: transform 0.3s ease;
      }

      .array-bar {
        width: 70px;
        background: linear-gradient(180deg, #ffeb3b 0%, #ffc107 100%);
        border: 3px solid #fff;
        border-radius: 8px 8px 4px 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        font-weight: bold;
        color: #333;
        transition: all 0.3s ease;
        position: relative;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      }

      .array-bar.comparing {
        background: linear-gradient(180deg, #ff7043 0%, #e64a19 100%);
        transform: scale(1.1);
        box-shadow: 0 0 30px rgba(255, 112, 67, 0.6);
      }

      .array-bar.swapping {
        background: linear-gradient(180deg, #e91e63 0%, #c2185b 100%);
        animation: shake 0.3s ease;
      }

      .array-bar.sorted {
        background: linear-gradient(180deg, #66bb6a 0%, #43a047 100%);
      }

      .array-bar.current-pass {
        border-color: #00bcd4;
        border-width: 4px;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-5px);
        }
        75% {
          transform: translateX(5px);
        }
      }

      .index-label {
        color: #90caf9;
        font-size: 1.1rem;
        margin-top: 10px;
      }

      .pointer-container {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 20px;
        min-height: 60px;
      }

      .pointer {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 70px;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .pointer.active {
        opacity: 1;
      }

      .pointer-arrow {
        font-size: 2rem;
        color: #ff5722;
        animation: bounce 0.5s ease infinite;
      }

      .pointer-label {
        color: #ffab91;
        font-size: 1rem;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .info-panel {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 12px;
        padding: 25px;
        margin: 30px 0;
        position: relative;
      }

      .pass-info {
        display: flex;
        justify-content: space-around;
        flex-wrap: wrap;
        gap: 20px;
      }

      .info-box {
        text-align: center;
      }

      .info-label {
        color: #a5d6a7;
        font-size: 1.1rem;
        margin-bottom: 5px;
      }

      .info-value {
        color: #fff;
        font-size: 2rem;
        font-family: "Caveat", cursive;
      }

      .status-message {
        text-align: center;
        font-size: 1.5rem;
        color: #fff;
        margin: 20px 0;
        min-height: 40px;
        position: relative;
      }

      .status-message.swap {
        color: #ff7043;
      }

      .status-message.no-swap {
        color: #81c784;
      }

      .status-message.complete {
        color: #4caf50;
        font-size: 2rem;
      }

      .controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
        margin-top: 30px;
        position: relative;
      }

      .btn {
        font-family: "Patrick Hand", cursive;
        font-size: 1.2rem;
        padding: 12px 30px;
        border: none;
        border-radius: 30px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: linear-gradient(180deg, #4caf50 0%, #388e3c 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
      }

      .btn-secondary {
        background: linear-gradient(180deg, #2196f3 0%, #1976d2 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
      }

      .btn-warning {
        background: linear-gradient(180deg, #ff9800 0%, #f57c00 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
      }

      .btn-danger {
        background: linear-gradient(180deg, #f44336 0%, #d32f2f 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(244, 67, 54, 0.4);
      }

      .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
      }

      .btn:active {
        transform: translateY(0);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
      }

      .speed-control {
        display: flex;
        align-items: center;
        gap: 15px;
        justify-content: center;
        margin-top: 20px;
        position: relative;
      }

      .speed-label {
        color: #fff;
        font-size: 1.2rem;
      }

      .speed-slider {
        width: 150px;
        height: 8px;
        -webkit-appearance: none;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 4px;
        outline: none;
      }

      .speed-slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 24px;
        height: 24px;
        background: #ffeb3b;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      }

      .legend {
        display: flex;
        justify-content: center;
        gap: 30px;
        flex-wrap: wrap;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 2px dashed rgba(255, 255, 255, 0.2);
        position: relative;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .legend-color {
        width: 30px;
        height: 30px;
        border-radius: 6px;
        border: 2px solid #fff;
      }

      .legend-text {
        color: #fff;
        font-size: 1.1rem;
      }

      .complexity-box {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 12px;
        padding: 20px;
        margin-top: 30px;
        text-align: center;
        position: relative;
      }

      .complexity-title {
        color: #a5d6a7;
        font-size: 1.3rem;
        margin-bottom: 15px;
      }

      .complexity-grid {
        display: flex;
        justify-content: center;
        gap: 40px;
        flex-wrap: wrap;
      }

      .complexity-item {
        text-align: center;
      }

      .complexity-label {
        color: #90caf9;
        font-size: 1rem;
      }

      .complexity-value {
        color: #ffeb3b;
        font-size: 1.8rem;
        font-family: "Caveat", cursive;
      }

      .step-explanation {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 10px;
        padding: 20px;
        margin: 20px 0;
        border-left: 5px solid #ffeb3b;
        position: relative;
      }

      .step-explanation h3 {
        color: #ffeb3b;
        font-size: 1.4rem;
        margin-bottom: 10px;
      }

      .step-explanation p {
        color: #fff;
        font-size: 1.2rem;
        line-height: 1.6;
      }

      .code-display {
        font-family: "Courier New", monospace;
        color: #a5d6a7;
        font-size: 1.1rem;
        background: rgba(0, 0, 0, 0.3);
        padding: 10px 15px;
        border-radius: 8px;
        margin-top: 10px;
      }

      .highlight {
        background: rgba(255, 235, 59, 0.3);
        padding: 2px 6px;
        border-radius: 4px;
      }

      .comparison-visual {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin: 20px 0;
        font-size: 2rem;
        color: #fff;
      }

      .comparison-symbol {
        font-size: 3rem;
        color: #ff7043;
      }
    </style>
  </head>
  <body>
    <div class="whiteboard">
      <div class="board-frame"></div>

      <h1 class="title">üìö Bubble Sort Algorithm</h1>
      <p class="subtitle">Watch the largest elements "bubble up" to the end!</p>

      <div class="chalk-line"></div>

      <div class="step-explanation">
        <h3>üéØ Current Step:</h3>
        <p id="explanation">
          Click "Start" to begin the visualization. We'll sort the array [4, 1,
          3, 9, 7] step by step!
        </p>
        <div class="code-display" id="code-highlight">// Ready to start...</div>
      </div>

      <div class="array-container" id="array-container">
        <!-- Array bars will be generated here -->
      </div>

      <div class="pointer-container" id="pointer-container">
        <!-- Pointers will be generated here -->
      </div>

      <div
        class="comparison-visual"
        id="comparison-visual"
        style="display: none"
      >
        <span id="left-compare">4</span>
        <span class="comparison-symbol" id="compare-symbol">?</span>
        <span id="right-compare">1</span>
      </div>

      <div class="status-message" id="status-message">
        Press "Start" to begin sorting!
      </div>

      <div class="info-panel">
        <div class="pass-info">
          <div class="info-box">
            <div class="info-label">Current Pass</div>
            <div class="info-value" id="current-pass">0 / 4</div>
          </div>
          <div class="info-box">
            <div class="info-label">Comparisons</div>
            <div class="info-value" id="comparisons">0</div>
          </div>
          <div class="info-box">
            <div class="info-label">Swaps</div>
            <div class="info-value" id="swaps">0</div>
          </div>
          <div class="info-box">
            <div class="info-label">Array State</div>
            <div class="info-value" id="array-state">[4, 1, 3, 9, 7]</div>
          </div>
        </div>
      </div>

      <div class="controls">
        <button class="btn btn-primary" id="start-btn" onclick="startSort()">
          ‚ñ∂Ô∏è Start
        </button>
        <button
          class="btn btn-secondary"
          id="step-btn"
          onclick="nextStep()"
          disabled
        >
          ‚è≠Ô∏è Next Step
        </button>
        <button
          class="btn btn-warning"
          id="auto-btn"
          onclick="toggleAuto()"
          disabled
        >
          üîÑ Auto Play
        </button>
        <button class="btn btn-danger" id="reset-btn" onclick="resetSort()">
          üîÉ Reset
        </button>
      </div>

      <div class="speed-control">
        <span class="speed-label">Speed:</span>
        <input
          type="range"
          class="speed-slider"
          id="speed-slider"
          min="100"
          max="2000"
          value="800"
        />
        <span class="speed-label" id="speed-value">Medium</span>
      </div>

      <div class="legend">
        <div class="legend-item">
          <div
            class="legend-color"
            style="
              background: linear-gradient(180deg, #ffeb3b 0%, #ffc107 100%);
            "
          ></div>
          <span class="legend-text">Unsorted</span>
        </div>
        <div class="legend-item">
          <div
            class="legend-color"
            style="
              background: linear-gradient(180deg, #ff7043 0%, #e64a19 100%);
            "
          ></div>
          <span class="legend-text">Comparing</span>
        </div>
        <div class="legend-item">
          <div
            class="legend-color"
            style="
              background: linear-gradient(180deg, #e91e63 0%, #c2185b 100%);
            "
          ></div>
          <span class="legend-text">Swapping</span>
        </div>
        <div class="legend-item">
          <div
            class="legend-color"
            style="
              background: linear-gradient(180deg, #66bb6a 0%, #43a047 100%);
            "
          ></div>
          <span class="legend-text">Sorted</span>
        </div>
      </div>

      <div class="complexity-box">
        <div class="complexity-title">üìä Time & Space Complexity</div>
        <div class="complexity-grid">
          <div class="complexity-item">
            <div class="complexity-label">Best Case</div>
            <div class="complexity-value">O(n)</div>
          </div>
          <div class="complexity-item">
            <div class="complexity-label">Average Case</div>
            <div class="complexity-value">O(n¬≤)</div>
          </div>
          <div class="complexity-item">
            <div class="complexity-label">Worst Case</div>
            <div class="complexity-value">O(n¬≤)</div>
          </div>
          <div class="complexity-item">
            <div class="complexity-label">Space</div>
            <div class="complexity-value">O(1)</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Initial array
      const originalArray = [4, 1, 3, 9, 7];
      let array = [...originalArray];
      let n = array.length;

      // State variables
      let currentPass = 0;
      let currentIndex = 0;
      let comparisons = 0;
      let swapCount = 0;
      let sortedIndices = new Set();
      let isRunning = false;
      let isAutoPlay = false;
      let autoPlayInterval = null;
      let currentPhase = "idle"; // idle, comparing, swapping, done

      // Speed control
      const speedSlider = document.getElementById("speed-slider");
      speedSlider.addEventListener("input", updateSpeed);

      function updateSpeed() {
        const value = speedSlider.value;
        const label = document.getElementById("speed-value");
        if (value < 500) label.textContent = "Fast";
        else if (value < 1200) label.textContent = "Medium";
        else label.textContent = "Slow";
      }

      function getSpeed() {
        return parseInt(speedSlider.value);
      }

      // Initialize visualization
      function initVisualization() {
        const container = document.getElementById("array-container");
        const pointerContainer = document.getElementById("pointer-container");
        container.innerHTML = "";
        pointerContainer.innerHTML = "";

        array.forEach((value, index) => {
          // Create array item
          const item = document.createElement("div");
          item.className = "array-item";

          const bar = document.createElement("div");
          bar.className = "array-bar";
          bar.id = `bar-${index}`;
          bar.style.height = `${value * 20 + 40}px`;
          bar.textContent = value;

          const label = document.createElement("div");
          label.className = "index-label";
          label.textContent = `[${index}]`;

          item.appendChild(bar);
          item.appendChild(label);
          container.appendChild(item);

          // Create pointer placeholder
          const pointer = document.createElement("div");
          pointer.className = "pointer";
          pointer.id = `pointer-${index}`;
          pointer.innerHTML = `
                    <div class="pointer-arrow">‚Üë</div>
                    <div class="pointer-label">j</div>
                `;
          pointerContainer.appendChild(pointer);
        });

        updateArrayState();
      }

      function updateArrayState() {
        document.getElementById("array-state").textContent =
          `[${array.join(", ")}]`;
      }

      function updateInfo() {
        document.getElementById("current-pass").textContent =
          `${currentPass} / ${n - 1}`;
        document.getElementById("comparisons").textContent = comparisons;
        document.getElementById("swaps").textContent = swapCount;
      }

      function clearHighlights() {
        document.querySelectorAll(".array-bar").forEach((bar) => {
          bar.classList.remove("comparing", "swapping");
        });
        document.querySelectorAll(".pointer").forEach((p) => {
          p.classList.remove("active");
        });
        document.getElementById("comparison-visual").style.display = "none";
      }

      function highlightBars(indices, className) {
        indices.forEach((i) => {
          const bar = document.getElementById(`bar-${i}`);
          if (bar) bar.classList.add(className);
        });
      }

      function showPointer(index, label = "j") {
        const pointer = document.getElementById(`pointer-${index}`);
        if (pointer) {
          pointer.classList.add("active");
          pointer.querySelector(".pointer-label").textContent = label;
        }
      }

      function markSorted(index) {
        sortedIndices.add(index);
        const bar = document.getElementById(`bar-${index}`);
        if (bar) bar.classList.add("sorted");
      }

      function showComparison(leftIdx, rightIdx) {
        const visual = document.getElementById("comparison-visual");
        visual.style.display = "flex";
        document.getElementById("left-compare").textContent = array[leftIdx];
        document.getElementById("right-compare").textContent = array[rightIdx];
        document.getElementById("compare-symbol").textContent =
          array[leftIdx] > array[rightIdx] ? ">" : "‚â§";
      }

      function setExplanation(title, text, code) {
        document.querySelector(".step-explanation h3").textContent = title;
        document.querySelector(".step-explanation p").textContent = text;
        document.getElementById("code-highlight").innerHTML = code;
      }

      function setStatus(message, className = "") {
        const status = document.getElementById("status-message");
        status.textContent = message;
        status.className = "status-message " + className;
      }

      function swapElements(i, j) {
        // Swap in array
        [array[i], array[j]] = [array[j], array[i]];

        // Visual swap
        const bar1 = document.getElementById(`bar-${i}`);
        const bar2 = document.getElementById(`bar-${j}`);

        const temp = bar1.textContent;
        const tempHeight = bar1.style.height;

        bar1.textContent = bar2.textContent;
        bar1.style.height = bar2.style.height;

        bar2.textContent = temp;
        bar2.style.height = tempHeight;

        // Update sorted status
        if (sortedIndices.has(i)) {
          bar1.classList.add("sorted");
        }
        if (sortedIndices.has(j)) {
          bar2.classList.add("sorted");
        }

        updateArrayState();
      }

      function startSort() {
        if (isRunning) return;
        isRunning = true;
        currentPhase = "comparing";

        document.getElementById("start-btn").disabled = true;
        document.getElementById("step-btn").disabled = false;
        document.getElementById("auto-btn").disabled = false;

        // Initialize first step
        currentPass = 0;
        currentIndex = 0;

        setExplanation(
          "üöÄ Starting Bubble Sort!",
          `We'll make ${n - 1} passes through the array. In each pass, we compare adjacent elements and swap if needed. The largest unsorted element "bubbles up" to its correct position.`,
          `for (i = 0; i < n-1; i++) {<br>&nbsp;&nbsp;for (j = 0; j < n-i-1; j++) {<br>&nbsp;&nbsp;&nbsp;&nbsp;<span class="highlight">// Compare arr[j] and arr[j+1]</span><br>&nbsp;&nbsp;}<br>}`,
        );

        prepareComparison();
      }

      function prepareComparison() {
        if (currentPass >= n - 1) {
          finishSort();
          return;
        }

        if (currentIndex >= n - currentPass - 1) {
          // End of current pass
          markSorted(n - currentPass - 1);
          currentPass++;
          currentIndex = 0;

          if (currentPass >= n - 1) {
            markSorted(0);
            finishSort();
            return;
          }

          setStatus(
            `Pass ${currentPass} complete! Starting pass ${currentPass + 1}...`,
          );
          setExplanation(
            `üìç Pass ${currentPass + 1} Starting`,
            `The largest ${currentPass} element(s) are now in their final positions (shown in green). We'll now make another pass to bubble up the next largest element.`,
            `// Pass ${currentPass + 1}<br>for (j = 0; j < ${n - currentPass - 1}; j++) {<br>&nbsp;&nbsp;<span class="highlight">// Compare elements</span><br>}`,
          );
        }

        clearHighlights();
        // Re-apply sorted highlights
        sortedIndices.forEach((i) => markSorted(i));

        currentPhase = "comparing";
        updateInfo();
      }

      function nextStep() {
        if (!isRunning || currentPhase === "done") return;

        if (currentPhase === "comparing") {
          // Show comparison
          clearHighlights();
          sortedIndices.forEach((i) => markSorted(i));

          highlightBars([currentIndex, currentIndex + 1], "comparing");
          showPointer(currentIndex, "j");
          showPointer(currentIndex + 1, "j+1");
          showComparison(currentIndex, currentIndex + 1);

          comparisons++;

          if (array[currentIndex] > array[currentIndex + 1]) {
            setExplanation(
              `üîç Comparing arr[${currentIndex}] and arr[${currentIndex + 1}]`,
              `${array[currentIndex]} > ${array[currentIndex + 1]}? YES! These elements are in wrong order. We need to SWAP them!`,
              `if (arr[${currentIndex}] > arr[${currentIndex + 1}]) {<br>&nbsp;&nbsp;<span class="highlight">// ${array[currentIndex]} > ${array[currentIndex + 1]} ‚Üí SWAP!</span><br>}`,
            );
            setStatus(
              `${array[currentIndex]} > ${array[currentIndex + 1]} ‚Äî Need to swap!`,
              "swap",
            );
            currentPhase = "swapping";
          } else {
            setExplanation(
              `üîç Comparing arr[${currentIndex}] and arr[${currentIndex + 1}]`,
              `${array[currentIndex]} > ${array[currentIndex + 1]}? NO! Elements are already in correct order. Move to next pair.`,
              `if (arr[${currentIndex}] > arr[${currentIndex + 1}]) {<br>&nbsp;&nbsp;// ${array[currentIndex]} ‚â§ ${array[currentIndex + 1]} ‚Üí <span class="highlight">No swap needed</span><br>}`,
            );
            setStatus(
              `${array[currentIndex]} ‚â§ ${array[currentIndex + 1]} ‚Äî Already in order!`,
              "no-swap",
            );
            currentIndex++;
            prepareComparison();
          }

          updateInfo();
        } else if (currentPhase === "swapping") {
          // Perform swap
          highlightBars([currentIndex, currentIndex + 1], "swapping");

          const val1 = array[currentIndex];
          const val2 = array[currentIndex + 1];

          swapElements(currentIndex, currentIndex + 1);
          swapCount++;

          setExplanation(
            `üîÑ Swapping arr[${currentIndex}] and arr[${currentIndex + 1}]`,
            `Swapped ${val1} and ${val2}. The larger value (${val1}) has moved one position to the right, bubbling up toward its final position!`,
            `<span class="highlight">swap(arr[${currentIndex}], arr[${currentIndex + 1}])</span><br>// [${array.join(", ")}]`,
          );
          setStatus(`Swapped! Array is now [${array.join(", ")}]`, "swap");

          currentIndex++;
          currentPhase = "comparing";
          updateInfo();

          setTimeout(() => {
            prepareComparison();
          }, 300);
        }
      }

      function finishSort() {
        currentPhase = "done";
        isRunning = false;

        clearHighlights();
        // Mark all as sorted
        for (let i = 0; i < n; i++) {
          markSorted(i);
        }

        setExplanation(
          "‚úÖ Sorting Complete!",
          `The array is now fully sorted! We made ${currentPass + 1} passes, ${comparisons} comparisons, and ${swapCount} swaps. Notice how the largest elements bubbled up to the end first.`,
          `// Final sorted array:<br>// <span class="highlight">[${array.join(", ")}]</span>`,
        );
        setStatus("üéâ Array is sorted! [" + array.join(", ") + "]", "complete");

        document.getElementById("step-btn").disabled = true;
        document.getElementById("auto-btn").disabled = true;

        if (isAutoPlay) {
          toggleAuto();
        }
      }

      function toggleAuto() {
        isAutoPlay = !isAutoPlay;
        const btn = document.getElementById("auto-btn");

        if (isAutoPlay) {
          btn.textContent = "‚è∏Ô∏è Pause";
          btn.classList.remove("btn-warning");
          btn.classList.add("btn-danger");
          autoPlayInterval = setInterval(() => {
            if (currentPhase !== "done") {
              nextStep();
            } else {
              toggleAuto();
            }
          }, getSpeed());
        } else {
          btn.textContent = "üîÑ Auto Play";
          btn.classList.remove("btn-danger");
          btn.classList.add("btn-warning");
          if (autoPlayInterval) {
            clearInterval(autoPlayInterval);
            autoPlayInterval = null;
          }
        }
      }

      function resetSort() {
        // Stop auto play
        if (isAutoPlay) {
          toggleAuto();
        }

        // Reset state
        array = [...originalArray];
        currentPass = 0;
        currentIndex = 0;
        comparisons = 0;
        swapCount = 0;
        sortedIndices.clear();
        isRunning = false;
        currentPhase = "idle";

        // Reset UI
        document.getElementById("start-btn").disabled = false;
        document.getElementById("step-btn").disabled = true;
        document.getElementById("auto-btn").disabled = true;

        clearHighlights();
        initVisualization();
        updateInfo();

        setExplanation(
          "üéØ Current Step:",
          'Click "Start" to begin the visualization. We\'ll sort the array [4, 1, 3, 9, 7] step by step!',
          "// Ready to start...",
        );
        setStatus('Press "Start" to begin sorting!');
      }

      // Initialize on load
      initVisualization();
      updateInfo();
    </script>
  </body>
</html>
