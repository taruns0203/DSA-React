<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Remove Duplicates II - Two Pointers Visualization</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600;700&family=Patrick+Hand&family=Architects+Daughter&family=Permanent+Marker&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Caveat", cursive;
        background: linear-gradient(
          135deg,
          #1a1a2e 0%,
          #16213e 50%,
          #0f3460 100%
        );
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
      }

      .whiteboard {
        background: linear-gradient(
          145deg,
          #2d2d2d 0%,
          #1a1a1a 50%,
          #2d2d2d 100%
        );
        border-radius: 8px;
        padding: 35px 40px;
        width: 100%;
        max-width: 1250px;
        min-height: 750px;
        position: relative;
        box-shadow: 0 25px 80px rgba(0, 0, 0, 0.6),
          inset 0 1px 0 rgba(255, 255, 255, 0.05),
          inset 0 -1px 0 rgba(0, 0, 0, 0.3);
        border: 8px solid #4a4a4a;
        overflow: hidden;
      }

      .whiteboard::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: radial-gradient(
            ellipse at 20% 20%,
            rgba(255, 255, 255, 0.02) 0%,
            transparent 50%
          ),
          radial-gradient(
            ellipse at 80% 80%,
            rgba(255, 255, 255, 0.01) 0%,
            transparent 50%
          );
        pointer-events: none;
      }

      .board-edge {
        position: absolute;
        top: -8px;
        left: 50%;
        transform: translateX(-50%);
        width: 120px;
        height: 25px;
        background: linear-gradient(180deg, #6b6b6b, #4a4a4a);
        border-radius: 0 0 8px 8px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
      }

      .title {
        font-family: "Permanent Marker", cursive;
        font-size: 2rem;
        color: #fff;
        text-align: center;
        margin-bottom: 8px;
        text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.5);
        letter-spacing: 2px;
      }

      .subtitle {
        font-family: "Patrick Hand", cursive;
        font-size: 1.25rem;
        color: #00d9ff;
        text-align: center;
        margin-bottom: 20px;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.4);
      }

      .complexity-badge {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-bottom: 20px;
      }

      .badge {
        font-family: "Patrick Hand", cursive;
        font-size: 1rem;
        padding: 6px 16px;
        border-radius: 20px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .badge-time {
        color: #7fff7f;
      }

      .badge-space {
        color: #ff7fff;
      }

      .visualization-area {
        display: flex;
        flex-direction: column;
        gap: 20px;
      }

      .section {
        background: rgba(255, 255, 255, 0.03);
        border-radius: 12px;
        padding: 18px 22px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        position: relative;
      }

      .section-title {
        font-family: "Patrick Hand", cursive;
        font-size: 1.2rem;
        color: #ffaa00;
        margin-bottom: 12px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .section-icon {
        font-size: 1.3rem;
      }

      /* Linked List Container */
      .linked-list-wrapper {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 110px;
        position: relative;
      }

      .linked-list-container {
        display: flex;
        align-items: center;
        gap: 3px;
      }

      .node-group {
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
      }

      .pointer-labels {
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 32px;
        margin-bottom: 5px;
      }

      .pointer-label {
        font-family: "Patrick Hand", cursive;
        font-size: 0.85rem;
        padding: 2px 8px;
        border-radius: 4px;
        opacity: 0;
        transform: translateY(-5px);
        transition: all 0.3s ease;
        white-space: nowrap;
      }

      .pointer-label.visible {
        opacity: 1;
        transform: translateY(0);
      }

      .pointer-label.prev-label {
        background: rgba(255, 107, 107, 0.3);
        color: #ff6b6b;
        border: 1px solid #ff6b6b;
      }

      .pointer-label.head-label {
        background: rgba(0, 255, 127, 0.3);
        color: #00ff7f;
        border: 1px solid #00ff7f;
      }

      .node-element {
        display: flex;
        align-items: center;
      }

      .node-box {
        width: 52px;
        height: 52px;
        border: 3px solid #888;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Caveat", cursive;
        font-size: 1.7rem;
        font-weight: 700;
        color: #fff;
        position: relative;
        transition: all 0.35s ease;
        background: rgba(255, 255, 255, 0.03);
      }

      .node-box.dummy {
        border-color: #888;
        color: #888;
        font-size: 1.1rem;
        background: rgba(136, 136, 136, 0.1);
      }

      .node-box.prev-node {
        border-color: #ff6b6b;
        box-shadow: 0 0 20px rgba(255, 107, 107, 0.5),
          inset 0 0 15px rgba(255, 107, 107, 0.1);
      }

      .node-box.head-node {
        border-color: #00ff7f;
        box-shadow: 0 0 20px rgba(0, 255, 127, 0.5),
          inset 0 0 15px rgba(0, 255, 127, 0.1);
        transform: scale(1.08);
      }

      .node-box.duplicate-detected {
        border-color: #ff4757;
        background: rgba(255, 71, 87, 0.2);
        animation: pulse-red 0.6s ease-in-out;
      }

      .node-box.safe {
        border-color: #2ed573;
        background: rgba(46, 213, 115, 0.15);
      }

      .node-box.removed {
        opacity: 0.25;
        border-style: dashed;
        transform: scale(0.9);
      }

      .node-box.kept {
        border-color: #00ff7f;
        background: rgba(0, 255, 127, 0.2);
        box-shadow: 0 0 15px rgba(0, 255, 127, 0.4);
      }

      .node-box.skipping {
        animation: shake 0.4s ease-in-out;
        border-color: #ff4757;
      }

      @keyframes pulse-red {
        0%,
        100% {
          box-shadow: 0 0 20px rgba(255, 71, 87, 0.5);
        }
        50% {
          box-shadow: 0 0 35px rgba(255, 71, 87, 0.8);
        }
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-4px);
        }
        75% {
          transform: translateX(4px);
        }
      }

      .arrow {
        font-size: 1.3rem;
        color: #666;
        margin: 0 2px;
        transition: all 0.3s ease;
      }

      .arrow.broken {
        color: #ff4757;
        opacity: 0.3;
      }

      .arrow.connected {
        color: #2ed573;
      }

      .null-node {
        font-family: "Patrick Hand", cursive;
        font-size: 1.1rem;
        color: #666;
        padding: 8px;
      }

      /* Pointer State Panel */
      .pointer-state {
        display: flex;
        justify-content: center;
        gap: 40px;
        flex-wrap: wrap;
      }

      .state-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px 20px;
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .state-label {
        font-family: "Patrick Hand", cursive;
        font-size: 1.1rem;
        color: rgba(255, 255, 255, 0.7);
      }

      .state-value {
        font-family: "Caveat", cursive;
        font-size: 1.5rem;
        font-weight: 700;
        padding: 5px 15px;
        border-radius: 8px;
        min-width: 50px;
        text-align: center;
      }

      .state-value.prev-value {
        background: rgba(255, 107, 107, 0.2);
        color: #ff6b6b;
        border: 2px solid #ff6b6b;
      }

      .state-value.head-value {
        background: rgba(0, 255, 127, 0.2);
        color: #00ff7f;
        border: 2px solid #00ff7f;
      }

      .state-value.prevnext-value {
        background: rgba(135, 206, 235, 0.2);
        color: #87ceeb;
        border: 2px solid #87ceeb;
      }

      /* Action Panel */
      .action-panel {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 15px 20px;
        border-left: 4px solid #00d9ff;
      }

      .action-text {
        font-family: "Patrick Hand", cursive;
        font-size: 1.2rem;
        color: #fff;
        line-height: 1.6;
      }

      .action-text .hl-prev {
        color: #ff6b6b;
        font-weight: 600;
      }

      .action-text .hl-head {
        color: #00ff7f;
        font-weight: 600;
      }

      .action-text .hl-value {
        color: #00d9ff;
        font-weight: 600;
      }

      .action-text .hl-action {
        color: #ffd700;
        font-weight: 600;
      }

      .action-text .hl-skip {
        color: #ff4757;
        font-weight: 600;
      }

      /* Code Panel */
      .code-panel {
        background: rgba(0, 0, 0, 0.4);
        border-radius: 8px;
        padding: 12px 15px;
        margin-top: 12px;
        font-family: "Courier New", monospace;
        font-size: 0.85rem;
        border: 1px solid rgba(255, 255, 255, 0.08);
      }

      .code-line {
        padding: 4px 10px;
        color: rgba(255, 255, 255, 0.5);
        border-radius: 4px;
        transition: all 0.3s ease;
        margin: 2px 0;
      }

      .code-line.active {
        background: rgba(0, 217, 255, 0.15);
        color: #00d9ff;
        border-left: 3px solid #00d9ff;
      }

      .code-line .keyword {
        color: #ff79c6;
      }

      .code-line .var {
        color: #8be9fd;
      }

      .code-line .comment {
        color: #6272a4;
        font-style: italic;
      }

      /* Safe Zone Indicator */
      .zone-indicator {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 20px;
        margin-top: 10px;
      }

      .zone {
        font-family: "Patrick Hand", cursive;
        font-size: 1rem;
        padding: 6px 16px;
        border-radius: 20px;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .zone-safe {
        background: rgba(46, 213, 115, 0.2);
        color: #2ed573;
        border: 1px dashed #2ed573;
      }

      .zone-danger {
        background: rgba(255, 71, 87, 0.2);
        color: #ff4757;
        border: 1px dashed #ff4757;
      }

      /* Progress */
      .progress-section {
        display: flex;
        align-items: center;
        gap: 15px;
        margin-top: 15px;
      }

      .progress-label {
        font-family: "Patrick Hand", cursive;
        font-size: 0.95rem;
        color: rgba(255, 255, 255, 0.6);
        min-width: 70px;
      }

      .progress-track {
        flex: 1;
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #00d9ff, #00ff7f);
        border-radius: 3px;
        transition: width 0.3s ease;
      }

      .step-display {
        font-family: "Patrick Hand", cursive;
        font-size: 0.95rem;
        color: #00d9ff;
        min-width: 65px;
        text-align: right;
      }

      /* Controls */
      .controls {
        display: flex;
        justify-content: center;
        gap: 12px;
        margin-top: 18px;
        flex-wrap: wrap;
      }

      .btn {
        font-family: "Patrick Hand", cursive;
        font-size: 1.05rem;
        padding: 10px 22px;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.25s ease;
        display: flex;
        align-items: center;
        gap: 6px;
        font-weight: 500;
      }

      .btn-prev {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-play {
        background: linear-gradient(135deg, #11998e, #38ef7d);
        color: white;
        box-shadow: 0 4px 15px rgba(56, 239, 125, 0.4);
      }

      .btn-next {
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      }

      .btn-reset {
        background: linear-gradient(135deg, #eb3349, #f45c43);
        color: white;
        box-shadow: 0 4px 15px rgba(235, 51, 73, 0.4);
      }

      .btn:hover:not(:disabled) {
        transform: translateY(-2px);
        filter: brightness(1.1);
      }

      .btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        transform: none !important;
      }

      /* Legend */
      .legend {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 15px;
        flex-wrap: wrap;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-family: "Patrick Hand", cursive;
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.7);
      }

      .legend-box {
        width: 18px;
        height: 18px;
        border-radius: 4px;
        border: 2px solid;
      }

      .legend-prev {
        border-color: #ff6b6b;
        box-shadow: 0 0 8px rgba(255, 107, 107, 0.5);
      }

      .legend-head {
        border-color: #00ff7f;
        box-shadow: 0 0 8px rgba(0, 255, 127, 0.5);
      }

      .legend-safe {
        border-color: #2ed573;
        background: rgba(46, 213, 115, 0.3);
      }

      .legend-removed {
        border-color: #ff4757;
        border-style: dashed;
        opacity: 0.5;
      }

      /* Keyboard */
      .keyboard-hint {
        text-align: center;
        margin-top: 12px;
        font-family: "Patrick Hand", cursive;
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.4);
      }

      .key {
        display: inline-block;
        background: rgba(255, 255, 255, 0.08);
        padding: 2px 8px;
        border-radius: 4px;
        margin: 0 2px;
        border: 1px solid rgba(255, 255, 255, 0.15);
      }

      /* Animation for connection changes */
      @keyframes reconnect {
        0% {
          opacity: 0.3;
        }
        50% {
          opacity: 1;
          color: #ffd700;
        }
        100% {
          opacity: 1;
        }
      }

      .arrow.reconnecting {
        animation: reconnect 0.5s ease;
      }

      /* Responsive */
      @media (max-width: 900px) {
        .whiteboard {
          padding: 20px;
        }

        .title {
          font-size: 1.5rem;
        }

        .node-box {
          width: 42px;
          height: 42px;
          font-size: 1.4rem;
        }

        .pointer-state {
          gap: 15px;
        }

        .state-item {
          padding: 8px 12px;
        }
      }
    </style>
  </head>
  <body>
    <div class="whiteboard">
      <div class="board-edge"></div>

      <h1 class="title">Remove Duplicates from Sorted List II</h1>
      <p class="subtitle">‚ú® In-Place Two Pointers Approach ‚ú®</p>

      <div class="complexity-badge">
        <span class="badge badge-time">‚è± Time: O(n)</span>
        <span class="badge badge-space">üíæ Space: O(1)</span>
      </div>

      <div class="visualization-area">
        <!-- Linked List Visualization -->
        <div class="section">
          <div class="section-title">
            <span class="section-icon">üîó</span>
            Linked List State
          </div>
          <div class="linked-list-wrapper">
            <div class="linked-list-container" id="linkedList"></div>
          </div>
          <div class="zone-indicator" id="zoneIndicator">
            <div class="zone zone-safe">‚úì Safe Zone (confirmed unique)</div>
            <div class="zone zone-danger">? Danger Zone (under inspection)</div>
          </div>
        </div>

        <!-- Pointer States -->
        <div class="section">
          <div class="section-title">
            <span class="section-icon">üìç</span>
            Pointer Variables
          </div>
          <div class="pointer-state">
            <div class="state-item">
              <span class="state-label">prev ‚Üí</span>
              <span class="state-value prev-value" id="prevValue">dummy</span>
            </div>
            <div class="state-item">
              <span class="state-label">head ‚Üí</span>
              <span class="state-value head-value" id="headValue">1</span>
            </div>
            <div class="state-item">
              <span class="state-label">prev.next ‚Üí</span>
              <span class="state-value prevnext-value" id="prevNextValue"
                >1</span
              >
            </div>
          </div>
        </div>

        <!-- Action Description -->
        <div class="action-panel">
          <div class="action-text" id="actionText">
            Press <span class="hl-action">Play</span> or
            <span class="hl-action">Next</span> to begin the visualization!
          </div>
        </div>

        <!-- Code Panel -->
        <div class="code-panel">
          <div class="code-line" id="code1">
            <span class="keyword">while</span> (<span class="var">head</span>
            !== <span class="keyword">null</span>) {
          </div>
          <div class="code-line" id="code2">
            <span class="keyword">if</span> (<span class="var">head.next</span>
            && <span class="var">head.val</span> ===
            <span class="var">head.next.val</span>) {
            <span class="comment">// duplicate found</span>
          </div>
          <div class="code-line" id="code3">
            <span class="keyword">while</span> (<span class="var"
              >head.next</span
            >
            && <span class="var">head.val</span> ===
            <span class="var">head.next.val</span>)
            <span class="var">head</span> = <span class="var">head.next</span>;
          </div>
          <div class="code-line" id="code4">
            <span class="var">prev.next</span> =
            <span class="var">head.next</span>;
            <span class="comment">// skip all duplicates</span>
          </div>
          <div class="code-line" id="code5">
            } <span class="keyword">else</span> {
            <span class="var">prev</span> = <span class="var">prev.next</span>;
            } <span class="comment">// unique, advance prev</span>
          </div>
          <div class="code-line" id="code6">
            <span class="var">head</span> = <span class="var">head.next</span>;
          </div>
          <div class="code-line" id="code7">}</div>
        </div>
      </div>

      <!-- Progress -->
      <div class="progress-section">
        <span class="progress-label">Progress:</span>
        <div class="progress-track">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <span class="step-display" id="stepDisplay">0 / 0</span>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button class="btn btn-prev" id="prevBtn" onclick="prevStep()">
          ‚óÄ Prev
        </button>
        <button class="btn btn-play" id="playBtn" onclick="togglePlay()">
          ‚ñ∂ Play
        </button>
        <button class="btn btn-next" id="nextBtn" onclick="nextStep()">
          Next ‚ñ∂
        </button>
        <button class="btn btn-reset" id="resetBtn" onclick="reset()">
          ‚Ü∫ Reset
        </button>
      </div>

      <!-- Legend -->
      <div class="legend">
        <div class="legend-item">
          <div class="legend-box legend-prev"></div>
          <span>prev pointer</span>
        </div>
        <div class="legend-item">
          <div class="legend-box legend-head"></div>
          <span>head pointer</span>
        </div>
        <div class="legend-item">
          <div class="legend-box legend-safe"></div>
          <span>Confirmed safe</span>
        </div>
        <div class="legend-item">
          <div class="legend-box legend-removed"></div>
          <span>Removed</span>
        </div>
      </div>

      <!-- Keyboard Hints -->
      <div class="keyboard-hint">
        <span class="key">‚Üê</span> Prev <span class="key">‚Üí</span> Next
        <span class="key">Space</span> Play/Pause
        <span class="key">R</span> Reset
      </div>
    </div>

    <script>
      // Node structure: [value, isRemoved, isSafe]
      // We'll track: dummy -> 1 -> 2 -> 3 -> 3 -> 4 -> 4 -> 5 -> null
      const initialList = ["D", 1, 2, 3, 3, 4, 4, 5]; // D = dummy node with value 0

      let currentStep = 0;
      let isPlaying = false;
      let playInterval = null;

      // Generate all visualization steps
      const steps = generateSteps();

      function generateSteps() {
        const steps = [];

        // Step 0: Initial state
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: false,
            safe: false,
            isPrev: i === 0,
            isHead: i === 1,
          })),
          prevIndex: 0,
          headIndex: 1,
          prevValue: "dummy(0)",
          headValue: "1",
          prevNextValue: "1",
          text: `Initialize: <span class="hl-prev">prev</span> points to <span class="hl-value">dummy</span> node, <span class="hl-head">head</span> points to first real node <span class="hl-value">1</span>. The dummy node handles edge case where head is deleted.`,
          codeLines: [],
          action: "init",
        });

        // Step 1: Check node 1 - is it duplicate?
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: false,
            safe: false,
            isPrev: i === 0,
            isHead: i === 1,
          })),
          prevIndex: 0,
          headIndex: 1,
          prevValue: "dummy(0)",
          headValue: "1",
          prevNextValue: "1",
          text: `Check: Is <span class="hl-head">head.val (1)</span> === <span class="hl-value">head.next.val (2)</span>? <span class="hl-action">NO!</span> Node 1 is unique.`,
          codeLines: ["code1", "code2"],
          action: "check-unique",
        });

        // Step 2: Node 1 is unique, advance prev
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: false,
            safe: i === 1,
            isPrev: i === 1,
            isHead: i === 1,
          })),
          prevIndex: 1,
          headIndex: 1,
          prevValue: "1",
          headValue: "1",
          prevNextValue: "2",
          text: `<span class="hl-action">UNIQUE!</span> Advance <span class="hl-prev">prev = prev.next</span>. Node <span class="hl-value">1</span> is now in the safe zone ‚úì`,
          codeLines: ["code5"],
          action: "advance-prev",
        });

        // Step 3: Advance head to node 2
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: false,
            safe: i === 1,
            isPrev: i === 1,
            isHead: i === 2,
          })),
          prevIndex: 1,
          headIndex: 2,
          prevValue: "1",
          headValue: "2",
          prevNextValue: "2",
          text: `Advance <span class="hl-head">head = head.next</span>. Now examining node <span class="hl-value">2</span>.`,
          codeLines: ["code6"],
          action: "advance-head",
        });

        // Step 4: Check node 2
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: false,
            safe: i === 1,
            isPrev: i === 1,
            isHead: i === 2,
          })),
          prevIndex: 1,
          headIndex: 2,
          prevValue: "1",
          headValue: "2",
          prevNextValue: "2",
          text: `Check: Is <span class="hl-head">head.val (2)</span> === <span class="hl-value">head.next.val (3)</span>? <span class="hl-action">NO!</span> Node 2 is unique.`,
          codeLines: ["code1", "code2"],
          action: "check-unique",
        });

        // Step 5: Node 2 is unique, advance prev
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: false,
            safe: i <= 2,
            isPrev: i === 2,
            isHead: i === 2,
          })),
          prevIndex: 2,
          headIndex: 2,
          prevValue: "2",
          headValue: "2",
          prevNextValue: "3",
          text: `<span class="hl-action">UNIQUE!</span> Advance <span class="hl-prev">prev = prev.next</span>. Node <span class="hl-value">2</span> joins the safe zone ‚úì`,
          codeLines: ["code5"],
          action: "advance-prev",
        });

        // Step 6: Advance head to first 3
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: false,
            safe: i <= 2,
            isPrev: i === 2,
            isHead: i === 3,
          })),
          prevIndex: 2,
          headIndex: 3,
          prevValue: "2",
          headValue: "3",
          prevNextValue: "3",
          text: `Advance <span class="hl-head">head = head.next</span>. Now examining node <span class="hl-value">3</span>.`,
          codeLines: ["code6"],
          action: "advance-head",
        });

        // Step 7: Check first 3 - DUPLICATE FOUND!
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: false,
            safe: i <= 2,
            isPrev: i === 2,
            isHead: i === 3,
            duplicate: i === 3 || i === 4,
          })),
          prevIndex: 2,
          headIndex: 3,
          prevValue: "2",
          headValue: "3",
          prevNextValue: "3",
          text: `Check: Is <span class="hl-head">head.val (3)</span> === <span class="hl-value">head.next.val (3)</span>? <span class="hl-skip">YES! DUPLICATE DETECTED!</span> üö®`,
          codeLines: ["code1", "code2"],
          action: "duplicate-found",
        });

        // Step 8: Skip to last 3
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: false,
            safe: i <= 2,
            isPrev: i === 2,
            isHead: i === 4,
            duplicate: i === 3 || i === 4,
            skipping: i === 3,
          })),
          prevIndex: 2,
          headIndex: 4,
          prevValue: "2",
          headValue: "3",
          prevNextValue: "3",
          text: `Skip duplicates: <span class="hl-head">head = head.next</span> while values match. Moving to last <span class="hl-value">3</span>.`,
          codeLines: ["code3"],
          action: "skip-dup",
        });

        // Step 9: Reconnect prev.next to skip all 3s
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: i === 3 || i === 4,
            safe: i <= 2,
            isPrev: i === 2,
            isHead: i === 4,
          })),
          prevIndex: 2,
          headIndex: 4,
          prevValue: "2",
          headValue: "3",
          prevNextValue: "4",
          text: `<span class="hl-action">RECONNECT:</span> <span class="hl-prev">prev.next = head.next</span>. Both <span class="hl-skip">3s are now bypassed!</span> ‚úó`,
          codeLines: ["code4"],
          action: "reconnect",
          reconnectFrom: 2,
          reconnectTo: 5,
        });

        // Step 10: Advance head (now at first 4)
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: i === 3 || i === 4,
            safe: i <= 2,
            isPrev: i === 2,
            isHead: i === 5,
          })),
          prevIndex: 2,
          headIndex: 5,
          prevValue: "2",
          headValue: "4",
          prevNextValue: "4",
          text: `Advance <span class="hl-head">head = head.next</span>. Now examining node <span class="hl-value">4</span>. Note: <span class="hl-prev">prev</span> did NOT move!`,
          codeLines: ["code6"],
          action: "advance-head",
        });

        // Step 11: Check first 4 - DUPLICATE!
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: i === 3 || i === 4,
            safe: i <= 2,
            isPrev: i === 2,
            isHead: i === 5,
            duplicate: i === 5 || i === 6,
          })),
          prevIndex: 2,
          headIndex: 5,
          prevValue: "2",
          headValue: "4",
          prevNextValue: "4",
          text: `Check: Is <span class="hl-head">head.val (4)</span> === <span class="hl-value">head.next.val (4)</span>? <span class="hl-skip">YES! DUPLICATE DETECTED!</span> üö®`,
          codeLines: ["code1", "code2"],
          action: "duplicate-found",
        });

        // Step 12: Skip to last 4
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: i === 3 || i === 4,
            safe: i <= 2,
            isPrev: i === 2,
            isHead: i === 6,
            duplicate: i === 5 || i === 6,
            skipping: i === 5,
          })),
          prevIndex: 2,
          headIndex: 6,
          prevValue: "2",
          headValue: "4",
          prevNextValue: "4",
          text: `Skip duplicates: <span class="hl-head">head = head.next</span> while values match. Moving to last <span class="hl-value">4</span>.`,
          codeLines: ["code3"],
          action: "skip-dup",
        });

        // Step 13: Reconnect to skip all 4s
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: i >= 3 && i <= 6,
            safe: i <= 2,
            isPrev: i === 2,
            isHead: i === 6,
          })),
          prevIndex: 2,
          headIndex: 6,
          prevValue: "2",
          headValue: "4",
          prevNextValue: "5",
          text: `<span class="hl-action">RECONNECT:</span> <span class="hl-prev">prev.next = head.next</span>. Both <span class="hl-skip">4s are now bypassed!</span> ‚úó`,
          codeLines: ["code4"],
          action: "reconnect",
          reconnectFrom: 2,
          reconnectTo: 7,
        });

        // Step 14: Advance head to 5
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: i >= 3 && i <= 6,
            safe: i <= 2,
            isPrev: i === 2,
            isHead: i === 7,
          })),
          prevIndex: 2,
          headIndex: 7,
          prevValue: "2",
          headValue: "5",
          prevNextValue: "5",
          text: `Advance <span class="hl-head">head = head.next</span>. Now examining node <span class="hl-value">5</span>.`,
          codeLines: ["code6"],
          action: "advance-head",
        });

        // Step 15: Check 5 - unique (next is null)
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: i >= 3 && i <= 6,
            safe: i <= 2,
            isPrev: i === 2,
            isHead: i === 7,
          })),
          prevIndex: 2,
          headIndex: 7,
          prevValue: "2",
          headValue: "5",
          prevNextValue: "5",
          text: `Check: <span class="hl-head">head.next</span> is <span class="hl-value">null</span>. No next node to compare! <span class="hl-action">Node 5 is unique!</span>`,
          codeLines: ["code1", "code2"],
          action: "check-unique",
        });

        // Step 16: Advance prev to include 5
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: i >= 3 && i <= 6,
            safe: i <= 2 || i === 7,
            isPrev: i === 7,
            isHead: i === 7,
          })),
          prevIndex: 7,
          headIndex: 7,
          prevValue: "5",
          headValue: "5",
          prevNextValue: "null",
          text: `<span class="hl-action">UNIQUE!</span> Advance <span class="hl-prev">prev = prev.next</span>. Node <span class="hl-value">5</span> joins the safe zone ‚úì`,
          codeLines: ["code5"],
          action: "advance-prev",
        });

        // Step 17: Advance head to null - loop ends
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: i >= 3 && i <= 6,
            safe: i <= 2 || i === 7,
            isPrev: i === 7,
            isHead: false,
          })),
          prevIndex: 7,
          headIndex: -1,
          prevValue: "5",
          headValue: "null",
          prevNextValue: "null",
          text: `Advance <span class="hl-head">head = head.next</span>. <span class="hl-head">head</span> is now <span class="hl-value">null</span>. Loop terminates!`,
          codeLines: ["code6", "code7"],
          action: "loop-end",
        });

        // Step 18: Final result
        steps.push({
          nodes: initialList.map((v, i) => ({
            value: v,
            removed: i >= 3 && i <= 6,
            safe: i <= 2 || i === 7,
            kept: (i >= 1 && i <= 2) || i === 7,
            isPrev: false,
            isHead: false,
          })),
          prevIndex: -1,
          headIndex: -1,
          prevValue: "-",
          headValue: "-",
          prevNextValue: "-",
          text: `‚úÖ <span class="hl-action">COMPLETE!</span> Return <span class="hl-value">dummy.next</span>. Result: <span class="hl-action">[1 ‚Üí 2 ‚Üí 5]</span>. All duplicates (3, 3, 4, 4) removed!`,
          codeLines: [],
          action: "complete",
        });

        return steps;
      }

      function render() {
        const step = steps[currentStep];

        // Render linked list
        renderLinkedList(step);

        // Update pointer values
        document.getElementById("prevValue").textContent = step.prevValue;
        document.getElementById("headValue").textContent = step.headValue;
        document.getElementById("prevNextValue").textContent =
          step.prevNextValue;

        // Update action text
        document.getElementById("actionText").innerHTML = step.text;

        // Update code highlighting
        document
          .querySelectorAll(".code-line")
          .forEach((el) => el.classList.remove("active"));
        (step.codeLines || []).forEach((id) => {
          const el = document.getElementById(id);
          if (el) el.classList.add("active");
        });

        // Update progress
        const progress = (currentStep / (steps.length - 1)) * 100;
        document.getElementById("progressFill").style.width = progress + "%";
        document.getElementById(
          "stepDisplay"
        ).textContent = `${currentStep} / ${steps.length - 1}`;

        // Update buttons
        document.getElementById("prevBtn").disabled = currentStep === 0;
        document.getElementById("nextBtn").disabled =
          currentStep === steps.length - 1;
        document.getElementById("playBtn").innerHTML = isPlaying
          ? "‚è∏ Pause"
          : "‚ñ∂ Play";
      }

      function renderLinkedList(step) {
        const container = document.getElementById("linkedList");
        container.innerHTML = "";

        step.nodes.forEach((node, i) => {
          const group = document.createElement("div");
          group.className = "node-group";

          // Pointer labels
          const labels = document.createElement("div");
          labels.className = "pointer-labels";

          if (node.isPrev) {
            const prevLabel = document.createElement("div");
            prevLabel.className = "pointer-label prev-label visible";
            prevLabel.textContent = "prev";
            labels.appendChild(prevLabel);
          }

          if (node.isHead) {
            const headLabel = document.createElement("div");
            headLabel.className = "pointer-label head-label visible";
            headLabel.textContent = "head";
            labels.appendChild(headLabel);
          }

          group.appendChild(labels);

          // Node element
          const nodeEl = document.createElement("div");
          nodeEl.className = "node-element";

          const box = document.createElement("div");
          box.className = "node-box";

          if (node.value === "D") {
            box.classList.add("dummy");
            box.textContent = "0";
          } else {
            box.textContent = node.value;
          }

          // Apply states
          if (node.isPrev && !node.isHead) box.classList.add("prev-node");
          if (node.isHead) box.classList.add("head-node");
          if (node.duplicate) box.classList.add("duplicate-detected");
          if (node.safe && !node.removed) box.classList.add("safe");
          if (node.removed) box.classList.add("removed");
          if (node.kept) box.classList.add("kept");
          if (node.skipping) box.classList.add("skipping");

          nodeEl.appendChild(box);

          // Arrow (except for last)
          if (i < step.nodes.length - 1) {
            const arrow = document.createElement("span");
            arrow.className = "arrow";
            arrow.textContent = "‚Üí";

            // Check if this connection is broken
            const nextNode = step.nodes[i + 1];
            if (
              node.removed ||
              (nextNode && nextNode.removed && !node.removed)
            ) {
              // Complex logic for showing broken vs connected arrows
              if (node.removed) {
                arrow.classList.add("broken");
              }
            }

            // Special case for reconnection visualization
            if (step.reconnectFrom === i) {
              arrow.classList.add("connected", "reconnecting");
            }

            nodeEl.appendChild(arrow);
          }

          group.appendChild(nodeEl);
          container.appendChild(group);
        });

        // Add null node
        const nullGroup = document.createElement("div");
        nullGroup.className = "node-group";
        nullGroup.innerHTML = `
                <div class="pointer-labels"></div>
                <span class="null-node">‚Üí null</span>
            `;
        container.appendChild(nullGroup);
      }

      function nextStep() {
        if (currentStep < steps.length - 1) {
          currentStep++;
          render();
        } else if (isPlaying) {
          stopPlay();
        }
      }

      function prevStep() {
        if (currentStep > 0) {
          currentStep--;
          render();
        }
      }

      function togglePlay() {
        if (isPlaying) {
          stopPlay();
        } else {
          startPlay();
        }
      }

      function startPlay() {
        isPlaying = true;
        playInterval = setInterval(() => {
          if (currentStep < steps.length - 1) {
            nextStep();
          } else {
            stopPlay();
          }
        }, 1800);
        render();
      }

      function stopPlay() {
        isPlaying = false;
        if (playInterval) {
          clearInterval(playInterval);
          playInterval = null;
        }
        render();
      }

      function reset() {
        stopPlay();
        currentStep = 0;
        render();
      }

      // Keyboard controls
      document.addEventListener("keydown", (e) => {
        switch (e.key) {
          case "ArrowRight":
            nextStep();
            break;
          case "ArrowLeft":
            prevStep();
            break;
          case " ":
            e.preventDefault();
            togglePlay();
            break;
          case "r":
          case "R":
            reset();
            break;
        }
      });

      // Initial render
      render();
    </script>
  </body>
</html>
