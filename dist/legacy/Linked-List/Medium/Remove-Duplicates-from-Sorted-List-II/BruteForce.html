<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Remove Duplicates II - Brute Force Visualization</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600;700&family=Patrick+Hand&family=Architects+Daughter&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Caveat", cursive;
        background: #2a2a2a;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
      }

      .whiteboard {
        background: linear-gradient(
          135deg,
          #1a472a 0%,
          #0d2818 50%,
          #1a472a 100%
        );
        border-radius: 12px;
        padding: 40px;
        width: 100%;
        max-width: 1200px;
        min-height: 700px;
        position: relative;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5),
          inset 0 2px 4px rgba(255, 255, 255, 0.1),
          inset 0 -2px 4px rgba(0, 0, 0, 0.3);
        border: 12px solid #5c3d2e;
        overflow: hidden;
      }

      .whiteboard::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23noise)'/%3E%3C/svg%3E");
        opacity: 0.03;
        pointer-events: none;
      }

      .chalk-dust {
        position: absolute;
        bottom: 10px;
        left: 50%;
        transform: translateX(-50%);
        width: 80%;
        height: 3px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent
        );
        border-radius: 50%;
      }

      .title {
        font-family: "Architects Daughter", cursive;
        font-size: 2.2rem;
        color: #fff;
        text-align: center;
        margin-bottom: 10px;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        letter-spacing: 1px;
      }

      .subtitle {
        font-family: "Patrick Hand", cursive;
        font-size: 1.3rem;
        color: #ffd700;
        text-align: center;
        margin-bottom: 25px;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
      }

      .phase-indicator {
        display: flex;
        justify-content: center;
        gap: 40px;
        margin-bottom: 25px;
      }

      .phase {
        font-family: "Patrick Hand", cursive;
        font-size: 1.2rem;
        padding: 8px 20px;
        border-radius: 8px;
        transition: all 0.3s ease;
        border: 2px dashed transparent;
      }

      .phase.active {
        color: #90ee90;
        border-color: #90ee90;
        background: rgba(144, 238, 144, 0.1);
      }

      .phase.inactive {
        color: rgba(255, 255, 255, 0.4);
      }

      .phase.completed {
        color: #87ceeb;
        text-decoration: line-through;
      }

      .visualization-area {
        display: flex;
        flex-direction: column;
        gap: 30px;
      }

      .section {
        background: rgba(0, 0, 0, 0.2);
        border-radius: 10px;
        padding: 20px;
        border: 2px solid rgba(255, 255, 255, 0.1);
      }

      .section-title {
        font-family: "Patrick Hand", cursive;
        font-size: 1.3rem;
        color: #ffa500;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .section-title::before {
        content: "‚Üí";
        color: #ff6b6b;
      }

      /* Linked List Styles */
      .linked-list-container {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
        flex-wrap: wrap;
        min-height: 80px;
      }

      .node {
        display: flex;
        align-items: center;
        transition: all 0.4s ease;
      }

      .node-box {
        width: 55px;
        height: 55px;
        border: 3px solid #fff;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Caveat", cursive;
        font-size: 1.8rem;
        font-weight: 700;
        color: #fff;
        position: relative;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.05);
      }

      .node-box.current {
        border-color: #00ff00;
        box-shadow: 0 0 20px rgba(0, 255, 0, 0.5);
        transform: scale(1.1);
      }

      .node-box.duplicate {
        border-color: #ff6b6b;
        background: rgba(255, 107, 107, 0.2);
      }

      .node-box.unique {
        border-color: #90ee90;
        background: rgba(144, 238, 144, 0.2);
      }

      .node-box.removed {
        opacity: 0.3;
        border-style: dashed;
        text-decoration: line-through;
      }

      .node-box.kept {
        border-color: #00ff00;
        background: rgba(0, 255, 0, 0.2);
        box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
      }

      .arrow {
        font-size: 1.5rem;
        color: #fff;
        margin: 0 3px;
        opacity: 0.7;
      }

      .null-node {
        font-family: "Patrick Hand", cursive;
        font-size: 1.2rem;
        color: #888;
        padding: 10px;
      }

      /* Frequency Map Styles */
      .freq-map-container {
        display: flex;
        justify-content: center;
        gap: 15px;
        flex-wrap: wrap;
        min-height: 100px;
      }

      .freq-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 5px;
        opacity: 0;
        transform: translateY(20px);
        transition: all 0.4s ease;
      }

      .freq-item.visible {
        opacity: 1;
        transform: translateY(0);
      }

      .freq-key {
        width: 50px;
        height: 50px;
        border: 3px solid #87ceeb;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.6rem;
        font-weight: 700;
        color: #87ceeb;
        background: rgba(135, 206, 235, 0.1);
        transition: all 0.3s ease;
      }

      .freq-key.highlight {
        border-color: #ffd700;
        color: #ffd700;
        box-shadow: 0 0 15px rgba(255, 215, 0, 0.5);
        transform: scale(1.1);
      }

      .freq-key.duplicate-key {
        border-color: #ff6b6b;
        color: #ff6b6b;
        background: rgba(255, 107, 107, 0.2);
      }

      .freq-key.unique-key {
        border-color: #90ee90;
        color: #90ee90;
        background: rgba(144, 238, 144, 0.2);
      }

      .freq-value {
        font-family: "Patrick Hand", cursive;
        font-size: 1.1rem;
        color: #fff;
        background: rgba(255, 255, 255, 0.1);
        padding: 3px 12px;
        border-radius: 10px;
        transition: all 0.3s ease;
      }

      .freq-value.highlight {
        background: rgba(255, 215, 0, 0.3);
        color: #ffd700;
      }

      .freq-value.dup-count {
        background: rgba(255, 107, 107, 0.3);
        color: #ff6b6b;
      }

      .freq-value.unique-count {
        background: rgba(144, 238, 144, 0.3);
        color: #90ee90;
      }

      /* Result List Styles */
      .result-container {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 5px;
        min-height: 80px;
      }

      .result-node {
        display: flex;
        align-items: center;
        opacity: 0;
        transform: scale(0);
        transition: all 0.4s ease;
      }

      .result-node.visible {
        opacity: 1;
        transform: scale(1);
      }

      .result-box {
        width: 55px;
        height: 55px;
        border: 3px solid #00ff00;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Caveat", cursive;
        font-size: 1.8rem;
        font-weight: 700;
        color: #00ff00;
        background: rgba(0, 255, 0, 0.15);
        box-shadow: 0 0 15px rgba(0, 255, 0, 0.3);
      }

      /* Step Info */
      .step-info {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 10px;
        padding: 15px 20px;
        margin-top: 20px;
        border-left: 4px solid #ffd700;
      }

      .step-text {
        font-family: "Patrick Hand", cursive;
        font-size: 1.25rem;
        color: #fff;
        line-height: 1.6;
      }

      .step-text .highlight-text {
        color: #ffd700;
        font-weight: 600;
      }

      .step-text .value-text {
        color: #87ceeb;
        font-weight: 600;
      }

      .step-text .action-text {
        color: #90ee90;
      }

      .step-text .skip-text {
        color: #ff6b6b;
      }

      /* Controls */
      .controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 25px;
        flex-wrap: wrap;
      }

      .btn {
        font-family: "Patrick Hand", cursive;
        font-size: 1.1rem;
        padding: 10px 25px;
        border: none;
        border-radius: 25px;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: linear-gradient(135deg, #4caf50, #45a049);
        color: white;
        box-shadow: 0 4px 15px rgba(76, 175, 80, 0.4);
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(76, 175, 80, 0.5);
      }

      .btn-secondary {
        background: linear-gradient(135deg, #2196f3, #1976d2);
        color: white;
        box-shadow: 0 4px 15px rgba(33, 150, 243, 0.4);
      }

      .btn-secondary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(33, 150, 243, 0.5);
      }

      .btn-warning {
        background: linear-gradient(135deg, #ff9800, #f57c00);
        color: white;
        box-shadow: 0 4px 15px rgba(255, 152, 0, 0.4);
      }

      .btn-warning:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(255, 152, 0, 0.5);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
      }

      /* Progress Bar */
      .progress-container {
        margin-top: 20px;
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .progress-label {
        font-family: "Patrick Hand", cursive;
        font-size: 1rem;
        color: rgba(255, 255, 255, 0.7);
        min-width: 80px;
      }

      .progress-bar {
        flex: 1;
        height: 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #4caf50, #8bc34a);
        border-radius: 4px;
        transition: width 0.3s ease;
      }

      .step-counter {
        font-family: "Patrick Hand", cursive;
        font-size: 1rem;
        color: #ffd700;
        min-width: 70px;
        text-align: right;
      }

      /* Legend */
      .legend {
        display: flex;
        justify-content: center;
        gap: 25px;
        margin-top: 20px;
        flex-wrap: wrap;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-family: "Patrick Hand", cursive;
        font-size: 1rem;
        color: rgba(255, 255, 255, 0.8);
      }

      .legend-color {
        width: 20px;
        height: 20px;
        border-radius: 4px;
        border: 2px solid;
      }

      .legend-current {
        border-color: #00ff00;
        box-shadow: 0 0 10px rgba(0, 255, 0, 0.5);
      }

      .legend-duplicate {
        border-color: #ff6b6b;
        background: rgba(255, 107, 107, 0.3);
      }

      .legend-unique {
        border-color: #90ee90;
        background: rgba(144, 238, 144, 0.3);
      }

      /* Keyboard Hint */
      .keyboard-hint {
        text-align: center;
        margin-top: 15px;
        font-family: "Patrick Hand", cursive;
        font-size: 0.95rem;
        color: rgba(255, 255, 255, 0.5);
      }

      .key {
        display: inline-block;
        background: rgba(255, 255, 255, 0.1);
        padding: 2px 8px;
        border-radius: 4px;
        margin: 0 3px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      /* Code Display */
      .code-section {
        background: rgba(0, 0, 0, 0.4);
        border-radius: 8px;
        padding: 15px;
        margin-top: 15px;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .code-line {
        font-family: "Courier New", monospace;
        font-size: 0.9rem;
        color: rgba(255, 255, 255, 0.6);
        padding: 3px 10px;
        border-radius: 4px;
        transition: all 0.3s ease;
      }

      .code-line.active {
        background: rgba(255, 215, 0, 0.2);
        color: #ffd700;
        border-left: 3px solid #ffd700;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .whiteboard {
          padding: 20px;
        }

        .title {
          font-size: 1.6rem;
        }

        .node-box,
        .result-box {
          width: 45px;
          height: 45px;
          font-size: 1.4rem;
        }

        .freq-key {
          width: 40px;
          height: 40px;
          font-size: 1.3rem;
        }

        .controls {
          gap: 10px;
        }

        .btn {
          padding: 8px 16px;
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="whiteboard">
      <div class="chalk-dust"></div>

      <h1 class="title">Remove Duplicates from Sorted List II</h1>
      <p class="subtitle">Brute Force Approach: Hash Map + Two Pass</p>

      <div class="phase-indicator">
        <div class="phase" id="phase1">üìä Phase 1: Count Frequencies</div>
        <div class="phase" id="phase2">üî® Phase 2: Build Result</div>
      </div>

      <div class="visualization-area">
        <!-- Original Linked List -->
        <div class="section">
          <div class="section-title">Original Linked List</div>
          <div class="linked-list-container" id="linkedList"></div>
        </div>

        <!-- Frequency Map -->
        <div class="section">
          <div class="section-title">Frequency Map { value ‚Üí count }</div>
          <div class="freq-map-container" id="freqMap"></div>
        </div>

        <!-- Result List -->
        <div class="section">
          <div class="section-title">
            Result List (values with count = 1 only)
          </div>
          <div class="result-container" id="resultList">
            <span class="null-node">[ waiting... ]</span>
          </div>
        </div>
      </div>

      <!-- Step Info -->
      <div class="step-info">
        <div class="step-text" id="stepText">
          Press <span class="highlight-text">Play</span> or
          <span class="highlight-text">Next</span> to start the visualization!
        </div>
      </div>

      <!-- Code Display -->
      <div class="code-section">
        <div class="code-line" id="code1">// Phase 1: Count frequencies</div>
        <div class="code-line" id="code2">frequencyMap[current.val] += 1</div>
        <div class="code-line" id="code3">// Phase 2: Build result</div>
        <div class="code-line" id="code4">
          if (frequencyMap[current.val] === 1) ‚Üí keep
        </div>
        <div class="code-line" id="code5">else ‚Üí skip (duplicate)</div>
      </div>

      <!-- Progress -->
      <div class="progress-container">
        <span class="progress-label">Progress:</span>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <span class="step-counter" id="stepCounter">0 / 0</span>
      </div>

      <!-- Controls -->
      <div class="controls">
        <button class="btn btn-secondary" id="prevBtn" onclick="prevStep()">
          ‚óÄ Prev
        </button>
        <button class="btn btn-primary" id="playBtn" onclick="togglePlay()">
          ‚ñ∂ Play
        </button>
        <button class="btn btn-secondary" id="nextBtn" onclick="nextStep()">
          Next ‚ñ∂
        </button>
        <button class="btn btn-warning" id="resetBtn" onclick="reset()">
          ‚Ü∫ Reset
        </button>
      </div>

      <!-- Legend -->
      <div class="legend">
        <div class="legend-item">
          <div class="legend-color legend-current"></div>
          <span>Current Node</span>
        </div>
        <div class="legend-item">
          <div class="legend-color legend-unique"></div>
          <span>Unique (count=1)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color legend-duplicate"></div>
          <span>Duplicate (count>1)</span>
        </div>
      </div>

      <!-- Keyboard Hints -->
      <div class="keyboard-hint">
        Keyboard: <span class="key">‚Üê</span> Previous
        <span class="key">‚Üí</span> Next
        <span class="key">Space</span> Play/Pause
        <span class="key">R</span> Reset
      </div>
    </div>

    <script>
      // Input data
      const inputList = [1, 2, 3, 3, 4, 4, 5];

      // State
      let currentStep = 0;
      let isPlaying = false;
      let playInterval = null;
      let frequencyMap = {};
      let resultNodes = [];

      // Generate all steps
      const steps = generateSteps();

      function generateSteps() {
        const steps = [];

        // Initial step
        steps.push({
          phase: "start",
          currentIndex: -1,
          freqMap: {},
          result: [],
          text: `Starting with input: <span class="value-text">[${inputList.join(
            ", "
          )}]</span>. We'll use a hash map to count how many times each value appears.`,
          codeLines: [],
        });

        // Phase 1: Building frequency map
        let tempFreq = {};
        for (let i = 0; i < inputList.length; i++) {
          const val = inputList[i];
          const prevCount = tempFreq[val] || 0;
          tempFreq[val] = prevCount + 1;

          steps.push({
            phase: "phase1",
            currentIndex: i,
            freqMap: { ...tempFreq },
            result: [],
            highlightKey: val,
            text: `Visiting node <span class="value-text">${val}</span>: ${
              prevCount === 0
                ? `First occurrence! Adding to map with count <span class="action-text">1</span>`
                : `Already exists with count ${prevCount}, incrementing to <span class="action-text">${
                    prevCount + 1
                  }</span>`
            }`,
            codeLines: ["code1", "code2"],
          });
        }

        // Phase 1 complete
        steps.push({
          phase: "phase1-done",
          currentIndex: -1,
          freqMap: { ...tempFreq },
          result: [],
          text: `Phase 1 complete! Frequency map: ${Object.entries(tempFreq)
            .map(
              ([k, v]) =>
                `<span class="${
                  v > 1 ? "skip-text" : "action-text"
                }">${k}‚Üí${v}</span>`
            )
            .join(", ")}. Values with count > 1 are duplicates!`,
          codeLines: ["code1"],
        });

        // Phase 2: Building result
        let tempResult = [];
        for (let i = 0; i < inputList.length; i++) {
          const val = inputList[i];
          const count = tempFreq[val];
          const isUnique = count === 1;

          if (isUnique) {
            tempResult.push(val);
          }

          steps.push({
            phase: "phase2",
            currentIndex: i,
            freqMap: tempFreq,
            result: [...tempResult],
            checkingKey: val,
            isUnique: isUnique,
            text: `Checking node <span class="value-text">${val}</span>: frequency = <span class="${
              isUnique ? "action-text" : "skip-text"
            }">${count}</span>. ${
              isUnique
                ? `Count is 1, so <span class="action-text">KEEP</span> this node!`
                : `Count > 1, this is a duplicate. <span class="skip-text">SKIP</span>!`
            }`,
            codeLines: isUnique ? ["code3", "code4"] : ["code3", "code5"],
          });
        }

        // Final step
        steps.push({
          phase: "done",
          currentIndex: -1,
          freqMap: tempFreq,
          result: tempResult,
          text: `‚úì Complete! Final result: <span class="action-text">[${tempResult.join(
            " ‚Üí "
          )}]</span>. Removed all nodes with duplicate values (3 and 4).`,
          codeLines: [],
        });

        return steps;
      }

      function render() {
        const step = steps[currentStep];

        // Update phase indicators
        document.getElementById("phase1").className =
          "phase " +
          (step.phase === "phase1"
            ? "active"
            : step.phase === "start"
            ? "inactive"
            : step.phase.includes("phase1") ||
              step.phase === "phase2" ||
              step.phase === "done"
            ? "completed"
            : "inactive");

        document.getElementById("phase2").className =
          "phase " +
          (step.phase === "phase2"
            ? "active"
            : step.phase === "done"
            ? "completed"
            : "inactive");

        // Render linked list
        renderLinkedList(step);

        // Render frequency map
        renderFreqMap(step);

        // Render result list
        renderResultList(step);

        // Update step text
        document.getElementById("stepText").innerHTML = step.text;

        // Update code highlighting
        document
          .querySelectorAll(".code-line")
          .forEach((el) => el.classList.remove("active"));
        (step.codeLines || []).forEach((id) => {
          const el = document.getElementById(id);
          if (el) el.classList.add("active");
        });

        // Update progress
        const progress = (currentStep / (steps.length - 1)) * 100;
        document.getElementById("progressFill").style.width = progress + "%";
        document.getElementById(
          "stepCounter"
        ).textContent = `${currentStep} / ${steps.length - 1}`;

        // Update button states
        document.getElementById("prevBtn").disabled = currentStep === 0;
        document.getElementById("nextBtn").disabled =
          currentStep === steps.length - 1;
        document.getElementById("playBtn").textContent = isPlaying
          ? "‚è∏ Pause"
          : "‚ñ∂ Play";
      }

      function renderLinkedList(step) {
        const container = document.getElementById("linkedList");
        container.innerHTML = "";

        inputList.forEach((val, i) => {
          const nodeDiv = document.createElement("div");
          nodeDiv.className = "node";

          const box = document.createElement("div");
          box.className = "node-box";
          box.textContent = val;

          // Apply styling based on state
          if (i === step.currentIndex) {
            box.classList.add("current");
          }

          if (
            step.phase === "phase1-done" ||
            step.phase === "phase2" ||
            step.phase === "done"
          ) {
            const count = step.freqMap[val];
            if (count > 1) {
              box.classList.add("duplicate");
            } else {
              box.classList.add("unique");
            }
          }

          if (step.phase === "done") {
            const count = step.freqMap[val];
            if (count > 1) {
              box.classList.add("removed");
            } else {
              box.classList.add("kept");
            }
          }

          nodeDiv.appendChild(box);

          // Add arrow
          if (i < inputList.length - 1) {
            const arrow = document.createElement("span");
            arrow.className = "arrow";
            arrow.textContent = "‚Üí";
            nodeDiv.appendChild(arrow);
          }

          container.appendChild(nodeDiv);
        });

        // Add null
        const nullNode = document.createElement("span");
        nullNode.className = "null-node";
        nullNode.textContent = "‚Üí null";
        container.appendChild(nullNode);
      }

      function renderFreqMap(step) {
        const container = document.getElementById("freqMap");
        container.innerHTML = "";

        const uniqueValues = [...new Set(inputList)];

        uniqueValues.forEach((val) => {
          const count = step.freqMap[val];
          if (count === undefined) return;

          const item = document.createElement("div");
          item.className = "freq-item visible";

          const key = document.createElement("div");
          key.className = "freq-key";
          key.textContent = val;

          // Highlight current key being processed
          if (step.highlightKey === val) {
            key.classList.add("highlight");
          }

          // Mark as duplicate or unique in later phases
          if (
            step.phase === "phase1-done" ||
            step.phase === "phase2" ||
            step.phase === "done"
          ) {
            if (count > 1) {
              key.classList.add("duplicate-key");
            } else {
              key.classList.add("unique-key");
            }
          }

          if (step.checkingKey === val) {
            key.classList.add("highlight");
          }

          const value = document.createElement("div");
          value.className = "freq-value";
          value.textContent = `count: ${count}`;

          if (step.highlightKey === val) {
            value.classList.add("highlight");
          }

          if (
            step.phase === "phase1-done" ||
            step.phase === "phase2" ||
            step.phase === "done"
          ) {
            if (count > 1) {
              value.classList.add("dup-count");
            } else {
              value.classList.add("unique-count");
            }
          }

          item.appendChild(key);
          item.appendChild(value);
          container.appendChild(item);
        });

        if (Object.keys(step.freqMap).length === 0) {
          container.innerHTML = '<span class="null-node">{ empty }</span>';
        }
      }

      function renderResultList(step) {
        const container = document.getElementById("resultList");
        container.innerHTML = "";

        if (step.result.length === 0) {
          container.innerHTML = '<span class="null-node">[ waiting... ]</span>';
          return;
        }

        step.result.forEach((val, i) => {
          const nodeDiv = document.createElement("div");
          nodeDiv.className = "result-node visible";

          const box = document.createElement("div");
          box.className = "result-box";
          box.textContent = val;

          nodeDiv.appendChild(box);

          if (i < step.result.length - 1) {
            const arrow = document.createElement("span");
            arrow.className = "arrow";
            arrow.style.color = "#00ff00";
            arrow.textContent = "‚Üí";
            nodeDiv.appendChild(arrow);
          }

          container.appendChild(nodeDiv);
        });

        // Add null
        const nullNode = document.createElement("span");
        nullNode.className = "null-node";
        nullNode.style.color = "#00ff00";
        nullNode.textContent = "‚Üí null";
        container.appendChild(nullNode);
      }

      function nextStep() {
        if (currentStep < steps.length - 1) {
          currentStep++;
          render();
        } else if (isPlaying) {
          stopPlay();
        }
      }

      function prevStep() {
        if (currentStep > 0) {
          currentStep--;
          render();
        }
      }

      function togglePlay() {
        if (isPlaying) {
          stopPlay();
        } else {
          startPlay();
        }
      }

      function startPlay() {
        isPlaying = true;
        playInterval = setInterval(() => {
          if (currentStep < steps.length - 1) {
            nextStep();
          } else {
            stopPlay();
          }
        }, 1500);
        render();
      }

      function stopPlay() {
        isPlaying = false;
        if (playInterval) {
          clearInterval(playInterval);
          playInterval = null;
        }
        render();
      }

      function reset() {
        stopPlay();
        currentStep = 0;
        render();
      }

      // Keyboard controls
      document.addEventListener("keydown", (e) => {
        switch (e.key) {
          case "ArrowRight":
            nextStep();
            break;
          case "ArrowLeft":
            prevStep();
            break;
          case " ":
            e.preventDefault();
            togglePlay();
            break;
          case "r":
          case "R":
            reset();
            break;
        }
      });

      // Initial render
      render();
    </script>
  </body>
</html>
