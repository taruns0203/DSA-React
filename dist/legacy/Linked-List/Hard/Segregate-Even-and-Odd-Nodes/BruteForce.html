<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Odd Even Linked List - Brute Force Visualization</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600;700&family=Architects+Daughter&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Architects Daughter", cursive;
        background: #f5f5f0;
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* Whiteboard container */
      .whiteboard {
        background: linear-gradient(135deg, #ffffff 0%, #f9f9f7 100%);
        min-height: 100vh;
        padding: 30px;
        position: relative;
        box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.03);
      }

      /* Whiteboard texture overlay */
      .whiteboard::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: radial-gradient(
            circle at 20% 80%,
            rgba(120, 119, 198, 0.03) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(255, 107, 107, 0.03) 0%,
            transparent 50%
          );
        pointer-events: none;
      }

      /* Grid lines like a whiteboard */
      .whiteboard::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: linear-gradient(
            rgba(200, 200, 200, 0.1) 1px,
            transparent 1px
          ),
          linear-gradient(90deg, rgba(200, 200, 200, 0.1) 1px, transparent 1px);
        background-size: 40px 40px;
        pointer-events: none;
      }

      .title {
        font-family: "Caveat", cursive;
        font-size: 3rem;
        font-weight: 700;
        color: #2c3e50;
        text-align: center;
        margin-bottom: 10px;
        position: relative;
        text-shadow: 2px 2px 0 rgba(52, 152, 219, 0.1);
      }

      .subtitle {
        font-family: "Caveat", cursive;
        font-size: 1.5rem;
        color: #e74c3c;
        text-align: center;
        margin-bottom: 30px;
        position: relative;
      }

      .marker-underline {
        position: relative;
        display: inline-block;
      }

      .marker-underline::after {
        content: "";
        position: absolute;
        bottom: -5px;
        left: -5px;
        right: -5px;
        height: 12px;
        background: rgba(241, 196, 15, 0.4);
        transform: rotate(-1deg);
        z-index: -1;
        border-radius: 3px;
      }

      /* Main content grid */
      .content {
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 30px;
        max-width: 1400px;
        margin: 0 auto;
        position: relative;
        z-index: 1;
      }

      /* Visualization area */
      .viz-area {
        background: rgba(255, 255, 255, 0.7);
        border: 3px solid #34495e;
        border-radius: 8px;
        padding: 25px;
        position: relative;
        box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.1);
      }

      .viz-area::before {
        content: "VISUALIZATION";
        position: absolute;
        top: -12px;
        left: 20px;
        background: #3498db;
        color: white;
        padding: 2px 15px;
        font-size: 0.85rem;
        border-radius: 4px;
        font-family: "Architects Daughter", cursive;
      }

      /* Section labels */
      .section-label {
        font-family: "Caveat", cursive;
        font-size: 1.4rem;
        font-weight: 600;
        color: #2c3e50;
        margin: 20px 0 15px 0;
        padding-left: 10px;
        border-left: 4px solid #3498db;
      }

      /* Linked list visualization */
      .linked-list {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        gap: 5px;
        padding: 20px;
        min-height: 100px;
      }

      .node {
        display: flex;
        align-items: center;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .node-box {
        width: 55px;
        height: 55px;
        border: 3px solid #2c3e50;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Caveat", cursive;
        font-size: 1.8rem;
        font-weight: 700;
        background: white;
        position: relative;
        transition: all 0.3s ease;
        box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.15);
      }

      .node-box.highlight {
        transform: scale(1.15);
        border-color: #e74c3c;
        box-shadow: 0 0 20px rgba(231, 76, 60, 0.4);
      }

      .node-box.even-node {
        background: linear-gradient(135deg, #a8e6cf 0%, #88d8b0 100%);
        border-color: #27ae60;
      }

      .node-box.odd-node {
        background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
        border-color: #f39c12;
      }

      .node-box.processed {
        opacity: 0.5;
      }

      .index-label {
        position: absolute;
        top: -22px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.9rem;
        color: #7f8c8d;
        font-weight: 600;
      }

      .arrow {
        font-size: 1.5rem;
        color: #2c3e50;
        margin: 0 3px;
        font-weight: bold;
      }

      .null-box {
        padding: 8px 15px;
        background: #ecf0f1;
        border: 2px dashed #95a5a6;
        border-radius: 5px;
        font-family: "Architects Daughter", cursive;
        color: #7f8c8d;
        font-size: 1rem;
      }

      /* Arrays visualization */
      .arrays-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 25px;
        margin: 20px 0;
      }

      .array-box {
        background: white;
        border: 3px solid #2c3e50;
        border-radius: 8px;
        padding: 15px;
        position: relative;
        box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.1);
      }

      .array-box.even-array {
        border-color: #27ae60;
      }

      .array-box.even-array::before {
        content: "evenValues[ ]";
        background: #27ae60;
      }

      .array-box.odd-array {
        border-color: #f39c12;
      }

      .array-box.odd-array::before {
        content: "oddValues[ ]";
        background: #f39c12;
      }

      .array-box::before {
        position: absolute;
        top: -12px;
        left: 15px;
        color: white;
        padding: 2px 12px;
        font-size: 0.85rem;
        border-radius: 4px;
        font-family: "Architects Daughter", cursive;
      }

      .array-content {
        display: flex;
        gap: 8px;
        min-height: 50px;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
      }

      .array-item {
        width: 45px;
        height: 45px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Caveat", cursive;
        font-size: 1.5rem;
        font-weight: 700;
        border-radius: 6px;
        animation: popIn 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      }

      .array-item.even {
        background: linear-gradient(135deg, #a8e6cf 0%, #88d8b0 100%);
        border: 2px solid #27ae60;
      }

      .array-item.odd {
        background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
        border: 2px solid #f39c12;
      }

      @keyframes popIn {
        0% {
          transform: scale(0);
          opacity: 0;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      .empty-array {
        color: #bdc3c7;
        font-style: italic;
        font-size: 1rem;
      }

      /* Result list */
      .result-area {
        margin-top: 20px;
        padding: 20px;
        background: rgba(52, 152, 219, 0.1);
        border-radius: 8px;
        border: 2px dashed #3498db;
      }

      .result-label {
        font-family: "Caveat", cursive;
        font-size: 1.3rem;
        color: #2980b9;
        margin-bottom: 15px;
        text-align: center;
      }

      /* Controls panel */
      .controls-panel {
        background: rgba(255, 255, 255, 0.9);
        border: 3px solid #2c3e50;
        border-radius: 8px;
        padding: 20px;
        position: sticky;
        top: 20px;
        box-shadow: 4px 4px 0 rgba(0, 0, 0, 0.1);
      }

      .controls-panel::before {
        content: "CONTROLS";
        position: absolute;
        top: -12px;
        left: 20px;
        background: #9b59b6;
        color: white;
        padding: 2px 15px;
        font-size: 0.85rem;
        border-radius: 4px;
        font-family: "Architects Daughter", cursive;
      }

      .step-info {
        background: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
        border-left: 4px solid #3498db;
      }

      .step-number {
        font-family: "Caveat", cursive;
        font-size: 1.8rem;
        color: #3498db;
        font-weight: 700;
      }

      .step-description {
        font-size: 1rem;
        color: #2c3e50;
        margin-top: 8px;
        line-height: 1.5;
      }

      /* Buttons */
      .btn-group {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .btn {
        flex: 1;
        padding: 12px 15px;
        border: 3px solid #2c3e50;
        border-radius: 8px;
        font-family: "Architects Daughter", cursive;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s ease;
        box-shadow: 3px 3px 0 rgba(0, 0, 0, 0.15);
      }

      .btn:hover:not(:disabled) {
        transform: translate(-2px, -2px);
        box-shadow: 5px 5px 0 rgba(0, 0, 0, 0.2);
      }

      .btn:active:not(:disabled) {
        transform: translate(1px, 1px);
        box-shadow: 2px 2px 0 rgba(0, 0, 0, 0.1);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .btn-prev {
        background: #ecf0f1;
      }

      .btn-next {
        background: #3498db;
        color: white;
      }

      .btn-reset {
        background: #e74c3c;
        color: white;
        width: 100%;
      }

      .btn-auto {
        background: #27ae60;
        color: white;
        width: 100%;
        margin-top: 10px;
      }

      .btn-auto.playing {
        background: #f39c12;
      }

      /* Variable state */
      .var-state {
        background: #2c3e50;
        border-radius: 8px;
        padding: 15px;
        margin-top: 20px;
      }

      .var-title {
        color: #ecf0f1;
        font-size: 1rem;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid #34495e;
      }

      .var-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 6px 0;
        font-size: 0.95rem;
      }

      .var-name {
        color: #f39c12;
        font-family: "Courier New", monospace;
      }

      .var-value {
        color: #2ecc71;
        font-family: "Courier New", monospace;
        background: rgba(46, 204, 113, 0.1);
        padding: 2px 8px;
        border-radius: 4px;
      }

      /* Code display */
      .code-box {
        background: #1e272e;
        border-radius: 8px;
        padding: 15px;
        margin-top: 20px;
        overflow-x: auto;
      }

      .code-line {
        font-family: "Courier New", monospace;
        font-size: 0.8rem;
        color: #dfe6e9;
        padding: 3px 0;
        white-space: pre;
        transition: all 0.3s ease;
      }

      .code-line.active {
        background: rgba(52, 152, 219, 0.3);
        border-left: 3px solid #3498db;
        padding-left: 10px;
        margin-left: -10px;
      }

      .code-keyword {
        color: #e056fd;
      }

      .code-var {
        color: #f39c12;
      }

      .code-num {
        color: #2ecc71;
      }

      .code-comment {
        color: #636e72;
      }

      /* Progress bar */
      .progress-container {
        margin-top: 20px;
      }

      .progress-label {
        font-size: 0.9rem;
        color: #7f8c8d;
        margin-bottom: 8px;
      }

      .progress-bar {
        height: 8px;
        background: #ecf0f1;
        border-radius: 4px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #3498db, #9b59b6);
        border-radius: 4px;
        transition: width 0.3s ease;
      }

      /* Legend */
      .legend {
        display: flex;
        justify-content: center;
        gap: 25px;
        margin: 20px 0;
        flex-wrap: wrap;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.95rem;
      }

      .legend-color {
        width: 25px;
        height: 25px;
        border-radius: 5px;
        border: 2px solid #2c3e50;
      }

      .legend-color.even {
        background: linear-gradient(135deg, #a8e6cf 0%, #88d8b0 100%);
        border-color: #27ae60;
      }

      .legend-color.odd {
        background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
        border-color: #f39c12;
      }

      /* Responsive */
      @media (max-width: 900px) {
        .content {
          grid-template-columns: 1fr;
        }

        .controls-panel {
          position: static;
        }

        .title {
          font-size: 2rem;
        }
      }

      /* Hand-drawn marker annotations */
      .annotation {
        position: absolute;
        font-family: "Caveat", cursive;
        font-size: 1.1rem;
        color: #e74c3c;
        transform: rotate(-3deg);
      }

      .hand-arrow {
        color: #e74c3c;
        font-size: 1.5rem;
      }
    </style>
  </head>
  <body>
    <div class="whiteboard">
      <h1 class="title">
        <span class="marker-underline">Odd Even Linked List</span>
      </h1>
      <p class="subtitle">Brute Force Approach - Step by Step</p>

      <div class="legend">
        <div class="legend-item">
          <div class="legend-color even"></div>
          <span>Even Index (2, 4, 6...)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color odd"></div>
          <span>Odd Index (1, 3, 5...)</span>
        </div>
      </div>

      <div class="content">
        <div class="viz-area">
          <div class="section-label">üìã Original Linked List</div>
          <div class="linked-list" id="originalList"></div>

          <div class="section-label">üì¶ Collecting Values by Index</div>
          <div class="arrays-container">
            <div class="array-box even-array">
              <div class="array-content" id="evenArray">
                <span class="empty-array">empty</span>
              </div>
            </div>
            <div class="array-box odd-array">
              <div class="array-content" id="oddArray">
                <span class="empty-array">empty</span>
              </div>
            </div>
          </div>

          <div class="result-area">
            <div class="result-label">
              ‚ú® Result: Even-indexed first, then Odd-indexed
            </div>
            <div class="linked-list" id="resultList">
              <span class="empty-array">Building...</span>
            </div>
          </div>
        </div>

        <div class="controls-panel">
          <div class="step-info">
            <div class="step-number" id="stepNumber">Step 0 / 14</div>
            <div class="step-description" id="stepDescription">
              Click "Next" to start the visualization
            </div>
          </div>

          <div class="btn-group">
            <button class="btn btn-prev" id="prevBtn" disabled>‚Üê Prev</button>
            <button class="btn btn-next" id="nextBtn">Next ‚Üí</button>
          </div>
          <button class="btn btn-reset" id="resetBtn">üîÑ Reset</button>
          <button class="btn btn-auto" id="autoBtn">‚ñ∂ Auto Play</button>

          <div class="var-state">
            <div class="var-title">üìä Variable State</div>
            <div class="var-item">
              <span class="var-name">index</span>
              <span class="var-value" id="varIndex">-</span>
            </div>
            <div class="var-item">
              <span class="var-name">current.val</span>
              <span class="var-value" id="varCurrent">-</span>
            </div>
            <div class="var-item">
              <span class="var-name">evenValues</span>
              <span class="var-value" id="varEven">[ ]</span>
            </div>
            <div class="var-item">
              <span class="var-name">oddValues</span>
              <span class="var-value" id="varOdd">[ ]</span>
            </div>
          </div>

          <div class="code-box">
            <div class="code-line" id="code0">
              <span class="code-keyword">while</span> (current) {
            </div>
            <div class="code-line" id="code1">
              <span class="code-keyword">if</span> (index %
              <span class="code-num">2</span> ===
              <span class="code-num">0</span>) {
            </div>
            <div class="code-line" id="code2">
              <span class="code-var">evenValues</span>.push(val);
            </div>
            <div class="code-line" id="code3">
              } <span class="code-keyword">else</span> {
            </div>
            <div class="code-line" id="code4">
              <span class="code-var">oddValues</span>.push(val);
            </div>
            <div class="code-line" id="code5">}</div>
            <div class="code-line" id="code6">current = current.next;</div>
            <div class="code-line" id="code7">index++;</div>
            <div class="code-line" id="code8">}</div>
            <div class="code-line" id="code9">
              <span class="code-comment">// Rebuild list</span>
            </div>
          </div>

          <div class="progress-container">
            <div class="progress-label">Progress</div>
            <div class="progress-bar">
              <div
                class="progress-fill"
                id="progressFill"
                style="width: 0%"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Input data
      const inputValues = [1, 2, 3, 4, 5, 6];

      // State
      let currentStep = 0;
      let autoPlayInterval = null;
      let evenValues = [];
      let oddValues = [];
      let resultNodes = [];

      // Steps definition
      const steps = [
        {
          description:
            "We have input: 1‚Üí2‚Üí3‚Üí4‚Üí5‚Üí6‚Üínull. Goal: Group even-indexed nodes first, then odd-indexed nodes.",
          index: "-",
          current: "-",
          highlight: -1,
          codeLine: -1,
          action: "init",
        },
        {
          description:
            "Start traversal. index=1, current=node(1). Check: is index even? 1 % 2 ‚â† 0, so NO.",
          index: 1,
          current: 1,
          highlight: 0,
          codeLine: 1,
          action: "check",
        },
        {
          description: "Index 1 is ODD. Push value 1 to oddValues array.",
          index: 1,
          current: 1,
          highlight: 0,
          codeLine: 4,
          action: "pushOdd",
          value: 1,
        },
        {
          description:
            "Move to next node. index=2, current=node(2). Check: is index even? 2 % 2 = 0, YES!",
          index: 2,
          current: 2,
          highlight: 1,
          codeLine: 1,
          action: "check",
        },
        {
          description: "Index 2 is EVEN. Push value 2 to evenValues array.",
          index: 2,
          current: 2,
          highlight: 1,
          codeLine: 2,
          action: "pushEven",
          value: 2,
        },
        {
          description:
            "Move to next node. index=3, current=node(3). Check: 3 % 2 ‚â† 0, index is ODD.",
          index: 3,
          current: 3,
          highlight: 2,
          codeLine: 1,
          action: "check",
        },
        {
          description: "Index 3 is ODD. Push value 3 to oddValues array.",
          index: 3,
          current: 3,
          highlight: 2,
          codeLine: 4,
          action: "pushOdd",
          value: 3,
        },
        {
          description:
            "Move to next node. index=4, current=node(4). Check: 4 % 2 = 0, index is EVEN.",
          index: 4,
          current: 4,
          highlight: 3,
          codeLine: 1,
          action: "check",
        },
        {
          description: "Index 4 is EVEN. Push value 4 to evenValues array.",
          index: 4,
          current: 4,
          highlight: 3,
          codeLine: 2,
          action: "pushEven",
          value: 4,
        },
        {
          description:
            "Move to next node. index=5, current=node(5). Check: 5 % 2 ‚â† 0, index is ODD.",
          index: 5,
          current: 5,
          highlight: 4,
          codeLine: 1,
          action: "check",
        },
        {
          description: "Index 5 is ODD. Push value 5 to oddValues array.",
          index: 5,
          current: 5,
          highlight: 4,
          codeLine: 4,
          action: "pushOdd",
          value: 5,
        },
        {
          description:
            "Move to next node. index=6, current=node(6). Check: 6 % 2 = 0, index is EVEN.",
          index: 6,
          current: 6,
          highlight: 5,
          codeLine: 1,
          action: "check",
        },
        {
          description: "Index 6 is EVEN. Push value 6 to evenValues array.",
          index: 6,
          current: 6,
          highlight: 5,
          codeLine: 2,
          action: "pushEven",
          value: 6,
        },
        {
          description:
            "current.next is null. Loop complete! evenValues=[2,4,6], oddValues=[1,3,5]",
          index: "-",
          current: "null",
          highlight: -1,
          codeLine: 8,
          action: "loopEnd",
        },
        {
          description:
            "üéâ REBUILD: Create new list with evenValues first, then oddValues ‚Üí 2‚Üí4‚Üí6‚Üí1‚Üí3‚Üí5‚Üínull",
          index: "-",
          current: "-",
          highlight: -1,
          codeLine: 9,
          action: "rebuild",
        },
      ];

      // DOM elements
      const originalListEl = document.getElementById("originalList");
      const evenArrayEl = document.getElementById("evenArray");
      const oddArrayEl = document.getElementById("oddArray");
      const resultListEl = document.getElementById("resultList");
      const stepNumberEl = document.getElementById("stepNumber");
      const stepDescEl = document.getElementById("stepDescription");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const resetBtn = document.getElementById("resetBtn");
      const autoBtn = document.getElementById("autoBtn");
      const progressFill = document.getElementById("progressFill");
      const varIndex = document.getElementById("varIndex");
      const varCurrent = document.getElementById("varCurrent");
      const varEven = document.getElementById("varEven");
      const varOdd = document.getElementById("varOdd");

      // Render original list
      function renderOriginalList(highlightIdx = -1) {
        originalListEl.innerHTML = "";
        inputValues.forEach((val, idx) => {
          const node = document.createElement("div");
          node.className = "node";

          const isEven = (idx + 1) % 2 === 0;
          const colorClass = isEven ? "even-node" : "odd-node";
          const highlightClass = idx === highlightIdx ? "highlight" : "";
          const processedClass = idx < highlightIdx ? "processed" : "";

          node.innerHTML = `
                    <div class="node-box ${colorClass} ${highlightClass} ${processedClass}">
                        <span class="index-label">${idx + 1}</span>
                        ${val}
                    </div>
                    <span class="arrow">‚Üí</span>
                `;
          originalListEl.appendChild(node);
        });

        const nullNode = document.createElement("div");
        nullNode.className = "null-box";
        nullNode.textContent = "null";
        originalListEl.appendChild(nullNode);
      }

      // Render arrays
      function renderArrays() {
        if (evenValues.length === 0) {
          evenArrayEl.innerHTML = '<span class="empty-array">empty</span>';
        } else {
          evenArrayEl.innerHTML = evenValues
            .map((v) => `<div class="array-item even">${v}</div>`)
            .join("");
        }

        if (oddValues.length === 0) {
          oddArrayEl.innerHTML = '<span class="empty-array">empty</span>';
        } else {
          oddArrayEl.innerHTML = oddValues
            .map((v) => `<div class="array-item odd">${v}</div>`)
            .join("");
        }
      }

      // Render result list
      function renderResultList() {
        if (resultNodes.length === 0) {
          resultListEl.innerHTML =
            '<span class="empty-array">Building...</span>';
          return;
        }

        resultListEl.innerHTML = "";
        resultNodes.forEach((val, idx) => {
          const node = document.createElement("div");
          node.className = "node";

          const isFromEven = idx < evenValues.length;
          const colorClass = isFromEven ? "even-node" : "odd-node";

          node.innerHTML = `
                    <div class="node-box ${colorClass}">
                        ${val}
                    </div>
                    <span class="arrow">‚Üí</span>
                `;
          originalListEl.appendChild(node);
          resultListEl.appendChild(node);
        });

        const nullNode = document.createElement("div");
        nullNode.className = "null-box";
        nullNode.textContent = "null";
        resultListEl.appendChild(nullNode);
      }

      // Update code highlighting
      function updateCodeHighlight(lineIdx) {
        for (let i = 0; i <= 9; i++) {
          document.getElementById(`code${i}`).classList.remove("active");
        }
        if (lineIdx >= 0 && lineIdx <= 9) {
          document.getElementById(`code${lineIdx}`).classList.add("active");
        }
      }

      // Apply step
      function applyStep(stepIdx) {
        const step = steps[stepIdx];

        // Update step info
        stepNumberEl.textContent = `Step ${stepIdx} / ${steps.length - 1}`;
        stepDescEl.textContent = step.description;

        // Update variables display
        varIndex.textContent = step.index;
        varCurrent.textContent = step.current;
        varEven.textContent = `[${evenValues.join(", ")}]`;
        varOdd.textContent = `[${oddValues.join(", ")}]`;

        // Update progress
        progressFill.style.width = `${(stepIdx / (steps.length - 1)) * 100}%`;

        // Update code highlight
        updateCodeHighlight(step.codeLine);

        // Render original list with highlight
        renderOriginalList(step.highlight);

        // Handle actions
        if (step.action === "pushEven" && !evenValues.includes(step.value)) {
          evenValues.push(step.value);
        } else if (
          step.action === "pushOdd" &&
          !oddValues.includes(step.value)
        ) {
          oddValues.push(step.value);
        } else if (step.action === "rebuild") {
          resultNodes = [...evenValues, ...oddValues];
        }

        // Render arrays and result
        renderArrays();
        renderResultList();

        // Update buttons
        prevBtn.disabled = stepIdx === 0;
        nextBtn.disabled = stepIdx === steps.length - 1;
      }

      // Reset state to step
      function resetToStep(targetStep) {
        evenValues = [];
        oddValues = [];
        resultNodes = [];

        // Replay all actions up to targetStep
        for (let i = 0; i <= targetStep; i++) {
          const step = steps[i];
          if (step.action === "pushEven") {
            if (!evenValues.includes(step.value)) evenValues.push(step.value);
          } else if (step.action === "pushOdd") {
            if (!oddValues.includes(step.value)) oddValues.push(step.value);
          } else if (step.action === "rebuild") {
            resultNodes = [...evenValues, ...oddValues];
          }
        }
      }

      // Navigation
      function goToStep(stepIdx) {
        if (stepIdx < 0 || stepIdx >= steps.length) return;

        if (stepIdx < currentStep) {
          resetToStep(stepIdx);
        }

        currentStep = stepIdx;
        applyStep(currentStep);
      }

      function nextStep() {
        goToStep(currentStep + 1);
      }

      function prevStep() {
        goToStep(currentStep - 1);
      }

      function reset() {
        stopAutoPlay();
        evenValues = [];
        oddValues = [];
        resultNodes = [];
        currentStep = 0;
        applyStep(0);
      }

      // Auto play
      function toggleAutoPlay() {
        if (autoPlayInterval) {
          stopAutoPlay();
        } else {
          startAutoPlay();
        }
      }

      function startAutoPlay() {
        autoBtn.textContent = "‚è∏ Pause";
        autoBtn.classList.add("playing");
        autoPlayInterval = setInterval(() => {
          if (currentStep < steps.length - 1) {
            nextStep();
          } else {
            stopAutoPlay();
          }
        }, 1500);
      }

      function stopAutoPlay() {
        autoBtn.textContent = "‚ñ∂ Auto Play";
        autoBtn.classList.remove("playing");
        if (autoPlayInterval) {
          clearInterval(autoPlayInterval);
          autoPlayInterval = null;
        }
      }

      // Event listeners
      prevBtn.addEventListener("click", prevStep);
      nextBtn.addEventListener("click", nextStep);
      resetBtn.addEventListener("click", reset);
      autoBtn.addEventListener("click", toggleAutoPlay);

      // Keyboard navigation
      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight" || e.key === " ") {
          e.preventDefault();
          nextStep();
        } else if (e.key === "ArrowLeft") {
          e.preventDefault();
          prevStep();
        } else if (e.key === "r" || e.key === "R") {
          reset();
        }
      });

      // Initialize
      renderOriginalList();
      applyStep(0);
    </script>
  </body>
</html>
