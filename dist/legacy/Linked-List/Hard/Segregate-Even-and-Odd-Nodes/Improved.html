<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Odd Even Linked List - Two Lists Approach</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;600;700&family=Architects+Daughter&family=Patrick+Hand&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Patrick Hand", cursive;
        background: #2c3e50;
        min-height: 100vh;
        overflow-x: hidden;
      }

      /* Chalkboard container */
      .chalkboard {
        background: linear-gradient(
          145deg,
          #2a4a3e 0%,
          #1e3a2f 50%,
          #1a332a 100%
        );
        min-height: 100vh;
        padding: 30px;
        position: relative;
        box-shadow: inset 0 0 80px rgba(0, 0, 0, 0.4),
          inset 0 0 20px rgba(0, 0, 0, 0.3);
      }

      /* Chalk dust texture */
      .chalkboard::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: radial-gradient(
            ellipse at 20% 30%,
            rgba(255, 255, 255, 0.02) 0%,
            transparent 50%
          ),
          radial-gradient(
            ellipse at 80% 70%,
            rgba(255, 255, 255, 0.015) 0%,
            transparent 50%
          );
        pointer-events: none;
      }

      /* Wooden frame */
      .chalkboard::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        border: 15px solid #5d4037;
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5),
          0 5px 20px rgba(0, 0, 0, 0.3);
        pointer-events: none;
        background: linear-gradient(
            90deg,
            #6d4c41 0%,
            #8d6e63 2%,
            #5d4037 4%,
            transparent 4%,
            transparent 96%,
            #5d4037 96%,
            #8d6e63 98%,
            #6d4c41 100%
          ),
          linear-gradient(
            180deg,
            #6d4c41 0%,
            #8d6e63 2%,
            #5d4037 4%,
            transparent 4%,
            transparent 96%,
            #5d4037 96%,
            #8d6e63 98%,
            #6d4c41 100%
          );
      }

      .title {
        font-family: "Caveat", cursive;
        font-size: 2.8rem;
        font-weight: 700;
        color: #f5f5dc;
        text-align: center;
        margin-bottom: 5px;
        position: relative;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        letter-spacing: 2px;
      }

      .subtitle {
        font-family: "Caveat", cursive;
        font-size: 1.4rem;
        color: #ffd54f;
        text-align: center;
        margin-bottom: 25px;
        position: relative;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
      }

      /* Chalk underline effect */
      .chalk-underline {
        position: relative;
        display: inline-block;
      }

      .chalk-underline::after {
        content: "";
        position: absolute;
        bottom: -3px;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(
          90deg,
          transparent 0%,
          rgba(255, 213, 79, 0.8) 10%,
          rgba(255, 213, 79, 0.9) 50%,
          rgba(255, 213, 79, 0.8) 90%,
          transparent 100%
        );
        border-radius: 2px;
      }

      /* Main content grid */
      .content {
        display: grid;
        grid-template-columns: 1fr 320px;
        gap: 25px;
        max-width: 1450px;
        margin: 0 auto;
        position: relative;
        z-index: 1;
      }

      /* Visualization area */
      .viz-area {
        background: rgba(0, 0, 0, 0.15);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        padding: 20px;
        position: relative;
      }

      .viz-area::before {
        content: "VISUALIZATION";
        position: absolute;
        top: -10px;
        left: 20px;
        background: #4db6ac;
        color: #1a332a;
        padding: 2px 12px;
        font-size: 0.8rem;
        border-radius: 4px;
        font-family: "Patrick Hand", cursive;
        font-weight: 600;
      }

      /* Section labels */
      .section-label {
        font-family: "Caveat", cursive;
        font-size: 1.3rem;
        font-weight: 600;
        color: #f5f5dc;
        margin: 15px 0 12px 0;
        padding-left: 10px;
        border-left: 3px solid #4db6ac;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
      }

      /* Linked list visualization */
      .linked-list {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        gap: 4px;
        padding: 15px;
        min-height: 80px;
      }

      .node {
        display: flex;
        align-items: center;
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .node.fade-out {
        opacity: 0.2;
        transform: scale(0.9);
      }

      .node-box {
        width: 50px;
        height: 50px;
        border: 3px solid rgba(255, 255, 255, 0.8);
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-family: "Caveat", cursive;
        font-size: 1.7rem;
        font-weight: 700;
        background: rgba(255, 255, 255, 0.1);
        color: #f5f5dc;
        position: relative;
        transition: all 0.3s ease;
        box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.3);
      }

      .node-box.highlight {
        transform: scale(1.2);
        border-color: #ff7043;
        box-shadow: 0 0 20px rgba(255, 112, 67, 0.6);
        background: rgba(255, 112, 67, 0.2);
      }

      .node-box.even-node {
        background: rgba(129, 199, 132, 0.3);
        border-color: #81c784;
        color: #a5d6a7;
      }

      .node-box.odd-node {
        background: rgba(255, 213, 79, 0.3);
        border-color: #ffd54f;
        color: #ffe082;
      }

      .node-box.detached {
        border-style: dashed;
        opacity: 0.6;
      }

      .index-label {
        position: absolute;
        top: -20px;
        left: 50%;
        transform: translateX(-50%);
        font-size: 0.8rem;
        color: rgba(255, 255, 255, 0.6);
        font-weight: 600;
      }

      .arrow {
        font-size: 1.3rem;
        color: rgba(255, 255, 255, 0.7);
        margin: 0 2px;
        font-weight: bold;
      }

      .arrow.broken {
        color: #ef5350;
        text-decoration: line-through;
        opacity: 0.5;
      }

      .null-box {
        padding: 6px 12px;
        background: rgba(255, 255, 255, 0.1);
        border: 2px dashed rgba(255, 255, 255, 0.4);
        border-radius: 4px;
        font-family: "Patrick Hand", cursive;
        color: rgba(255, 255, 255, 0.5);
        font-size: 0.9rem;
      }

      /* Two lists container */
      .two-lists-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin: 15px 0;
      }

      .list-box {
        background: rgba(0, 0, 0, 0.2);
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 8px;
        padding: 15px;
        position: relative;
        min-height: 120px;
      }

      .list-box.even-list {
        border-color: rgba(129, 199, 132, 0.6);
      }

      .list-box.even-list::before {
        content: "Even List (evenDummy ‚Üí)";
        background: #81c784;
        color: #1a332a;
      }

      .list-box.odd-list {
        border-color: rgba(255, 213, 79, 0.6);
      }

      .list-box.odd-list::before {
        content: "Odd List (oddDummy ‚Üí)";
        background: #ffd54f;
        color: #1a332a;
      }

      .list-box::before {
        position: absolute;
        top: -10px;
        left: 12px;
        padding: 2px 10px;
        font-size: 0.75rem;
        border-radius: 4px;
        font-family: "Patrick Hand", cursive;
        font-weight: 600;
      }

      .list-content {
        display: flex;
        align-items: center;
        justify-content: center;
        flex-wrap: wrap;
        gap: 4px;
        min-height: 60px;
      }

      .empty-list {
        color: rgba(255, 255, 255, 0.4);
        font-style: italic;
        font-size: 0.95rem;
      }

      .dummy-node {
        width: 40px;
        height: 40px;
        border: 2px dashed rgba(255, 255, 255, 0.4);
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.5);
        background: rgba(255, 255, 255, 0.05);
      }

      /* Pointer indicators */
      .pointer-label {
        position: absolute;
        font-size: 0.7rem;
        padding: 2px 6px;
        border-radius: 3px;
        font-family: "Courier New", monospace;
        white-space: nowrap;
      }

      .pointer-label.even-tail {
        background: #81c784;
        color: #1a332a;
        bottom: -18px;
      }

      .pointer-label.odd-tail {
        background: #ffd54f;
        color: #1a332a;
        bottom: -18px;
      }

      /* Result area */
      .result-area {
        margin-top: 15px;
        padding: 15px;
        background: rgba(77, 182, 172, 0.15);
        border-radius: 8px;
        border: 2px dashed rgba(77, 182, 172, 0.5);
      }

      .result-label {
        font-family: "Caveat", cursive;
        font-size: 1.2rem;
        color: #4db6ac;
        margin-bottom: 10px;
        text-align: center;
      }

      /* Controls panel */
      .controls-panel {
        background: rgba(0, 0, 0, 0.25);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 8px;
        padding: 18px;
        position: sticky;
        top: 20px;
      }

      .controls-panel::before {
        content: "CONTROLS";
        position: absolute;
        top: -10px;
        left: 18px;
        background: #ba68c8;
        color: white;
        padding: 2px 12px;
        font-size: 0.8rem;
        border-radius: 4px;
        font-family: "Patrick Hand", cursive;
        font-weight: 600;
      }

      .step-info {
        background: rgba(255, 255, 255, 0.08);
        border-radius: 6px;
        padding: 12px;
        margin-bottom: 15px;
        border-left: 3px solid #4db6ac;
      }

      .step-number {
        font-family: "Caveat", cursive;
        font-size: 1.6rem;
        color: #4db6ac;
        font-weight: 700;
      }

      .step-description {
        font-size: 0.95rem;
        color: #f5f5dc;
        margin-top: 6px;
        line-height: 1.4;
      }

      /* Buttons */
      .btn-group {
        display: flex;
        gap: 8px;
        margin-bottom: 12px;
      }

      .btn {
        flex: 1;
        padding: 10px 12px;
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-radius: 6px;
        font-family: "Patrick Hand", cursive;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.2s ease;
        color: white;
      }

      .btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      .btn:active:not(:disabled) {
        transform: translateY(0);
      }

      .btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
      }

      .btn-prev {
        background: rgba(255, 255, 255, 0.1);
      }

      .btn-next {
        background: #4db6ac;
        border-color: #4db6ac;
      }

      .btn-reset {
        background: #ef5350;
        border-color: #ef5350;
        width: 100%;
      }

      .btn-auto {
        background: #66bb6a;
        border-color: #66bb6a;
        width: 100%;
        margin-top: 8px;
      }

      .btn-auto.playing {
        background: #ffa726;
        border-color: #ffa726;
      }

      /* Variable state */
      .var-state {
        background: rgba(0, 0, 0, 0.3);
        border-radius: 6px;
        padding: 12px;
        margin-top: 15px;
      }

      .var-title {
        color: #f5f5dc;
        font-size: 0.95rem;
        margin-bottom: 10px;
        padding-bottom: 6px;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      }

      .var-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 4px 0;
        font-size: 0.85rem;
      }

      .var-name {
        color: #ffa726;
        font-family: "Courier New", monospace;
      }

      .var-value {
        color: #69f0ae;
        font-family: "Courier New", monospace;
        background: rgba(105, 240, 174, 0.1);
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 0.8rem;
      }

      /* Code display */
      .code-box {
        background: rgba(0, 0, 0, 0.4);
        border-radius: 6px;
        padding: 12px;
        margin-top: 15px;
        overflow-x: auto;
        max-height: 200px;
        overflow-y: auto;
      }

      .code-line {
        font-family: "Courier New", monospace;
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.7);
        padding: 2px 0;
        white-space: pre;
        transition: all 0.3s ease;
      }

      .code-line.active {
        background: rgba(77, 182, 172, 0.3);
        border-left: 2px solid #4db6ac;
        padding-left: 8px;
        margin-left: -8px;
        color: #f5f5dc;
      }

      .code-keyword {
        color: #ce93d8;
      }

      .code-var {
        color: #ffa726;
      }

      .code-comment {
        color: rgba(255, 255, 255, 0.4);
      }

      /* Progress bar */
      .progress-container {
        margin-top: 15px;
      }

      .progress-label {
        font-size: 0.85rem;
        color: rgba(255, 255, 255, 0.6);
        margin-bottom: 6px;
      }

      .progress-bar {
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #4db6ac, #ba68c8);
        border-radius: 3px;
        transition: width 0.3s ease;
      }

      /* Legend */
      .legend {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 15px 0;
        flex-wrap: wrap;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 0.9rem;
        color: #f5f5dc;
      }

      .legend-color {
        width: 22px;
        height: 22px;
        border-radius: 4px;
        border: 2px solid rgba(255, 255, 255, 0.5);
      }

      .legend-color.even {
        background: rgba(129, 199, 132, 0.4);
        border-color: #81c784;
      }

      .legend-color.odd {
        background: rgba(255, 213, 79, 0.4);
        border-color: #ffd54f;
      }

      /* Connection animation */
      .connection-line {
        position: absolute;
        height: 3px;
        background: #4db6ac;
        transform-origin: left center;
        animation: drawLine 0.5s ease forwards;
      }

      @keyframes drawLine {
        from {
          transform: scaleX(0);
        }
        to {
          transform: scaleX(1);
        }
      }

      @keyframes nodeSlide {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .node-animate {
        animation: nodeSlide 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* Responsive */
      @media (max-width: 950px) {
        .content {
          grid-template-columns: 1fr;
        }

        .controls-panel {
          position: static;
        }

        .title {
          font-size: 2rem;
        }

        .two-lists-container {
          grid-template-columns: 1fr;
        }
      }

      /* Key insight box */
      .insight-box {
        background: rgba(186, 104, 200, 0.2);
        border: 2px solid rgba(186, 104, 200, 0.5);
        border-radius: 8px;
        padding: 12px;
        margin: 15px 0;
        text-align: center;
      }

      .insight-text {
        color: #ce93d8;
        font-size: 1rem;
        font-style: italic;
      }

      .insight-icon {
        font-size: 1.3rem;
        margin-right: 8px;
      }
    </style>
  </head>
  <body>
    <div class="chalkboard">
      <h1 class="title">
        <span class="chalk-underline">Odd Even Linked List</span>
      </h1>
      <p class="subtitle">Two Lists Approach - Reusing Nodes (O(1) Space)</p>

      <div class="legend">
        <div class="legend-item">
          <div class="legend-color even"></div>
          <span>Even Index (2, 4, 6...)</span>
        </div>
        <div class="legend-item">
          <div class="legend-color odd"></div>
          <span>Odd Index (1, 3, 5...)</span>
        </div>
      </div>

      <div class="content">
        <div class="viz-area">
          <div class="section-label">üìã Original Linked List</div>
          <div class="linked-list" id="originalList"></div>

          <div class="insight-box">
            <span class="insight-icon">üí°</span>
            <span class="insight-text" id="insightText"
              >Key Insight: We detach nodes and add them to separate lists, then
              concatenate!</span
            >
          </div>

          <div class="section-label">üîó Building Two Separate Lists</div>
          <div class="two-lists-container">
            <div class="list-box even-list">
              <div class="list-content" id="evenList">
                <div class="dummy-node">D</div>
                <span class="arrow">‚Üí</span>
                <span class="empty-list">empty</span>
              </div>
            </div>
            <div class="list-box odd-list">
              <div class="list-content" id="oddList">
                <div class="dummy-node">D</div>
                <span class="arrow">‚Üí</span>
                <span class="empty-list">empty</span>
              </div>
            </div>
          </div>

          <div class="result-area">
            <div class="result-label">
              ‚ú® Final Result: Even List ‚Üí Odd List
            </div>
            <div class="linked-list" id="resultList">
              <span class="empty-list">Waiting for concatenation...</span>
            </div>
          </div>
        </div>

        <div class="controls-panel">
          <div class="step-info">
            <div class="step-number" id="stepNumber">Step 0 / 16</div>
            <div class="step-description" id="stepDescription">
              Click "Next" to start the visualization
            </div>
          </div>

          <div class="btn-group">
            <button class="btn btn-prev" id="prevBtn" disabled>‚Üê Prev</button>
            <button class="btn btn-next" id="nextBtn">Next ‚Üí</button>
          </div>
          <button class="btn btn-reset" id="resetBtn">üîÑ Reset</button>
          <button class="btn btn-auto" id="autoBtn">‚ñ∂ Auto Play</button>

          <div class="var-state">
            <div class="var-title">üìä Pointer State</div>
            <div class="var-item">
              <span class="var-name">index</span>
              <span class="var-value" id="varIndex">-</span>
            </div>
            <div class="var-item">
              <span class="var-name">current</span>
              <span class="var-value" id="varCurrent">-</span>
            </div>
            <div class="var-item">
              <span class="var-name">evenTail</span>
              <span class="var-value" id="varEvenTail">dummy</span>
            </div>
            <div class="var-item">
              <span class="var-name">oddTail</span>
              <span class="var-value" id="varOddTail">dummy</span>
            </div>
          </div>

          <div class="code-box">
            <div class="code-line" id="code0">
              <span class="code-keyword">while</span> (current) {
            </div>
            <div class="code-line" id="code1">nextNode = current.next;</div>
            <div class="code-line" id="code2">
              current.next = <span class="code-keyword">null</span>;
              <span class="code-comment">// detach</span>
            </div>
            <div class="code-line" id="code3">
              <span class="code-keyword">if</span> (index % 2 === 0) {
            </div>
            <div class="code-line" id="code4">
              <span class="code-var">evenTail</span>.next = current;
            </div>
            <div class="code-line" id="code5">
              <span class="code-var">evenTail</span> = current;
            </div>
            <div class="code-line" id="code6">
              } <span class="code-keyword">else</span> {
            </div>
            <div class="code-line" id="code7">
              <span class="code-var">oddTail</span>.next = current;
            </div>
            <div class="code-line" id="code8">
              <span class="code-var">oddTail</span> = current;
            </div>
            <div class="code-line" id="code9">}</div>
            <div class="code-line" id="code10">current = nextNode;</div>
            <div class="code-line" id="code11">}</div>
            <div class="code-line" id="code12">
              <span class="code-comment">// Connect lists</span>
            </div>
            <div class="code-line" id="code13">
              <span class="code-var">evenTail</span>.next = oddDummy.next;
            </div>
          </div>

          <div class="progress-container">
            <div class="progress-label">Progress</div>
            <div class="progress-bar">
              <div
                class="progress-fill"
                id="progressFill"
                style="width: 0%"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Input data
      const inputValues = [1, 2, 3, 4, 5, 6];

      // State
      let currentStep = 0;
      let autoPlayInterval = null;
      let evenNodes = [];
      let oddNodes = [];
      let processedIndices = new Set();
      let resultNodes = [];

      // Steps definition
      const steps = [
        {
          description:
            "Input: 1‚Üí2‚Üí3‚Üí4‚Üí5‚Üí6‚Üínull. We'll create two separate lists using dummy nodes, then concatenate them.",
          index: "-",
          current: "-",
          evenTail: "dummy",
          oddTail: "dummy",
          highlight: -1,
          codeLine: -1,
          insight:
            "Key Insight: We detach nodes and reuse them - no new memory allocation needed!",
          action: "init",
        },
        {
          description:
            "Start: index=1, current=node(1). Save next pointer, then detach current node.",
          index: 1,
          current: "node(1)",
          evenTail: "dummy",
          oddTail: "dummy",
          highlight: 0,
          codeLine: 1,
          insight:
            "Saving nextNode before detaching prevents losing the rest of the list!",
          action: "visit",
        },
        {
          description:
            "index=1 is ODD. Attach node(1) to oddTail (dummy). Now oddTail points to node(1).",
          index: 1,
          current: "node(1)",
          evenTail: "dummy",
          oddTail: "node(1)",
          highlight: 0,
          codeLine: 7,
          insight:
            "oddDummy ‚Üí node(1). The node is physically moved, not copied!",
          action: "addOdd",
          value: 1,
        },
        {
          description:
            "Move to next: index=2, current=node(2). Save next, detach.",
          index: 2,
          current: "node(2)",
          evenTail: "dummy",
          oddTail: "node(1)",
          highlight: 1,
          codeLine: 1,
          insight: "Processing node 2 - this has an even index...",
          action: "visit",
        },
        {
          description:
            "index=2 is EVEN. Attach node(2) to evenTail (dummy). Now evenTail points to node(2).",
          index: 2,
          current: "node(2)",
          evenTail: "node(2)",
          oddTail: "node(1)",
          highlight: 1,
          codeLine: 4,
          insight:
            "evenDummy ‚Üí node(2). Even and odd lists grow independently!",
          action: "addEven",
          value: 2,
        },
        {
          description:
            "Move to next: index=3, current=node(3). Save next, detach.",
          index: 3,
          current: "node(3)",
          evenTail: "node(2)",
          oddTail: "node(1)",
          highlight: 2,
          codeLine: 1,
          insight: "Node 3 is at odd index...",
          action: "visit",
        },
        {
          description:
            "index=3 is ODD. Attach node(3) to oddTail. oddTail advances to node(3).",
          index: 3,
          current: "node(3)",
          evenTail: "node(2)",
          oddTail: "node(3)",
          highlight: 2,
          codeLine: 7,
          insight: "oddDummy ‚Üí node(1) ‚Üí node(3). Odd list grows!",
          action: "addOdd",
          value: 3,
        },
        {
          description:
            "Move to next: index=4, current=node(4). Save next, detach.",
          index: 4,
          current: "node(4)",
          evenTail: "node(2)",
          oddTail: "node(3)",
          highlight: 3,
          codeLine: 1,
          insight: "Node 4 is at even index...",
          action: "visit",
        },
        {
          description:
            "index=4 is EVEN. Attach node(4) to evenTail. evenTail advances to node(4).",
          index: 4,
          current: "node(4)",
          evenTail: "node(4)",
          oddTail: "node(3)",
          highlight: 3,
          codeLine: 4,
          insight: "evenDummy ‚Üí node(2) ‚Üí node(4). Even list grows!",
          action: "addEven",
          value: 4,
        },
        {
          description:
            "Move to next: index=5, current=node(5). Save next, detach.",
          index: 5,
          current: "node(5)",
          evenTail: "node(4)",
          oddTail: "node(3)",
          highlight: 4,
          codeLine: 1,
          insight: "Node 5 is at odd index...",
          action: "visit",
        },
        {
          description:
            "index=5 is ODD. Attach node(5) to oddTail. oddTail advances to node(5).",
          index: 5,
          current: "node(5)",
          evenTail: "node(4)",
          oddTail: "node(5)",
          highlight: 4,
          codeLine: 7,
          insight: "oddDummy ‚Üí node(1) ‚Üí node(3) ‚Üí node(5). Almost done!",
          action: "addOdd",
          value: 5,
        },
        {
          description:
            "Move to next: index=6, current=node(6). Save next (null), detach.",
          index: 6,
          current: "node(6)",
          evenTail: "node(4)",
          oddTail: "node(5)",
          highlight: 5,
          codeLine: 1,
          insight: "Last node! Node 6 is at even index...",
          action: "visit",
        },
        {
          description:
            "index=6 is EVEN. Attach node(6) to evenTail. evenTail advances to node(6).",
          index: 6,
          current: "node(6)",
          evenTail: "node(6)",
          oddTail: "node(5)",
          highlight: 5,
          codeLine: 4,
          insight:
            "evenDummy ‚Üí node(2) ‚Üí node(4) ‚Üí node(6). All nodes distributed!",
          action: "addEven",
          value: 6,
        },
        {
          description:
            "current.next was null, so current becomes null. Loop exits!",
          index: "-",
          current: "null",
          evenTail: "node(6)",
          oddTail: "node(5)",
          highlight: -1,
          codeLine: 11,
          insight:
            "Loop complete! Now we have two separate lists ready to connect.",
          action: "loopEnd",
        },
        {
          description:
            "CONCATENATE: evenTail.next = oddDummy.next. Connect even list's tail to odd list's head!",
          index: "-",
          current: "-",
          evenTail: "node(6)",
          oddTail: "node(5)",
          highlight: -1,
          codeLine: 13,
          insight:
            "The magic moment: linking node(6) ‚Üí node(1) joins both lists!",
          action: "connect",
        },
        {
          description:
            "üéâ DONE! Return evenDummy.next ‚Üí 2‚Üí4‚Üí6‚Üí1‚Üí3‚Üí5‚Üínull. O(n) time, O(1) space!",
          index: "-",
          current: "-",
          evenTail: "node(6)",
          oddTail: "node(5)",
          highlight: -1,
          codeLine: -1,
          insight:
            "We reused all original nodes - zero extra memory allocation! üöÄ",
          action: "done",
        },
      ];

      // DOM elements
      const originalListEl = document.getElementById("originalList");
      const evenListEl = document.getElementById("evenList");
      const oddListEl = document.getElementById("oddList");
      const resultListEl = document.getElementById("resultList");
      const stepNumberEl = document.getElementById("stepNumber");
      const stepDescEl = document.getElementById("stepDescription");
      const insightTextEl = document.getElementById("insightText");
      const prevBtn = document.getElementById("prevBtn");
      const nextBtn = document.getElementById("nextBtn");
      const resetBtn = document.getElementById("resetBtn");
      const autoBtn = document.getElementById("autoBtn");
      const progressFill = document.getElementById("progressFill");
      const varIndex = document.getElementById("varIndex");
      const varCurrent = document.getElementById("varCurrent");
      const varEvenTail = document.getElementById("varEvenTail");
      const varOddTail = document.getElementById("varOddTail");

      // Render original list
      function renderOriginalList(highlightIdx = -1) {
        originalListEl.innerHTML = "";
        inputValues.forEach((val, idx) => {
          const node = document.createElement("div");
          const isProcessed = processedIndices.has(idx);
          node.className = `node ${isProcessed ? "fade-out" : ""}`;

          const isEven = (idx + 1) % 2 === 0;
          const colorClass = isEven ? "even-node" : "odd-node";
          const highlightClass = idx === highlightIdx ? "highlight" : "";
          const detachedClass = isProcessed ? "detached" : "";

          node.innerHTML = `
                    <div class="node-box ${colorClass} ${highlightClass} ${detachedClass}">
                        <span class="index-label">${idx + 1}</span>
                        ${val}
                    </div>
                    <span class="arrow ${
                      isProcessed && idx < inputValues.length - 1
                        ? "broken"
                        : ""
                    }">‚Üí</span>
                `;
          originalListEl.appendChild(node);
        });

        const nullNode = document.createElement("div");
        nullNode.className = "null-box";
        nullNode.textContent = "null";
        originalListEl.appendChild(nullNode);
      }

      // Render list with dummy node
      function renderListWithDummy(container, nodes, type) {
        container.innerHTML = "";

        // Dummy node
        const dummy = document.createElement("div");
        dummy.className = "dummy-node";
        dummy.textContent = "D";
        container.appendChild(dummy);

        const arrow1 = document.createElement("span");
        arrow1.className = "arrow";
        arrow1.textContent = "‚Üí";
        container.appendChild(arrow1);

        if (nodes.length === 0) {
          const empty = document.createElement("span");
          empty.className = "empty-list";
          empty.textContent = "null";
          container.appendChild(empty);
        } else {
          nodes.forEach((val, idx) => {
            const nodeDiv = document.createElement("div");
            nodeDiv.className = "node node-animate";
            nodeDiv.style.animationDelay = `${idx * 0.1}s`;

            const colorClass = type === "even" ? "even-node" : "odd-node";
            const isLast = idx === nodes.length - 1;

            nodeDiv.innerHTML = `
                        <div class="node-box ${colorClass}" style="position: relative;">
                            ${val}
                            ${
                              isLast
                                ? `<span class="pointer-label ${type}-tail">${type}Tail</span>`
                                : ""
                            }
                        </div>
                        <span class="arrow">‚Üí</span>
                    `;
            container.appendChild(nodeDiv);
          });

          const nullBox = document.createElement("div");
          nullBox.className = "null-box";
          nullBox.textContent = "null";
          container.appendChild(nullBox);
        }
      }

      // Render result list
      function renderResultList() {
        if (resultNodes.length === 0) {
          resultListEl.innerHTML =
            '<span class="empty-list">Waiting for concatenation...</span>';
          return;
        }

        resultListEl.innerHTML = "";
        resultNodes.forEach((val, idx) => {
          const node = document.createElement("div");
          node.className = "node node-animate";
          node.style.animationDelay = `${idx * 0.08}s`;

          const isFromEven = idx < evenNodes.length;
          const colorClass = isFromEven ? "even-node" : "odd-node";

          node.innerHTML = `
                    <div class="node-box ${colorClass}">
                        ${val}
                    </div>
                    <span class="arrow">‚Üí</span>
                `;
          resultListEl.appendChild(node);
        });

        const nullNode = document.createElement("div");
        nullNode.className = "null-box";
        nullNode.textContent = "null";
        resultListEl.appendChild(nullNode);
      }

      // Update code highlighting
      function updateCodeHighlight(lineIdx) {
        for (let i = 0; i <= 13; i++) {
          const el = document.getElementById(`code${i}`);
          if (el) el.classList.remove("active");
        }
        if (lineIdx >= 0 && lineIdx <= 13) {
          const el = document.getElementById(`code${lineIdx}`);
          if (el) el.classList.add("active");
        }
      }

      // Apply step
      function applyStep(stepIdx) {
        const step = steps[stepIdx];

        // Update step info
        stepNumberEl.textContent = `Step ${stepIdx} / ${steps.length - 1}`;
        stepDescEl.textContent = step.description;
        insightTextEl.textContent = step.insight;

        // Update variables display
        varIndex.textContent = step.index;
        varCurrent.textContent = step.current;
        varEvenTail.textContent = step.evenTail;
        varOddTail.textContent = step.oddTail;

        // Update progress
        progressFill.style.width = `${(stepIdx / (steps.length - 1)) * 100}%`;

        // Update code highlight
        updateCodeHighlight(step.codeLine);

        // Handle actions
        if (step.action === "addEven") {
          if (!evenNodes.includes(step.value)) {
            evenNodes.push(step.value);
          }
          processedIndices.add(step.highlight);
        } else if (step.action === "addOdd") {
          if (!oddNodes.includes(step.value)) {
            oddNodes.push(step.value);
          }
          processedIndices.add(step.highlight);
        } else if (step.action === "connect" || step.action === "done") {
          resultNodes = [...evenNodes, ...oddNodes];
        }

        // Render everything
        renderOriginalList(step.highlight);
        renderListWithDummy(evenListEl, evenNodes, "even");
        renderListWithDummy(oddListEl, oddNodes, "odd");
        renderResultList();

        // Update buttons
        prevBtn.disabled = stepIdx === 0;
        nextBtn.disabled = stepIdx === steps.length - 1;
      }

      // Reset state to step
      function resetToStep(targetStep) {
        evenNodes = [];
        oddNodes = [];
        processedIndices = new Set();
        resultNodes = [];

        // Replay all actions up to targetStep
        for (let i = 0; i <= targetStep; i++) {
          const step = steps[i];
          if (step.action === "addEven") {
            if (!evenNodes.includes(step.value)) evenNodes.push(step.value);
            processedIndices.add(step.highlight);
          } else if (step.action === "addOdd") {
            if (!oddNodes.includes(step.value)) oddNodes.push(step.value);
            processedIndices.add(step.highlight);
          } else if (step.action === "connect" || step.action === "done") {
            resultNodes = [...evenNodes, ...oddNodes];
          }
        }
      }

      // Navigation
      function goToStep(stepIdx) {
        if (stepIdx < 0 || stepIdx >= steps.length) return;

        if (stepIdx < currentStep) {
          resetToStep(stepIdx);
        }

        currentStep = stepIdx;
        applyStep(currentStep);
      }

      function nextStep() {
        goToStep(currentStep + 1);
      }

      function prevStep() {
        goToStep(currentStep - 1);
      }

      function reset() {
        stopAutoPlay();
        evenNodes = [];
        oddNodes = [];
        processedIndices = new Set();
        resultNodes = [];
        currentStep = 0;
        applyStep(0);
      }

      // Auto play
      function toggleAutoPlay() {
        if (autoPlayInterval) {
          stopAutoPlay();
        } else {
          startAutoPlay();
        }
      }

      function startAutoPlay() {
        autoBtn.textContent = "‚è∏ Pause";
        autoBtn.classList.add("playing");
        autoPlayInterval = setInterval(() => {
          if (currentStep < steps.length - 1) {
            nextStep();
          } else {
            stopAutoPlay();
          }
        }, 1800);
      }

      function stopAutoPlay() {
        autoBtn.textContent = "‚ñ∂ Auto Play";
        autoBtn.classList.remove("playing");
        if (autoPlayInterval) {
          clearInterval(autoPlayInterval);
          autoPlayInterval = null;
        }
      }

      // Event listeners
      prevBtn.addEventListener("click", prevStep);
      nextBtn.addEventListener("click", nextStep);
      resetBtn.addEventListener("click", reset);
      autoBtn.addEventListener("click", toggleAutoPlay);

      // Keyboard navigation
      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowRight" || e.key === " ") {
          e.preventDefault();
          nextStep();
        } else if (e.key === "ArrowLeft") {
          e.preventDefault();
          prevStep();
        } else if (e.key === "r" || e.key === "R") {
          reset();
        }
      });

      // Initialize
      renderOriginalList();
      renderListWithDummy(evenListEl, [], "even");
      renderListWithDummy(oddListEl, [], "odd");
      applyStep(0);
    </script>
  </body>
</html>
