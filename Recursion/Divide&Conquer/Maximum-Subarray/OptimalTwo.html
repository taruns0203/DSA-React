<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Maximum Subarray - Kadane's Algorithm O(n)</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #0d1b2a 0%,
          #1b263b 50%,
          #415a77 100%
        );
        min-height: 100vh;
        padding: 20px;
        color: #eee;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        color: #00f5d4;
        margin-bottom: 10px;
        font-size: 2.2rem;
        text-shadow: 0 0 30px rgba(0, 245, 212, 0.5);
      }

      .subtitle {
        text-align: center;
        color: #888;
        margin-bottom: 10px;
        font-size: 1rem;
      }

      .badges {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 25px;
        flex-wrap: wrap;
      }

      .badge {
        padding: 8px 20px;
        border-radius: 25px;
        font-weight: bold;
        font-size: 0.85rem;
      }

      .badge.optimal {
        background: linear-gradient(135deg, #00f5d4, #00bbf9);
        color: #000;
      }

      .badge.time {
        background: rgba(0, 245, 212, 0.2);
        color: #00f5d4;
        border: 2px solid #00f5d4;
      }

      .badge.space {
        background: rgba(254, 228, 64, 0.2);
        color: #fee440;
        border: 2px solid #fee440;
      }

      .whiteboard {
        background: #0a0f1a;
        border-radius: 25px;
        padding: 35px;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5),
          0 0 100px rgba(0, 245, 212, 0.1);
        border: 1px solid #1a2a3a;
      }

      /* Key Insight Banner */
      .insight-banner {
        background: linear-gradient(
          135deg,
          rgba(0, 245, 212, 0.1),
          rgba(0, 187, 249, 0.1)
        );
        border: 2px solid #00f5d4;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 30px;
        text-align: center;
      }

      .insight-banner h3 {
        color: #00f5d4;
        margin-bottom: 10px;
        font-size: 1.1rem;
      }

      .insight-banner .question {
        font-size: 1.3rem;
        color: #fff;
        margin-bottom: 15px;
      }

      .insight-options {
        display: flex;
        justify-content: center;
        gap: 30px;
        flex-wrap: wrap;
      }

      .insight-option {
        background: #1a2a3a;
        padding: 15px 25px;
        border-radius: 12px;
        text-align: center;
        min-width: 180px;
        transition: all 0.3s ease;
      }

      .insight-option.extend {
        border: 2px solid #00bbf9;
      }

      .insight-option.restart {
        border: 2px solid #f72585;
      }

      .insight-option.active-extend {
        background: rgba(0, 187, 249, 0.3);
        box-shadow: 0 0 20px rgba(0, 187, 249, 0.5);
        transform: scale(1.05);
      }

      .insight-option.active-restart {
        background: rgba(247, 37, 133, 0.3);
        box-shadow: 0 0 20px rgba(247, 37, 133, 0.5);
        transform: scale(1.05);
      }

      .insight-option .icon {
        font-size: 2rem;
        margin-bottom: 8px;
      }

      .insight-option .label {
        font-size: 0.9rem;
        color: #888;
      }

      .insight-option .condition {
        font-size: 0.75rem;
        color: #666;
        margin-top: 5px;
      }

      /* Array Section */
      .array-section {
        margin-bottom: 25px;
      }

      .section-title {
        color: #00f5d4;
        font-size: 1.1rem;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .section-title::before {
        content: "";
        width: 4px;
        height: 20px;
        background: linear-gradient(180deg, #00f5d4, #00bbf9);
        border-radius: 2px;
      }

      .array-container {
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
        margin-bottom: 15px;
      }

      .array-cell {
        width: 70px;
        height: 70px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: #1a2a3a;
        border-radius: 15px;
        border: 3px solid #2a3a4a;
        transition: all 0.4s ease;
        position: relative;
      }

      .array-cell.current {
        border-color: #fee440;
        box-shadow: 0 0 25px rgba(254, 228, 64, 0.6);
        transform: scale(1.1);
      }

      .array-cell.in-subarray {
        background: linear-gradient(135deg, #1a3a4a, #2a5a6a);
        border-color: #00bbf9;
      }

      .array-cell.best-subarray {
        background: linear-gradient(135deg, #1a4a3a, #2a6a5a);
        border-color: #00f5d4;
        box-shadow: 0 0 20px rgba(0, 245, 212, 0.4);
      }

      .array-cell.negative-sum-indicator {
        border-color: #f72585;
      }

      .cell-index {
        font-size: 0.65rem;
        color: #556;
        position: absolute;
        top: 4px;
        left: 8px;
      }

      .cell-value {
        font-size: 1.5rem;
        font-weight: bold;
      }

      .cell-value.negative {
        color: #f72585;
      }
      .cell-value.positive {
        color: #00f5d4;
      }

      .cell-decision {
        position: absolute;
        bottom: -25px;
        font-size: 0.7rem;
        padding: 2px 8px;
        border-radius: 10px;
        white-space: nowrap;
      }

      .cell-decision.extend {
        background: #00bbf9;
        color: #000;
      }

      .cell-decision.restart {
        background: #f72585;
        color: #fff;
      }

      /* Pointer */
      .pointer-row {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 35px;
      }

      .pointer-slot {
        width: 70px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .pointer {
        color: #fee440;
        font-weight: bold;
        font-size: 1.1rem;
        animation: bounce 0.5s ease infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-5px);
        }
      }

      /* Decision Visualization */
      .decision-panel {
        background: #0d1520;
        border-radius: 20px;
        padding: 25px;
        margin: 25px 0;
        border: 2px solid #2a3a4a;
      }

      .decision-title {
        color: #fee440;
        margin-bottom: 20px;
        text-align: center;
        font-size: 1rem;
      }

      .decision-comparison {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        flex-wrap: wrap;
      }

      .decision-box {
        background: #1a2a3a;
        padding: 20px 30px;
        border-radius: 15px;
        text-align: center;
        min-width: 160px;
        transition: all 0.3s ease;
      }

      .decision-box.option-extend {
        border: 2px solid #00bbf9;
      }

      .decision-box.option-restart {
        border: 2px solid #f72585;
      }

      .decision-box.winner {
        transform: scale(1.1);
        box-shadow: 0 0 30px currentColor;
      }

      .decision-box.winner.option-extend {
        background: rgba(0, 187, 249, 0.2);
      }

      .decision-box.winner.option-restart {
        background: rgba(247, 37, 133, 0.2);
      }

      .decision-box .label {
        font-size: 0.75rem;
        color: #888;
        margin-bottom: 8px;
      }

      .decision-box .formula {
        font-family: "Courier New", monospace;
        font-size: 0.85rem;
        color: #aaa;
        margin-bottom: 8px;
      }

      .decision-box .value {
        font-size: 1.8rem;
        font-weight: bold;
      }

      .decision-box.option-extend .value {
        color: #00bbf9;
      }
      .decision-box.option-restart .value {
        color: #f72585;
      }

      .decision-vs {
        font-size: 1.5rem;
        color: #fee440;
        font-weight: bold;
      }

      .decision-arrow {
        font-size: 2rem;
        color: #00f5d4;
      }

      .decision-result {
        background: linear-gradient(135deg, #1a4a3a, #2a6a5a);
        border: 2px solid #00f5d4;
        padding: 20px 30px;
        border-radius: 15px;
        text-align: center;
      }

      .decision-result .label {
        font-size: 0.75rem;
        color: #aaa;
        margin-bottom: 8px;
      }

      .decision-result .value {
        font-size: 2rem;
        font-weight: bold;
        color: #00f5d4;
      }

      /* Info Panel */
      .info-panel {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 15px;
        margin: 25px 0;
      }

      .info-card {
        background: #1a2a3a;
        border-radius: 15px;
        padding: 18px;
        border: 1px solid #2a3a4a;
        text-align: center;
        transition: all 0.3s ease;
      }

      .info-card h3 {
        color: #667;
        font-size: 0.7rem;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .info-card .value {
        font-size: 1.6rem;
        font-weight: bold;
      }

      .info-card.current-sum .value {
        color: #00bbf9;
      }
      .info-card.current-sum.negative .value {
        color: #f72585;
      }
      .info-card.max-sum .value {
        color: #00f5d4;
      }
      .info-card.max-sum.updated {
        animation: pulse-green 0.5s ease;
        box-shadow: 0 0 20px rgba(0, 245, 212, 0.5);
      }
      .info-card.index .value {
        color: #fee440;
      }
      .info-card.decision .value {
        color: #9b5de5;
        font-size: 1rem;
      }

      @keyframes pulse-green {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      /* Subarray Tracker */
      .subarray-tracker {
        background: #0d1520;
        border-radius: 15px;
        padding: 20px;
        margin: 20px 0;
        border: 1px solid #2a3a4a;
      }

      .tracker-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
      }

      .tracker-item {
        text-align: center;
      }

      .tracker-item .label {
        font-size: 0.75rem;
        color: #667;
        margin-bottom: 5px;
      }

      .tracker-item .content {
        font-family: "Courier New", monospace;
        padding: 8px 15px;
        border-radius: 8px;
        background: #1a2a3a;
      }

      .tracker-item.current .content {
        color: #00bbf9;
        border: 1px solid #00bbf9;
      }

      .tracker-item.best .content {
        color: #00f5d4;
        border: 1px solid #00f5d4;
      }

      /* Progress */
      .progress-section {
        margin: 25px 0;
      }

      .step-counter {
        text-align: center;
        color: #888;
        font-size: 0.9rem;
        margin-bottom: 10px;
      }

      .progress-bar {
        width: 100%;
        height: 10px;
        background: #1a2a3a;
        border-radius: 5px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #00f5d4, #00bbf9, #9b5de5);
        border-radius: 5px;
        transition: width 0.3s ease;
      }

      /* Controls */
      .controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin: 25px 0;
        flex-wrap: wrap;
      }

      button {
        padding: 14px 28px;
        font-size: 1rem;
        border: none;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: bold;
      }

      .btn-primary {
        background: linear-gradient(135deg, #00f5d4, #00bbf9);
        color: #000;
      }

      .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(0, 245, 212, 0.4);
      }

      .btn-secondary {
        background: #2a3a4a;
        color: #fff;
      }

      .btn-secondary:hover {
        background: #3a4a5a;
      }

      .btn-success {
        background: linear-gradient(135deg, #9b5de5, #f72585);
        color: #fff;
      }

      .btn-warning {
        background: linear-gradient(135deg, #fee440, #f9c74f);
        color: #000;
      }

      button:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none !important;
      }

      /* Speed Control */
      .speed-control {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        margin: 20px 0;
      }

      .speed-control label {
        color: #888;
        font-size: 0.9rem;
      }

      .speed-slider {
        width: 150px;
        accent-color: #00f5d4;
      }

      /* Code Panel */
      .code-panel {
        background: #0d1520;
        border-radius: 15px;
        padding: 20px;
        margin-top: 25px;
        border: 1px solid #2a3a4a;
      }

      .code-panel h3 {
        color: #00f5d4;
        margin-bottom: 15px;
        font-size: 1rem;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .code-panel h3::after {
        content: "OPTIMAL";
        background: linear-gradient(135deg, #00f5d4, #00bbf9);
        color: #000;
        padding: 3px 12px;
        font-size: 0.7rem;
        border-radius: 10px;
      }

      .code-line {
        font-family: "Courier New", monospace;
        padding: 6px 12px;
        color: #667;
        font-size: 0.9rem;
        border-left: 3px solid transparent;
        transition: all 0.3s ease;
        border-radius: 0 8px 8px 0;
      }

      .code-line.active {
        background: rgba(0, 245, 212, 0.1);
        color: #fff;
        border-left-color: #00f5d4;
      }

      .code-keyword {
        color: #f72585;
      }
      .code-var {
        color: #00f5d4;
      }
      .code-num {
        color: #fee440;
      }
      .code-comment {
        color: #4a5a6a;
      }
      .code-func {
        color: #9b5de5;
      }

      /* Result */
      .best-result {
        text-align: center;
        margin-top: 25px;
        padding: 30px;
        background: linear-gradient(135deg, #0d2a2a, #1a4a4a);
        border-radius: 20px;
        border: 3px solid #00f5d4;
        display: none;
      }

      .best-result.show {
        display: block;
        animation: result-glow 2s ease-in-out infinite;
      }

      @keyframes result-glow {
        0%,
        100% {
          box-shadow: 0 0 30px rgba(0, 245, 212, 0.4);
        }
        50% {
          box-shadow: 0 0 60px rgba(0, 245, 212, 0.7);
        }
      }

      .best-result h3 {
        color: #00f5d4;
        font-size: 1.8rem;
        margin-bottom: 20px;
      }

      .best-result .result-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .best-result .result-item {
        background: #1a2a3a;
        padding: 15px;
        border-radius: 12px;
      }

      .best-result .result-item .label {
        color: #888;
        font-size: 0.8rem;
        margin-bottom: 5px;
      }

      .best-result .result-item .value {
        color: #fff;
        font-size: 1.3rem;
        font-weight: bold;
      }

      /* Why It Works Section */
      .explanation-section {
        margin-top: 30px;
        padding: 25px;
        background: rgba(155, 93, 229, 0.1);
        border: 1px solid #9b5de5;
        border-radius: 15px;
      }

      .explanation-section h4 {
        color: #9b5de5;
        margin-bottom: 15px;
        font-size: 1.1rem;
      }

      .explanation-section p {
        color: #ccc;
        font-size: 0.9rem;
        line-height: 1.7;
        margin-bottom: 12px;
      }

      .explanation-section .key-rule {
        background: #1a2a3a;
        padding: 15px 20px;
        border-radius: 10px;
        margin: 15px 0;
        border-left: 4px solid #9b5de5;
      }

      .explanation-section .key-rule code {
        color: #00f5d4;
        background: #0d1520;
        padding: 2px 8px;
        border-radius: 4px;
        font-family: "Courier New", monospace;
      }

      .complexity-comparison {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
        gap: 10px;
        margin-top: 20px;
      }

      .complexity-item {
        background: #1a2a3a;
        padding: 12px;
        border-radius: 8px;
        text-align: center;
      }

      .complexity-item .algo {
        font-size: 0.75rem;
        color: #888;
        margin-bottom: 5px;
      }

      .complexity-item .time {
        font-size: 1rem;
        font-weight: bold;
      }

      .complexity-item.kadane {
        border: 2px solid #00f5d4;
        background: rgba(0, 245, 212, 0.1);
      }

      .complexity-item.kadane .time {
        color: #00f5d4;
      }

      /* History Trail */
      .history-section {
        margin-top: 20px;
        padding: 15px;
        background: #0d1520;
        border-radius: 12px;
        max-height: 150px;
        overflow-y: auto;
      }

      .history-title {
        color: #888;
        font-size: 0.8rem;
        margin-bottom: 10px;
      }

      .history-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 5px 10px;
        margin: 3px 0;
        border-radius: 6px;
        font-size: 0.8rem;
        background: #1a2a3a;
      }

      .history-item .step-num {
        color: #fee440;
        font-weight: bold;
        min-width: 30px;
      }

      .history-item .action {
        color: #888;
      }

      .history-item .action.extend {
        color: #00bbf9;
      }
      .history-item .action.restart {
        color: #f72585;
      }

      .history-item .sums {
        color: #00f5d4;
        margin-left: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>‚ö° Kadane's Algorithm</h1>
      <p class="subtitle">The Optimal O(n) Solution | Single Pass Magic</p>
      <div class="badges">
        <span class="badge optimal">üèÜ OPTIMAL SOLUTION</span>
        <span class="badge time">‚è±Ô∏è O(n) Time</span>
        <span class="badge space">üì¶ O(1) Space</span>
      </div>

      <div class="whiteboard">
        <!-- Key Insight Banner -->
        <div class="insight-banner">
          <h3>üí° The Core Question at Each Step</h3>
          <div class="question">
            "Should I EXTEND the previous subarray or START FRESH?"
          </div>
          <div class="insight-options">
            <div class="insight-option extend" id="optionExtend">
              <div class="icon">‚ûï</div>
              <div class="label">EXTEND</div>
              <div class="condition">if prevSum ‚â• 0</div>
            </div>
            <div class="insight-option restart" id="optionRestart">
              <div class="icon">üîÑ</div>
              <div class="label">START FRESH</div>
              <div class="condition">if prevSum < 0</div>
            </div>
          </div>
        </div>

        <!-- Array Section -->
        <div class="array-section">
          <div class="section-title">Input Array</div>
          <div class="array-container" id="arrayContainer"></div>
          <div class="pointer-row" id="pointerRow"></div>
        </div>

        <!-- Decision Panel -->
        <div class="decision-panel">
          <div class="decision-title">üßÆ Decision Calculation</div>
          <div class="decision-comparison">
            <div class="decision-box option-extend" id="extendBox">
              <div class="label">Extend Previous</div>
              <div class="formula" id="extendFormula">prevSum + nums[i]</div>
              <div class="value" id="extendValue">-</div>
            </div>
            <div class="decision-vs">VS</div>
            <div class="decision-box option-restart" id="restartBox">
              <div class="label">Start Fresh</div>
              <div class="formula" id="restartFormula">nums[i]</div>
              <div class="value" id="restartValue">-</div>
            </div>
            <div class="decision-arrow">‚Üí</div>
            <div class="decision-result">
              <div class="label">New currentSum</div>
              <div class="value" id="decisionResult">-</div>
            </div>
          </div>
        </div>

        <!-- Subarray Tracker -->
        <div class="subarray-tracker">
          <div class="tracker-row">
            <div class="tracker-item current">
              <div class="label">Current Subarray</div>
              <div class="content" id="currentSubarray">[ ]</div>
            </div>
            <div class="tracker-item best">
              <div class="label">Best Subarray Found</div>
              <div class="content" id="bestSubarray">[ ]</div>
            </div>
          </div>
        </div>

        <!-- Info Panel -->
        <div class="info-panel">
          <div class="info-card index">
            <h3>Index (i)</h3>
            <div class="value" id="currentIndex">0</div>
          </div>
          <div class="info-card">
            <h3>nums[i]</h3>
            <div class="value" id="currentElement" style="color: #fff">-</div>
          </div>
          <div class="info-card current-sum" id="currentSumCard">
            <h3>currentSum</h3>
            <div class="value" id="currentSum">0</div>
          </div>
          <div class="info-card max-sum" id="maxSumCard">
            <h3>maxSum</h3>
            <div class="value" id="maxSum">-‚àû</div>
          </div>
          <div class="info-card decision">
            <h3>Decision</h3>
            <div class="value" id="decisionText">-</div>
          </div>
        </div>

        <!-- Progress -->
        <div class="progress-section">
          <div class="step-counter">
            Step <span id="currentStep">0</span> of
            <span id="totalSteps">0</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
        </div>

        <!-- Speed Control -->
        <div class="speed-control">
          <label>Speed:</label>
          <input
            type="range"
            class="speed-slider"
            id="speedSlider"
            min="200"
            max="2000"
            value="800"
          />
          <span id="speedValue">800ms</span>
        </div>

        <!-- Controls -->
        <div class="controls">
          <button class="btn-secondary" onclick="reset()">‚Ü∫ Reset</button>
          <button class="btn-primary" id="startBtn" onclick="start()">
            ‚ñ∂ Start
          </button>
          <button class="btn-warning" id="stepBtn" onclick="step()" disabled>
            ‚Üí Step
          </button>
          <button class="btn-success" id="autoBtn" onclick="toggleAuto()">
            ‚è© Auto Play
          </button>
        </div>

        <!-- History -->
        <div class="history-section">
          <div class="history-title">üìú Step History</div>
          <div id="historyContainer"></div>
        </div>

        <!-- Code Panel -->
        <div class="code-panel">
          <h3>üíª Kadane's Algorithm</h3>
          <div class="code-line" id="code-0">
            <span class="code-keyword">function</span>
            <span class="code-func">maxSubarray</span>(nums) {
          </div>
          <div class="code-line" id="code-1">
            &nbsp;&nbsp;<span class="code-keyword">let</span>
            <span class="code-var">currentSum</span> = nums[<span
              class="code-num"
              >0</span
            >];
          </div>
          <div class="code-line" id="code-2">
            &nbsp;&nbsp;<span class="code-keyword">let</span>
            <span class="code-var">maxSum</span> = nums[<span class="code-num"
              >0</span
            >];
          </div>
          <div class="code-line" id="code-3">
            &nbsp;&nbsp;<span class="code-keyword">for</span> (<span
              class="code-keyword"
              >let</span
            >
            i = <span class="code-num">1</span>; i < nums.length; i++) {
          </div>
          <div class="code-line" id="code-4">
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment"
              >// Key decision: extend or restart?</span
            >
          </div>
          <div class="code-line" id="code-5">
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-var">currentSum</span> =
            <span class="code-func">Math.max</span>(nums[i], currentSum +
            nums[i]);
          </div>
          <div class="code-line" id="code-6">
            &nbsp;&nbsp;&nbsp;&nbsp;<span class="code-var">maxSum</span> =
            <span class="code-func">Math.max</span>(maxSum, currentSum);
          </div>
          <div class="code-line" id="code-7">&nbsp;&nbsp;}</div>
          <div class="code-line" id="code-8">
            &nbsp;&nbsp;<span class="code-keyword">return</span>
            <span class="code-var">maxSum</span>;
          </div>
          <div class="code-line" id="code-9">}</div>
        </div>

        <!-- Result -->
        <div class="best-result" id="bestResult">
          <h3>üéâ Algorithm Complete!</h3>
          <div class="result-grid">
            <div class="result-item">
              <div class="label">Maximum Sum</div>
              <div class="value" id="finalSum">6</div>
            </div>
            <div class="result-item">
              <div class="label">Best Subarray</div>
              <div class="value" id="finalSubarray">[4,-1,2,1]</div>
            </div>
            <div class="result-item">
              <div class="label">Total Steps</div>
              <div class="value" id="finalSteps">9</div>
            </div>
            <div class="result-item">
              <div class="label">Complexity</div>
              <div class="value">O(n)</div>
            </div>
          </div>
        </div>

        <!-- Explanation -->
        <div class="explanation-section">
          <h4>üß† Why Kadane's Algorithm Works</h4>
          <p>
            The brilliant insight is that at each position, we only need to
            answer ONE question:
            <strong
              >"Will including the previous subarray help or hurt?"</strong
            >
          </p>
          <div class="key-rule">
            <strong>The Rule:</strong> If <code>currentSum < 0</code>, the
            previous subarray can only drag us down. Start fresh! Otherwise,
            extend it.
          </div>
          <p>
            This works because a negative sum prefix can NEVER improve any
            future subarray. We're essentially "forgetting" bad history and
            keeping only what helps.
          </p>
          <div class="complexity-comparison">
            <div class="complexity-item">
              <div class="algo">Brute Force</div>
              <div class="time" style="color: #f72585">O(n¬≥)</div>
            </div>
            <div class="complexity-item">
              <div class="algo">Running Sum</div>
              <div class="time" style="color: #fee440">O(n¬≤)</div>
            </div>
            <div class="complexity-item">
              <div class="algo">Divide & Conquer</div>
              <div class="time" style="color: #00bbf9">O(n log n)</div>
            </div>
            <div class="complexity-item kadane">
              <div class="algo">Kadane's</div>
              <div class="time">O(n) ‚≠ê</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Input array
      const nums = [-2, 1, -3, 4, -1, 2, 1, -5, 4];
      const n = nums.length;

      // State
      let steps = [];
      let currentStepIndex = 0;
      let isRunning = false;
      let autoPlayInterval = null;
      let speed = 800;

      // Tracking
      let currentSum = 0;
      let maxSum = -Infinity;
      let currentStart = 0;
      let currentEnd = 0;
      let bestStart = 0;
      let bestEnd = 0;
      let history = [];

      // Initialize
      function init() {
        generateSteps();
        renderArray();
        document.getElementById("totalSteps").textContent = steps.length;
        document
          .getElementById("speedSlider")
          .addEventListener("input", (e) => {
            speed = parseInt(e.target.value);
            document.getElementById("speedValue").textContent = speed + "ms";
          });
      }

      // Generate all steps
      function generateSteps() {
        steps = [];

        // Initialize step
        steps.push({
          type: "init",
          currentSum: nums[0],
          maxSum: nums[0],
          index: 0,
          codeLine: 1,
          message: "Initialize with first element",
        });

        let cs = nums[0];
        let ms = nums[0];
        let cStart = 0;
        let bStart = 0;
        let bEnd = 0;

        for (let i = 1; i < n; i++) {
          const extendValue = cs + nums[i];
          const restartValue = nums[i];
          const isRestart = restartValue > extendValue;

          if (isRestart) {
            cs = restartValue;
            cStart = i;
          } else {
            cs = extendValue;
          }

          const maxUpdated = cs > ms;
          if (maxUpdated) {
            ms = cs;
            bStart = cStart;
            bEnd = i;
          }

          steps.push({
            type: "process",
            index: i,
            element: nums[i],
            extendValue: extendValue,
            restartValue: restartValue,
            isRestart: isRestart,
            newCurrentSum: cs,
            newMaxSum: ms,
            maxUpdated: maxUpdated,
            currentStart: cStart,
            currentEnd: i,
            bestStart: bStart,
            bestEnd: bEnd,
            codeLine: 5,
            message: isRestart
              ? "Start fresh (previous was negative drag)"
              : "Extend previous subarray",
          });
        }

        steps.push({
          type: "complete",
          maxSum: ms,
          bestStart: bStart,
          bestEnd: bEnd,
        });
      }

      // Render array
      function renderArray() {
        const container = document.getElementById("arrayContainer");
        container.innerHTML = "";

        nums.forEach((num, idx) => {
          const cell = document.createElement("div");
          cell.className = "array-cell";
          cell.id = `cell-${idx}`;
          cell.innerHTML = `
                    <span class="cell-index">${idx}</span>
                    <span class="cell-value ${
                      num < 0 ? "negative" : "positive"
                    }">${num}</span>
                `;
          container.appendChild(cell);
        });

        // Pointer row
        const pointerRow = document.getElementById("pointerRow");
        pointerRow.innerHTML = "";
        nums.forEach((_, idx) => {
          const slot = document.createElement("div");
          slot.className = "pointer-slot";
          slot.id = `pointer-${idx}`;
          pointerRow.appendChild(slot);
        });
      }

      // Add to history
      function addHistory(stepNum, action, currentSum, maxSum) {
        const container = document.getElementById("historyContainer");
        const item = document.createElement("div");
        item.className = "history-item";
        item.innerHTML = `
                <span class="step-num">#${stepNum}</span>
                <span class="action ${action.toLowerCase()}">${action}</span>
                <span class="sums">cs=${currentSum}, ms=${maxSum}</span>
            `;
        container.insertBefore(item, container.firstChild);
      }

      // Update visualization
      function updateVisualization(step) {
        // Clear highlights
        document.querySelectorAll(".array-cell").forEach((cell) => {
          cell.className = "array-cell";
          const existingDecision = cell.querySelector(".cell-decision");
          if (existingDecision) existingDecision.remove();
        });
        document.querySelectorAll(".pointer-slot").forEach((slot) => {
          slot.innerHTML = "";
        });
        document.querySelectorAll(".code-line").forEach((line) => {
          line.classList.remove("active");
        });

        // Reset option highlights
        document
          .getElementById("optionExtend")
          .classList.remove("active-extend");
        document
          .getElementById("optionRestart")
          .classList.remove("active-restart");
        document.getElementById("extendBox").classList.remove("winner");
        document.getElementById("restartBox").classList.remove("winner");
        document.getElementById("maxSumCard").classList.remove("updated");
        document.getElementById("currentSumCard").classList.remove("negative");

        // Highlight code line
        if (step.codeLine !== undefined) {
          const codeLine = document.getElementById(`code-${step.codeLine}`);
          if (codeLine) codeLine.classList.add("active");
        }

        if (step.type === "init") {
          document
            .getElementById(`cell-${0}`)
            .classList.add("current", "in-subarray", "best-subarray");
          document.getElementById(`pointer-${0}`).innerHTML =
            '<span class="pointer">i ‚ñº</span>';

          document.getElementById("currentIndex").textContent = "0";
          document.getElementById("currentElement").textContent = nums[0];
          document.getElementById("currentSum").textContent = step.currentSum;
          document.getElementById("maxSum").textContent = step.maxSum;
          document.getElementById("decisionText").textContent = "Initialize";

          document.getElementById(
            "currentSubarray"
          ).textContent = `[${nums[0]}]`;
          document.getElementById("bestSubarray").textContent = `[${nums[0]}]`;

          document.getElementById("extendValue").textContent = "-";
          document.getElementById("restartValue").textContent = "-";
          document.getElementById("decisionResult").textContent =
            step.currentSum;

          currentSum = step.currentSum;
          maxSum = step.maxSum;
          currentStart = 0;
          currentEnd = 0;
          bestStart = 0;
          bestEnd = 0;

          addHistory(0, "INIT", step.currentSum, step.maxSum);

          // Highlight code lines 1-2
          document.getElementById("code-1").classList.add("active");
          document.getElementById("code-2").classList.add("active");
        } else if (step.type === "process") {
          const i = step.index;

          // Update current pointer
          document.getElementById(`pointer-${i}`).innerHTML =
            '<span class="pointer">i ‚ñº</span>';
          document.getElementById(`cell-${i}`).classList.add("current");

          // Highlight current subarray
          for (let j = step.currentStart; j <= step.currentEnd; j++) {
            document.getElementById(`cell-${j}`).classList.add("in-subarray");
          }

          // Highlight best subarray
          for (let j = step.bestStart; j <= step.bestEnd; j++) {
            document.getElementById(`cell-${j}`).classList.add("best-subarray");
          }

          // Update decision visualization
          document.getElementById(
            "extendFormula"
          ).textContent = `${currentSum} + (${nums[i]})`;
          document.getElementById("extendValue").textContent = step.extendValue;
          document.getElementById("restartFormula").textContent = `${nums[i]}`;
          document.getElementById("restartValue").textContent =
            step.restartValue;
          document.getElementById("decisionResult").textContent =
            step.newCurrentSum;

          // Highlight winning option
          if (step.isRestart) {
            document
              .getElementById("optionRestart")
              .classList.add("active-restart");
            document.getElementById("restartBox").classList.add("winner");
            document.getElementById("decisionText").textContent = "üîÑ RESTART";
          } else {
            document
              .getElementById("optionExtend")
              .classList.add("active-extend");
            document.getElementById("extendBox").classList.add("winner");
            document.getElementById("decisionText").textContent = "‚ûï EXTEND";
          }

          // Update info cards
          document.getElementById("currentIndex").textContent = i;
          document.getElementById("currentElement").textContent = nums[i];
          document.getElementById("currentSum").textContent =
            step.newCurrentSum;

          if (step.newCurrentSum < 0) {
            document.getElementById("currentSumCard").classList.add("negative");
          }

          if (step.maxUpdated) {
            document.getElementById("maxSum").textContent = step.newMaxSum;
            document.getElementById("maxSumCard").classList.add("updated");
            document.getElementById("code-6").classList.add("active");
          }

          // Update subarray trackers
          const currentArr = nums.slice(step.currentStart, step.currentEnd + 1);
          const bestArr = nums.slice(step.bestStart, step.bestEnd + 1);
          document.getElementById(
            "currentSubarray"
          ).textContent = `[${currentArr.join(", ")}]`;
          document.getElementById(
            "bestSubarray"
          ).textContent = `[${bestArr.join(", ")}]`;

          // Update state
          currentSum = step.newCurrentSum;
          maxSum = step.newMaxSum;
          currentStart = step.currentStart;
          currentEnd = step.currentEnd;
          bestStart = step.bestStart;
          bestEnd = step.bestEnd;

          addHistory(
            i,
            step.isRestart ? "RESTART" : "EXTEND",
            step.newCurrentSum,
            step.newMaxSum
          );
        } else if (step.type === "complete") {
          // Highlight best subarray
          for (let j = step.bestStart; j <= step.bestEnd; j++) {
            document.getElementById(`cell-${j}`).classList.add("best-subarray");
          }

          document.getElementById("bestResult").classList.add("show");
          document.getElementById("finalSum").textContent = step.maxSum;
          document.getElementById("finalSubarray").textContent = `[${nums
            .slice(step.bestStart, step.bestEnd + 1)
            .join(", ")}]`;
          document.getElementById("finalSteps").textContent = n;

          document.getElementById("code-8").classList.add("active");
        }

        // Update progress
        document.getElementById("currentStep").textContent =
          currentStepIndex + 1;
        const progress = ((currentStepIndex + 1) / steps.length) * 100;
        document.getElementById("progressFill").style.width = progress + "%";
      }

      // Control functions
      function start() {
        document.getElementById("startBtn").disabled = true;
        document.getElementById("stepBtn").disabled = false;
        isRunning = true;
        updateVisualization(steps[0]);
      }

      function step() {
        if (currentStepIndex < steps.length - 1) {
          currentStepIndex++;
          updateVisualization(steps[currentStepIndex]);
        }
        if (currentStepIndex >= steps.length - 1) {
          document.getElementById("stepBtn").disabled = true;
          stopAuto();
        }
      }

      function toggleAuto() {
        if (autoPlayInterval) {
          stopAuto();
        } else {
          startAuto();
        }
      }

      function startAuto() {
        if (!isRunning) start();
        document.getElementById("autoBtn").textContent = "‚è∏ Pause";
        autoPlayInterval = setInterval(() => {
          if (currentStepIndex < steps.length - 1) {
            step();
          } else {
            stopAuto();
          }
        }, speed);
      }

      function stopAuto() {
        if (autoPlayInterval) {
          clearInterval(autoPlayInterval);
          autoPlayInterval = null;
        }
        document.getElementById("autoBtn").textContent = "‚è© Auto Play";
      }

      function reset() {
        stopAuto();
        currentStepIndex = 0;
        isRunning = false;
        currentSum = 0;
        maxSum = -Infinity;
        currentStart = 0;
        currentEnd = 0;
        bestStart = 0;
        bestEnd = 0;
        history = [];

        document.getElementById("startBtn").disabled = false;
        document.getElementById("stepBtn").disabled = true;
        document.getElementById("bestResult").classList.remove("show");

        document.getElementById("currentIndex").textContent = "0";
        document.getElementById("currentElement").textContent = "-";
        document.getElementById("currentSum").textContent = "0";
        document.getElementById("maxSum").textContent = "-‚àû";
        document.getElementById("decisionText").textContent = "-";
        document.getElementById("currentSubarray").textContent = "[ ]";
        document.getElementById("bestSubarray").textContent = "[ ]";

        document.getElementById("extendFormula").textContent =
          "prevSum + nums[i]";
        document.getElementById("extendValue").textContent = "-";
        document.getElementById("restartFormula").textContent = "nums[i]";
        document.getElementById("restartValue").textContent = "-";
        document.getElementById("decisionResult").textContent = "-";

        document.getElementById("currentStep").textContent = "0";
        document.getElementById("progressFill").style.width = "0%";
        document.getElementById("historyContainer").innerHTML = "";

        document
          .getElementById("optionExtend")
          .classList.remove("active-extend");
        document
          .getElementById("optionRestart")
          .classList.remove("active-restart");
        document.getElementById("extendBox").classList.remove("winner");
        document.getElementById("restartBox").classList.remove("winner");
        document.getElementById("maxSumCard").classList.remove("updated");
        document.getElementById("currentSumCard").classList.remove("negative");

        // Clear array highlights
        document.querySelectorAll(".array-cell").forEach((cell) => {
          cell.className = "array-cell";
          const idx = parseInt(cell.id.split("-")[1]);
          const val = nums[idx];
          cell.innerHTML = `
                    <span class="cell-index">${idx}</span>
                    <span class="cell-value ${
                      val < 0 ? "negative" : "positive"
                    }">${val}</span>
                `;
        });

        document.querySelectorAll(".pointer-slot").forEach((slot) => {
          slot.innerHTML = "";
        });

        document.querySelectorAll(".code-line").forEach((line) => {
          line.classList.remove("active");
        });
      }

      // Initialize
      init();
    </script>
  </body>
</html>
